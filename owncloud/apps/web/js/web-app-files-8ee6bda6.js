define(["./chunks/resources-e9c94644","./chunks/vendor-62f8e512","./chunks/error-2937cd2c","./chunks/index-4425091f","./chunks/dav-ddb55b6f"],(function(e,t,s,i,a){"use strict";function r(e){const s={name:e.$gettext("Quick action link"),permissions:1},i=e.store.state.user.capabilities.files_sharing.public.expire_date;return i.enabled&&(s.expireDate=t.DateTime_1.now().plus({days:parseInt(i.days,10)}).endOf("day").toISO()),new Promise(((i,a)=>{e.store.dispatch("Files/addLink",{path:e.item.path,client:e.client,params:s}).then((s=>{e.store.dispatch("Files/sidebar/openWithPanel","links-item").then((()=>{t.copyToClipboard(s.url),e.store.dispatch("showMessage",{title:e.$gettext("Public link created"),desc:e.$gettext("Public link has been successfully created and copied into your clipboard."),status:"success",autoClose:{enabled:!0}})})),i()})).catch((e=>{a(e)}))}))}async function o(e){await e.store.dispatch("Files/sidebar/openWithPanel","sharing-item")}function n(e,t){return t.state.user.capabilities.files_sharing&&t.state.user.capabilities.files_sharing.api_enabled&&e.canShare()}var l={collaborators:{id:"collaborators",label:e=>e("Add people"),icon:"group-add",handler:o,displayed:n},publicLink:{id:"public-link",label:e=>e("Create and copy public link"),icon:"link-add",handler:r,displayed:n}};function c(e="",t=!1){const s="/"+e.replace(/^\/+/,"").replace(/\/+$/,"");if("/"===s)return[];const i=[],a=s.split("/");for(t&&i.push(s),a.pop();a.length>0;)i.push(a.join("/")),a.pop();return i}const d=e=>void 0!==e.shareTypes?e.shareTypes:e.shares?Array.from(new Set(e.shares.map((e=>parseInt(e.type))))):[],u=t=>e.ShareTypes.containsAnyValue(e.ShareTypes.authenticated,d(t)),h=t=>e.ShareTypes.containsAnyValue(e.ShareTypes.unauthenticated,d(t)),p=(t,s)=>u(t)||((t,s)=>t.isReceivedShare()||e.ShareTypes.containsAnyValue(e.ShareTypes.authenticated,v(t.path,s)))(t,s),m=(t,s)=>h(t)||((t,s)=>e.ShareTypes.containsAnyValue(e.ShareTypes.unauthenticated,v(t.path,s)))(t,s),f=t=>u(t)?e.$gettext("This item is directly shared with others."):e.$gettext("This item is shared with others through one of the parent folders."),g=t=>h(t)?e.$gettext("This item is directly shared via links."):e.$gettext("This item is shared via links through one of the parent folders."),v=(e,t)=>{const s=c(e,!0);if(0===s.length)return[];s.pop();const i={};return s.forEach((e=>{const s=t[e];s&&s.forEach((e=>{i[e.shareType]=!0}))})),Object.keys(i).map((e=>parseInt(e,10)))},_=(t,s)=>[{id:`files-sharing-${t.id.replaceAll("=","")}`,accessibleDescription:f(t),label:e.$gettext("Show invited people"),visible:p(t,s),icon:"group",target:"sharing-item",type:u(t)?"user-direct":"user-indirect",handler:b},{id:`file-link-${t.id.replaceAll("=","")}`,accessibleDescription:g(t),label:e.$gettext("Show links"),visible:m(t,s),icon:"link",target:"links-item",type:h(t)?"link-direct":"link-indirect",handler:b}].filter((e=>e.visible)),b=async(e,t)=>{await window.Vue.$store.dispatch("Files/sidebar/openWithPanel",t)};const x=new class{serverUrl;capability;initialize(e,s=[]){this.serverUrl=e;const i=s.filter((e=>e.enabled)).sort(((e,s)=>t.semver.rcompare(e.version,s.version)));this.capability=i.length?i[0]:null}get available(){return!!this.capability?.version}get url(){if(!this.available)throw new s.RuntimeError("no archiver available");return/^https?:\/\//i.test(this.capability.archiver_url)?this.capability.archiver_url:[this.serverUrl.replace(/\/+$/,""),this.capability.archiver_url.replace(/^\/+/,"")].join("/")}};class S{value;expires;constructor(e,t){this.value=e,this.expires=t?(new Date).getTime()+t:0}get expired(){return this.expires>0&&this.expires<(new Date).getTime()}}class y{map;ttl;capacity;constructor(e){this.ttl=e.ttl||0,this.capacity=e.capacity||0,this.map=new Map}set(e,t,s){return this.evict(),this.map.set(e,new S(t,isNaN(s)?this.ttl:s)),t}get(e){this.evict();const t=this.map.get(e);if(t)return t.value}delete(e){return this.map.delete(e)}clear(){return this.map.clear()}entries(){return this.evict(),[...this.map.entries()].map((e=>[e[0],e[1].value]))}keys(){return this.evict(),[...this.map.keys()]}has(e){return this.evict(),this.map.has(e)}values(){return this.evict(),[...this.map.values()].map((e=>e.value))}evict(){if(this.map.forEach(((e,t)=>{e.expired&&this.delete(t)})),this.capacity)for(const[e]of[...this.map.entries()]){if(this.map.size<=this.capacity)break;this.delete(e)}}}const w=new y({ttl:1e4,capacity:250}),C=new y({ttl:1e4,capacity:250});const E=new class{get avatarUrl(){return C}get filePreview(){return w}};class k{instance;cancelToken;constructor(e){this.cancelToken=t.axios.CancelToken.source(),this.instance=t.axios.create(e)}cancel(e){this.cancelToken.cancel(e)}delete(e,t){return this.instance.delete(e,this.obtainConfig(t))}get(e,t){return this.instance.get(e,this.obtainConfig(t))}head(e,t){return this.instance.head(e,this.obtainConfig(t))}options(e,t){return this.instance.options(e,this.obtainConfig(t))}patch(e,t,s){return this.instance.patch(e,t,this.obtainConfig(s))}post(e,t,s){return this.instance.post(e,t,this.obtainConfig(s))}put(e,t,s){return this.instance.put(e,t,this.obtainConfig(s))}request(e){return this.instance.request(this.obtainConfig(e))}obtainConfig(e){return t.merge({cancelToken:this.cancelToken.token},e)}}const $=new class{httpAuthenticatedClient;httpUnAuthenticatedClient;httpAuthenticated(e){return this.httpAuthenticatedClient&&this.httpAuthenticatedClient.token===e||(this.httpAuthenticatedClient={token:e,instance:new k({headers:{Authorization:"Bearer "+e,"X-Requested-With":"XMLHttpRequest"}})}),this.httpAuthenticatedClient.instance}get httpUnAuthenticated(){return this.httpUnAuthenticatedClient||(this.httpUnAuthenticatedClient=new k({headers:{"X-Requested-With":"XMLHttpRequest"}})),this.httpUnAuthenticatedClient}get owncloudSdk(){return window.Vue.prototype.$client}};class F{static filterSearch;static sdkSearch}const R=e=>t.queryString.stringify({scalingup:e.scalingup||0,preview:Object.hasOwnProperty.call(e,"preview")?e.preview:1,a:Object.hasOwnProperty.call(e,"a")?e.a:1,...e.etag&&{c:e.etag.replaceAll('"',"")},...e.dimensions&&e.dimensions[0]&&{x:e.dimensions[0]},...e.dimensions&&e.dimensions[1]&&{y:e.dimensions[1]}}),T=async(e,t=!1)=>{if(t)return I(e);const i=[e.server,"remote.php/dav/files/",e.userId,s.encodePath(e.resource.path),"?",R({etag:e.resource.etag,dimensions:e.dimensions})].join("");try{const{data:t}=await $.httpAuthenticated(e.token).get(i,{responseType:"blob"});return window.URL.createObjectURL(t)}catch(e){}},I=async e=>{const s=E.filePreview.get(e.resource.id);if(s&&s.etag===e.resource.etag&&t.isEqual(e.dimensions,s.dimensions))return s.src;try{const t=await T(e);return E.filePreview.set(e.resource.id,{src:t,etag:e.resource.etag,dimensions:e.dimensions},0).src}catch(e){}},P=async({resource:e,isPublic:t,dimensions:s,server:i,userId:a,token:r},o=!1)=>{let n="";return"folder"!==e.type&&e.extension&&(t||i&&a&&r)?(n=t?await(async e=>{const[t,s]=e.resource.downloadURL.split("?"),i=[t,[R({etag:e.resource.etag,dimensions:e.dimensions}),s].filter(Boolean).join("&")].filter(Boolean).join("?"),{status:a}=await $.httpUnAuthenticated.head(i);if(404!==a)return i})({resource:e,dimensions:s}):await T({server:i,userId:a,token:r,resource:e,dimensions:s},o),n):n},D=(e,s,i)=>new t.Fuse(e,{includeScore:!0,useExtendedSearch:!0,threshold:.3,keys:["name","type","icon","extension"]}).search(s,{limit:i}).map((e=>e.item)),L=(e,t)=>!(!e||!t)&&e.id===t.id;class A{static Thumbnail=[36,36];static Preview=[1200,1200];static Avatar=64}class O{static Thumbnail="thumbnail";static Preview="preview";static Avatar="avatar"}const N=async(e,t=!1)=>{const s=e.size||A.Avatar;if(t)return M({...e,size:s});const i=[e.server,"remote.php/dav/avatars/",e.username,`/${s}.png`].join(""),{status:a,statusText:r}=await $.httpAuthenticated(e.token).head(i);if(200!==a)throw new Error(r);const{owncloudSdk:o}=$;return o&&"function"==typeof o.signUrl?o.signUrl(i):i},M=async e=>{const t=E.avatarUrl.get(e.username);if(t&&t.size===e.size)return t.src;try{const t=await N(e);return E.avatarUrl.set(e.username,{src:t,size:e.size},0).src}catch(e){}};function U(e){const t=new Set;return e.forEach((e=>{t.add(e.shareType)})),Array.from(t)}function z(e,t,s){const i=[...e.files],a=i.findIndex((e=>e.id===t.id)),r=a>-1;e.filesSearched=null,(r||s)&&(r?i.splice(a,1,t):i.push(t),e.files=i)}var B={namespaced:!0,state:{currentFolder:null,files:[],filesSearched:null,selectedIds:[],inProgress:[],dropzone:!1,shareOpen:null,versions:[],currentFileOutgoingShares:[],currentFileOutgoingSharesError:null,currentFileOutgoingSharesLoading:!1,incomingShares:[],incomingSharesError:null,incomingSharesLoading:!1,sharesTree:{},sharesTreeError:null,sharesTreeLoading:!1,loadingFolder:!1,publicLinkPassword:null,uploaded:[],actionsInProgress:[],publicLinkInEdit:{id:null,name:"",permissions:1,hasPassword:!1,expireDate:null},areHiddenFilesShown:!0},getters:{inProgress:e=>e.inProgress,selectedFiles:(e,t)=>t.filesAll.filter((t=>e.selectedIds.includes(t.id))),files:e=>e.files,filesAll:e=>e.filesSearched||e.files,currentFolder:e=>e.currentFolder,flatFileList:e=>!1==!!e.currentFolder,activeFiles:(e,t)=>{let s=[].concat(t.filesAll);return e.areHiddenFilesShown||(s=s.filter((e=>!e.name.startsWith(".")))),s},totalFilesSize:(e,t)=>t.filesAll.map((e=>parseInt(e.size))).reduce(((e,t)=>e+t),0),totalFilesCount:(e,t)=>({files:t.filesAll.filter((e=>"file"===e.type)).length,folders:t.filesAll.filter((e=>"folder"===e.type)).length}),dropzone:e=>e.dropzone,currentFileOutgoingCollaborators:t=>t.currentFileOutgoingShares.filter((t=>e.ShareTypes.containsAnyValue(e.ShareTypes.authenticated,[t.shareType]))),currentFileOutgoingLinks:t=>t.currentFileOutgoingShares.filter((t=>e.ShareTypes.containsAnyValue(e.ShareTypes.unauthenticated,[t.shareType]))),currentFileOutgoingSharesLoading:e=>e.currentFileOutgoingSharesLoading,sharesTree:e=>e.sharesTree,sharesTreeLoading:e=>e.sharesTreeLoading,loadingFolder:(e,t)=>e.loadingFolder||null===t.highlightedFile&&e.sharesTreeLoading,quota:e=>e.quota,highlightedFile:(e,t)=>t.selectedFiles.length>0?t.selectedFiles[0]:e.currentFolder,versions:e=>e.versions,publicLinkPassword:e=>{if(e.publicLinkPassword)return e.publicLinkPassword;let s=sessionStorage.getItem("publicLinkInfo");if(s)try{s=t.Buffer.from(s,"base64").toString()}catch(e){sessionStorage.removeItem("publicLinkInfo")}return s},uploaded:e=>e.uploaded,actionsInProgress:e=>e.actionsInProgress},actions:{updateFileProgress({commit:e},t){e("UPDATE_FILE_PROGRESS",t)},addFileToProgress({commit:e},t){e("ADD_FILE_TO_PROGRESS",t)},removeFileFromProgress({commit:e},t){e("REMOVE_FILE_FROM_PROGRESS",t)},loadFiles(t,{currentFolder:s,files:i}){s&&(s=e.buildResource(s)),i=i.map(e.buildResource),t.commit("LOAD_FILES",{currentFolder:s,files:i})},setFileSelection(e,t){e.commit("SET_FILE_SELECTION",t)},addFileSelection(e,t){e.commit("ADD_FILE_SELECTION",t)},removeFileSelection(e,t){e.commit("REMOVE_FILE_SELECTION",t)},toggleFileSelection(e,t){e.state.selectedIds.includes(t.id)?e.commit("REMOVE_FILE_SELECTION",t):e.commit("ADD_FILE_SELECTION",t)},resetFileSelection(e){e.commit("RESET_SELECTION")},markFavorite(e,t){const s=t.file,i=t.client,a=!s.starred;return i.files.favorite(s.path,a).then((()=>{e.commit("FAVORITE_FILE",s)})).catch((e=>{throw new Error(e)}))},deleteFiles(t,{files:s,client:i,publicPage:a,firstRun:r=!0}){const o=[];for(const n of s){let s=null;s=a?i.publicFiles.delete(n.path,null,t.getters.publicLinkPassword):i.files.delete(n.path);const l=s.then((()=>{t.dispatch("sidebar/close"),t.commit("REMOVE_FILE",n),t.commit("REMOVE_FILE_SELECTION",n),t.commit("REMOVE_FILE_FROM_SEARCHED",n)})).catch((s=>{let o=e.$gettext('Error while deleting "%{file}"');if(423===s.statusCode){if(r)return t.dispatch("deleteFiles",{files:[n],client:i,publicPage:a,firstRun:!1});o=e.$gettext('Error while deleting "%{file}" - the file is locked')}const l=e.$gettextInterpolate(o,{file:n.name},!0);t.dispatch("showMessage",{title:l,status:"danger",autoClose:{enabled:!0}},{root:!0})}));o.push(l)}return Promise.all(o)},async clearTrashBin(e){await e.dispatch("sidebar/close"),e.commit("CLEAR_FILES"),e.commit("RESET_SELECTION"),e.commit("CLEAR_FILES_SEARCHED")},async removeFilesFromTrashbin(e,t){await e.dispatch("sidebar/close");for(const s of t)e.commit("REMOVE_FILE",s),e.commit("REMOVE_FILE_SELECTION",s),e.commit("REMOVE_FILE_FROM_SEARCHED",s)},renameFile(e,{file:t,newValue:s,client:i,publicPage:a,isSameResource:r}){if(void 0!==t&&void 0!==s&&s!==t.name){const o=t.path.substr(1,t.path.lastIndexOf("/"));return a?i.publicFiles.move(t.path,o+s,e.getters.publicLinkPassword).then((()=>{r||e.commit("RENAME_FILE",{file:t,newValue:s,newPath:o})})):i.files.move(t.path,o+s).then((()=>{r||e.commit("RENAME_FILE",{file:t,newValue:s,newPath:o})}))}},updateCurrentFileShareTypes({state:e,getters:t,commit:s}){const i=t.highlightedFile;i&&s("UPDATE_RESOURCE_FIELD",{id:i.id,field:"shareTypes",value:U(e.currentFileOutgoingShares)})},loadCurrentFileOutgoingShares(t,{client:s,path:i}){t.commit("CURRENT_FILE_OUTGOING_SHARES_SET",[]),t.commit("CURRENT_FILE_OUTGOING_SHARES_ERROR",null),t.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!0),s.shares.getShares(i,{reshares:!0}).then((s=>{t.commit("CURRENT_FILE_OUTGOING_SHARES_SET",s.map((s=>e.buildShare(s.shareInfo,t.getters.highlightedFile,!t.rootGetters.isOcis)))),t.dispatch("updateCurrentFileShareTypes"),t.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)})).catch((e=>{t.commit("CURRENT_FILE_OUTGOING_SHARES_ERROR",e.message),t.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)}))},loadIncomingShares(t,s){t.commit("INCOMING_SHARES_LOAD",[]),t.commit("INCOMING_SHARES_ERROR",null),t.commit("INCOMING_SHARES_LOADING",!0);const i=s.client,a=s.path;i.shares.getShares(a,{shared_with_me:!0}).then((s=>{t.commit("INCOMING_SHARES_LOAD",s.map((s=>e.buildCollaboratorShare(s.shareInfo,t.getters.highlightedFile,!t.rootGetters.isOcis)))),t.commit("INCOMING_SHARES_LOADING",!1)})).catch((e=>{t.commit("INCOMING_SHARES_ERROR",e.message),t.commit("INCOMING_SHARES_LOADING",!1)}))},changeShare({commit:t,getters:s,rootGetters:i},{client:a,share:r,permissions:o,expirationDate:n}){const l={permissions:o,expireDate:n};return new Promise(l.permissions?(o,n)=>{a.shares.updateShare(r.id,l).then((a=>{const r=e.buildCollaboratorShare(a.shareInfo,s.highlightedFile,!i.isOcis);t("CURRENT_FILE_OUTGOING_SHARES_UPDATE",r),o(r)})).catch((e=>{n(e)}))}:(e,t)=>{t(new Error("Nothing changed"))})},addShare(t,{client:s,path:i,shareWith:a,shareType:r,permissions:o,expirationDate:n}){if(r===e.ShareTypes.group.value)return void s.shares.shareFileWithGroup(i,a,{permissions:o,expirationDate:n}).then((a=>{t.commit("CURRENT_FILE_OUTGOING_SHARES_ADD",e.buildCollaboratorShare(a.shareInfo,t.getters.highlightedFile,!t.rootGetters.isOcis)),t.dispatch("updateCurrentFileShareTypes"),t.dispatch("loadIndicators",{client:s,currentFolder:i})})).catch((s=>{t.dispatch("showMessage",{title:e.$gettext("Error while sharing."),desc:s,status:"danger",autoClose:{enabled:!0}},{root:!0})}));const l=r===e.ShareTypes.remote.value;s.shares.shareFileWithUser(i,a,{permissions:o,remoteUser:l,expirationDate:n}).then((a=>{t.commit("CURRENT_FILE_OUTGOING_SHARES_ADD",e.buildCollaboratorShare(a.shareInfo,t.getters.highlightedFile,!t.rootGetters.isOcis)),t.dispatch("updateCurrentFileShareTypes"),t.dispatch("loadIndicators",{client:s,currentFolder:i})})).catch((s=>{t.dispatch("showMessage",{title:e.$gettext("Error while sharing."),desc:s,status:"danger",autoClose:{enabled:!0}},{root:!0})}))},deleteShare(e,{client:t,share:s,resource:i}){t.shares.deleteShare(s.id).then((()=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_REMOVE",s),e.dispatch("updateCurrentFileShareTypes"),e.dispatch("loadIndicators",{client:t,currentFolder:i.path})})).catch((e=>{console.error(e)}))},pruneSharesTreeOutsidePath(e,t){e.commit("SHARESTREE_PRUNE_OUTSIDE_PATH",t)},loadSharesTree(s,{client:i,path:a}){s.commit("SHARESTREE_ERROR",null),s.dispatch("pruneSharesTreeOutsidePath",a);const r=c(a,!0),o={};if(!r.length)return Promise.resolve();r.pop(),s.commit("SHARESTREE_LOADING",!0);const n=new t._default({concurrency:2}),l=[];return r.forEach((t=>{if(s.getters.sharesTree[t])return Promise.resolve();o[t]=[],l.push(n.add((()=>i.shares.getShares(t,{reshares:!0}).then((i=>{i.forEach((i=>{o[t].push({...e.buildShare(i.shareInfo,{type:"folder"},!s.rootGetters.isOcis),outgoing:!0,indirect:!0})}))})).catch((e=>{console.error("SHARESTREE_ERROR",e),s.commit("SHARESTREE_ERROR",e.message),s.commit("SHARESTREE_LOADING",!1)}))))),l.push(n.add((()=>i.shares.getShares(t,{shared_with_me:!0}).then((i=>{i.forEach((i=>{o[t].push({...e.buildCollaboratorShare(i.shareInfo,{type:"folder"},!s.rootGetters.isOcis),incoming:!0,indirect:!0})}))})).catch((e=>{console.error("SHARESTREE_ERROR",e),s.commit("SHARESTREE_ERROR",e.message),s.commit("SHARESTREE_LOADING",!1)})))))})),Promise.all(l).then((()=>{s.commit("SHARESTREE_ADD",o),s.commit("SHARESTREE_LOADING",!1)}))},async loadVersions(e,{client:t,fileId:s}){let i;try{i=await t.fileVersions.listVersions(s)}catch(e){console.error(e),i=[]}e.commit("SET_VERSIONS",i)},dragOver(e,t){e.commit("DRAG_OVER",t)},setPublicLinkPassword(e,t){e.commit("SET_PUBLIC_LINK_PASSWORD",t)},addLink:(t,{path:s,client:i,params:a})=>new Promise(((r,o)=>{i.shares.shareFileWithLink(s,a).then((a=>{const o=e.buildShare(a.shareInfo,null,!t.rootGetters.isOcis);t.commit("CURRENT_FILE_OUTGOING_SHARES_ADD",o),t.dispatch("updateCurrentFileShareTypes"),t.dispatch("loadIndicators",{client:i,currentFolder:s}),r(o)})).catch((e=>{o(e)}))})),updateLink:(t,{id:s,client:i,params:a})=>new Promise(((r,o)=>{i.shares.updateShare(s,a).then((s=>{const i=e.buildShare(s.shareInfo,null,!t.rootGetters.isOcis);t.commit("CURRENT_FILE_OUTGOING_SHARES_UPDATE",i),r(i)})).catch((e=>{o(e)}))})),removeLink(e,{share:t,client:s,resource:i}){s.shares.deleteShare(t.id).then((()=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_REMOVE",t),e.dispatch("updateCurrentFileShareTypes"),e.dispatch("loadIndicators",{client:s,currentFolder:i.path})})).catch((t=>e.commit("CURRENT_FILE_OUTGOING_SHARES_ERROR",t.message)))},addActionToProgress({commit:e},t){e("ADD_ACTION_TO_PROGRESS",t)},removeActionFromProgress({commit:e},t){e("REMOVE_ACTION_FROM_PROGRESS",t)},pushResourcesToDeleteList({commit:e},t){e("PUSH_RESOURCES_TO_DELETE_LIST",t)},clearResourcesToDeleteList({commit:e}){e("CLEAR_RESOURCES_TO_DELETE_LIST")},async loadIndicators({dispatch:e,commit:s},{client:i,currentFolder:a}){s("SHARESTREE_PRUNE_OUTSIDE_PATH",t.dirname(a)),await e("loadSharesTree",{client:i,path:a}),s("LOAD_INDICATORS")},loadAvatars({commit:e,rootGetters:s},{resource:i}){s.capabilities.files_sharing.user.profile_picture&&["sharedWith","owner"].forEach((a=>{(i[a]||[]).forEach(((r,o)=>{t.has(r,"avatar")&&N({username:r.username,server:s.configuration.server,token:s.getToken},!0).then((t=>e("UPDATE_RESOURCE_FIELD",{id:i.id,field:`${a}.[${o}].avatar`,value:t})))}))}))},async loadPreview({commit:e,rootGetters:t},{resource:s,isPublic:i,dimensions:a,type:r}){if(t.previewFileExtensions.length&&!t.previewFileExtensions.includes(s.extension.toLowerCase()))return;const o=await P({resource:s,isPublic:i,dimensions:a,server:t.configuration.server,userId:t.user.id,token:t.getToken},!0);o&&e("UPDATE_RESOURCE_FIELD",{id:s.id,field:r,value:o})}},mutations:{UPDATE_FILE_PROGRESS(e,t){const s=[...e.inProgress],i=s.findIndex((e=>e.id===t.id));-1!==i&&(s[i].progress=t.progress,e.inProgress=s)},ADD_FILE_TO_PROGRESS(e,t){const s=[...e.inProgress];s.push({id:t.id,name:t.name,type:t.type,size:t.size,progress:0,action:"upload"}),e.inProgress=s},REMOVE_FILE_FROM_PROGRESS(e,t){const s=[...e.inProgress],i=s.findIndex((e=>e.id===t.id));if(s.splice(i,1),s.length<1)return e.inProgress=[],void(e.uploaded=[]);e.inProgress=s;const a=[...e.uploaded];t.progress=100,a.push(t),e.uploaded=a},LOAD_FILES(e,{currentFolder:t,files:s}){e.currentFolder=t,e.files=s},SET_CURRENT_FOLDER(e,t){e.currentFolder=t},CLEAR_FILES(e){e.files=[]},LOAD_FILES_SEARCHED(e,t){e.filesSearched=t},REMOVE_FILE_FROM_SEARCHED(e,t){e.filesSearched&&(e.filesSearched=e.filesSearched.filter((e=>t.id!==e.id)))},CLEAR_FILES_SEARCHED(e){e.filesSearched=null},SET_FILE_SELECTION(e,t){e.selectedIds=t.map((e=>e.id))},ADD_FILE_SELECTION(e,t){const s=[...e.selectedIds];-1===s.findIndex((e=>e===t.id))&&(s.push(t.id),e.selectedIds=s)},REMOVE_FILE_SELECTION(e,t){const s=[...e.selectedIds];s.length>1?e.selectedIds=s.filter((e=>t.id!==e)):e.selectedIds=[]},RESET_SELECTION(e){e.selectedIds=[]},FAVORITE_FILE(e,t){const s=[...e.files],i=s.findIndex((e=>e.id===t.id));s[i].starred=!t.starred,e.files=s},REMOVE_FILE(e,t){e.files=[...e.files].filter((e=>e.id!==t.id))},RENAME_FILE(t,{file:s,newValue:i,newPath:a}){const r=[...t.files],o=r.findIndex((e=>e.id===s.id));e.renameResource(r[o],i,a),t.files=r},DRAG_OVER(e,t){e.dropzone=t},CURRENT_FILE_OUTGOING_SHARES_SET(e,t){e.currentFileOutgoingShares=t},CURRENT_FILE_OUTGOING_SHARES_ADD(e,t){e.currentFileOutgoingShares.push(t)},CURRENT_FILE_OUTGOING_SHARES_REMOVE(e,t){e.currentFileOutgoingShares=e.currentFileOutgoingShares.filter((e=>t.id!==e.id))},CURRENT_FILE_OUTGOING_SHARES_UPDATE(e,s){const i=e.currentFileOutgoingShares.findIndex((e=>e.id===s.id));i>=0?t.Vue.set(e.currentFileOutgoingShares,i,s):e.currentFileOutgoingShares.push(s)},CURRENT_FILE_OUTGOING_SHARES_ERROR(e,t){e.currentFileOutgoingShares=[],e.currentFileOutgoingSharesError=t},CURRENT_FILE_OUTGOING_SHARES_LOADING(e,t){e.currentFileOutgoingSharesLoading=t},INCOMING_SHARES_LOAD(e,t){e.incomingShares=t},INCOMING_SHARES_ERROR(e,t){e.incomingShares=[],e.incomingSharesError=t},INCOMING_SHARES_LOADING(e,t){e.incomingSharesLoading=t},SHARESTREE_PRUNE_OUTSIDE_PATH(e,s){""!==s&&"/"!==s?("/"!==(s+="/").charAt(0)&&(s="/"+s),e.sharesTree=t.pickBy(e.sharesTree,((e,t)=>s.startsWith(t+"/")))):e.sharesTree={}},SHARESTREE_ADD(e,t){e.sharesTree=Object.assign({},e.sharesTree,t)},SHARESTREE_ERROR(e,t){e.sharesTreeError=t},SHARESTREE_LOADING(e,t){e.sharesTreeLoading=t},UPDATE_FOLDER_LOADING(e,t){e.loadingFolder=t},SET_PUBLIC_LINK_PASSWORD(e,s){if(e.publicLinkPassword=s,s){const e=t.Buffer.from(s).toString("base64");sessionStorage.setItem("publicLinkInfo",e)}else sessionStorage.removeItem("publicLinkInfo")},ADD_ACTION_TO_PROGRESS(e,t){e.actionsInProgress.push(t)},REMOVE_ACTION_FROM_PROGRESS(e,t){const s=e.actionsInProgress.findIndex((e=>e===t));e.actionsInProgress.splice(s,1)},CLEAR_CURRENT_FILES_LIST(e){e.currentFolder=null,e.selectedIds=[],e.files.forEach((e=>{e.previewUrl&&e.previewUrl.startsWith("blob:")&&window.URL.revokeObjectURL(e.previewUrl)})),e.files=[]},SET_VERSIONS(e,t){e.versions=t},TRIGGER_PUBLIC_LINK_EDIT(e,s){s={id:s.id,name:s.name,permissions:parseInt(s.permissions,10),hasPassword:s.password,expireDate:null!==s.expiration?t.DateTime_1.fromISO(s.expiration).endOf("day").toISO():null},e.publicLinkInEdit=s},TRIGGER_PUBLIC_LINK_CREATE(e,{name:t,expireDate:s}){e.publicLinkInEdit={id:null,name:t,permissions:1,hasPassword:!1,expireDate:s}},LOAD_INDICATORS(e){for(const t of e.files){const s=_(t,e.sharesTree);(s||t.indicators.length)&&this.commit("Files/UPDATE_RESOURCE_FIELD",{id:t.id,field:"indicators",value:s})}},UPSERT_RESOURCE(e,t){z(e,t,!0)},UPDATE_RESOURCE(e,t){z(e,t,!1)},UPDATE_RESOURCE_FIELD(e,s){const i=e.filesSearched||e.files,a=i.findIndex((e=>e.id===s.id));if(a<0)return;const r=i[a],o=t.has(r,s.field),n=t.set(r,s.field,s.value);o||t.Vue.set(i,a,n)},SET_HIDDEN_FILES_VISIBILITY(e,t){e.areHiddenFilesShown=t,window.localStorage.setItem("oc_hiddenFilesShown",t)}},modules:{sidebar:{namespaced:!0,state:()=>({closed:!0,activePanel:null}),mutations:{SET_CLOSED(e,t){e.closed=t},SET_ACTIVE_PANEL(e,t){e.activePanel=t}},actions:{open({commit:e}){e("SET_CLOSED",!1),e("SET_ACTIVE_PANEL",null)},openWithPanel({commit:e},t){e("SET_CLOSED",!1),e("SET_ACTIVE_PANEL",t)},close({commit:e}){e("SET_CLOSED",!0),e("SET_ACTIVE_PANEL",null)},toggle({commit:e,state:t}){e("SET_CLOSED",!t.closed)},setActivePanel({commit:e},t){e("SET_ACTIVE_PANEL",t)},resetActivePanel({commit:e}){e("SET_ACTIVE_PANEL",null)}}}}};function G(e,t){return!e||e.indexOf(t)>-1}function V(e){return"files-personal"===e.name}function q(e){return"files-trashbin"===e.name}function H(e){return"files-shared-with-me"===e.name}function W(e){return"files-shared-with-others"===e.name}function j(e){return"files-public-list"===e.name}async function Y(t,s,i,a){const r=function(t){switch(t){case e.ShareStatus.accepted:return"POST";case e.ShareStatus.declined:return"DELETE";default:return null}}(s);if(!r)throw new Error("invalid new share status");let o=await a.requests.ocs({service:"apps/files_sharing",action:`api/v1/shares/pending/${t.share.id}`,method:r});if(200!==o.status)throw new Error(o.statusText);if(parseInt(o.headers.get("content-length"))>0&&(o=await o.json(),o.ocs.data.length>0)){const t=o.ocs.data[0];return e.buildSharedResource(t,!0,i)}return null}var Q={computed:{...t.mapGetters(["isOcis"]),$_acceptShare_items(){return[{name:"accept-share",icon:"check",handler:this.$_acceptShare_trigger,label:({resources:e})=>this.$ngettext("Accept share","Accept shares",e.length),isEnabled:({resources:t})=>{if(!H(this.$route))return!1;if(0===t.length)return!1;return!t.some((t=>t.status===e.ShareStatus.accepted))},componentType:"oc-button",class:"oc-files-actions-accept-share-trigger"}]}},methods:{...t.mapMutations("Files",["UPDATE_RESOURCE"]),...t.mapActions(["showMessage"]),...t.mapActions("Files",["resetFileSelection"]),async $_acceptShare_trigger({resources:s}){const i=[],a=[],r=new t._default({concurrency:4});s.forEach((t=>{a.push(r.add((async()=>{try{const s=await Y(t,e.ShareStatus.accepted,!this.isOcis,this.$client);s&&this.UPDATE_RESOURCE(s)}catch(e){console.error(e),i.push(e)}})))})),await Promise.all(a),0!==i.length?this.showMessage({title:this.$ngettext("Error while accepting the selected share.","Error while accepting selected shares.",s.length),status:"danger"}):this.resetFileSelection()}}},J={computed:{$_copy_items(){return[{name:"copy",icon:"file_copy",handler:this.$_copy_trigger,label:()=>this.$pgettext("Action in the files list row to initiate copying resources","Copy"),isEnabled:({resources:e})=>!!G(["files-personal","files-public-list","files-favorites"],this.$route.name)&&(0!==e.length&&(!j(this.$route)||this.currentFolder.canCreate())),componentType:"oc-button",class:"oc-files-actions-copy-trigger"}]}},methods:{$_copy_trigger({resources:e}){const t=j(this.$route)?"public":"private",s=this.currentFolder.path||this.homeFolder;return this.$router.push({name:"files-location-picker",params:{context:t,item:s,action:"copy"},query:{resource:e.map((e=>e.path))}})}}},K={computed:{...t.mapGetters(["isOcis"]),$_declineShare_items(){return[{name:"decline-share",icon:"not_interested",handler:this.$_declineShare_trigger,label:({resources:e})=>this.$ngettext("Decline share","Decline shares",e.length),isEnabled:({resources:t})=>{if(!H(this.$route))return!1;if(0===t.length)return!1;return!t.some((t=>t.status===e.ShareStatus.declined))},componentType:"oc-button",class:"oc-files-actions-decline-share-trigger"}]}},methods:{...t.mapMutations("Files",["UPDATE_RESOURCE"]),...t.mapActions(["showMessage"]),...t.mapActions("Files",["resetFileSelection"]),async $_declineShare_trigger({resources:s}){const i=[],a=[],r=new t._default({concurrency:4});s.forEach((t=>{a.push(r.add((async()=>{try{const s=await Y(t,e.ShareStatus.declined,!this.isOcis,this.$client);s&&this.UPDATE_RESOURCE(s)}catch(e){console.error(e),i.push(e)}})))})),await Promise.all(a),0!==i.length?this.showMessage({title:this.$ngettext("Error while declining the selected share.","Error while declining selected shares.",s.length),status:"danger"}):this.resetFileSelection()}}};function X(e){if(void 0===e)throw new Error('cloneStateObject: cannot clone "undefined"');return JSON.parse(JSON.stringify(e))}var Z={mixins:[{data:()=>({deleteResources_queue:new t._default({concurrency:4}),deleteResources_deleteOps:[],resourcesToDelete:[]}),computed:{...t.mapGetters("Files",["selectedFiles"]),...t.mapGetters(["user"]),$_deleteResources_isInTrashbin(){return q(this.$route)},$_deleteResources_resources(){return X(this.resourcesToDelete)},$_deleteResources_dialogTitle(){const e=this.$_deleteResources_resources,t="folder"===e[0].type;let s=null;return 1===e.length?(s=t?this.$_deleteResources_isInTrashbin?this.$gettext("Permanently delete folder %{name}"):this.$gettext("Delete folder %{name}"):this.$_deleteResources_isInTrashbin?this.$gettext("Permanently delete file %{name}"):this.$gettext("Delete file %{name}"),this.$gettextInterpolate(s,{name:e[0].name},!0)):(s=this.$_deleteResources_isInTrashbin?this.$ngettext("Permanently delete selected resource?","Permanently delete %{amount} selected resources?",e.length):this.$ngettext("Delete selected resource?","Delete %{amount} selected resources?",e.length),this.$gettextInterpolate(s,{amount:e.length},!1))},$_deleteResources_dialogMessage(){const e=this.$_deleteResources_resources,t="folder"===e[0].type;return 1===e.length?t?this.$_deleteResources_isInTrashbin?this.$gettext("Are you sure you want to delete this folder? All it’s content will be permanently removed. This action cannot be undone."):this.$gettext("Are you sure you want to delete this folder?"):this.$_deleteResources_isInTrashbin?this.$gettext("Are you sure you want to delete this file? All it’s content will be permanently removed. This action cannot be undone."):this.$gettext("Are you sure you want to delete this file?"):this.$_deleteResources_isInTrashbin?this.$gettext("Are you sure you want to delete all selected resources? All their content will be permanently removed. This action cannot be undone."):this.$gettext("Are you sure you want to delete all selected resources?")}},methods:{...t.mapActions("Files",["pushResourcesToDeleteList","removeFilesFromTrashbin","deleteFiles"]),...t.mapActions(["showMessage","toggleModalConfirmButton","hideModal","createModal"]),...t.mapMutations(["SET_QUOTA"]),$_deleteResources_trashbin_deleteOp(e){return this.$client.fileTrash.clearTrashBin(e.id).then((()=>{this.removeFilesFromTrashbin([e]);const t=this.$gettext("%{file} was successfully deleted");this.showMessage({title:this.$gettextInterpolate(t,{file:e.name},!0),autoClose:{enabled:!0}})})).catch((t=>{if(423===t.statusCode){const t=this.deleteResources_queue.add((()=>this.$_deleteResources_trashbin_deleteOp(e)));return void this.deleteResources_deleteOps.push(t)}const s=this.$gettext("Deletion of %{file} failed");this.showMessage({title:this.$gettextInterpolate(s,{file:e.name},!0),desc:t.message,status:"danger",autoClose:{enabled:!0}})}))},$_deleteResources_trashbin_delete(){this.toggleModalConfirmButton();for(const e of this.$_deleteResources_resources){const t=this.deleteResources_queue.add((()=>this.$_deleteResources_trashbin_deleteOp(e)));this.deleteResources_deleteOps.push(t)}Promise.all(this.deleteResources_deleteOps).then((()=>{this.hideModal(),this.toggleModalConfirmButton()}))},$_deleteResources_filesList_delete(){this.deleteFiles({client:this.$client,files:this.$_deleteResources_resources,publicPage:this.publicPage(),$gettext:this.$gettext,$gettextInterpolate:this.$gettextInterpolate}).then((async()=>{this.hideModal(),this.toggleModalConfirmButton();const e=await this.$client.users.getUser(this.user.id);let t;if(this.SET_QUOTA(e.quota),this.resourcesToDelete.length&&L(this.resourcesToDelete[0],this.currentFolder)){const e=this.resourcesToDelete[0].path;t=e.substr(1,e.lastIndexOf("/"))}void 0!==t&&this.$router.push({params:{item:t}})}))},$_deleteResources_delete(){this.toggleModalConfirmButton(),this.$_deleteResources_isInTrashbin?this.$_deleteResources_trashbin_delete():this.$_deleteResources_filesList_delete()},$_deleteResources_displayDialog(e){this.resourcesToDelete=[...e];const t={variation:"danger",icon:"warning",title:this.$_deleteResources_dialogTitle,message:this.$_deleteResources_dialogMessage,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Delete"),onCancel:this.hideModal,onConfirm:this.$_deleteResources_delete};this.createModal(t)}}}],computed:{...t.mapState("Files",["currentFolder"]),$_delete_items(){return[{name:"delete",icon:"delete",label:()=>this.$gettext("Delete"),handler:this.$_delete_trigger,isEnabled:({resources:e})=>{if(!V(this.$route)&&!j(this.$route))return!1;if(0===e.length)return!1;return!e.some((e=>!e.canBeDeleted()))},componentType:"oc-button",class:"oc-files-actions-delete-trigger"},{name:"delete-permanent",icon:"delete",label:()=>this.$gettext("Delete"),handler:this.$_delete_trigger,isEnabled:({resources:e})=>!!q(this.$route)&&e.length>0,componentType:"oc-button",class:"oc-files-actions-delete-permanent-trigger"}]}},methods:{$_delete_trigger({resources:e}){this.$_deleteResources_displayDialog(e)}}};const ee=(e=x)=>e.available;var te={computed:{$_downloadArchive_items(){return[{name:"download-archive",icon:"archive",handler:this.$_downloadArchive_trigger,label:()=>this.$gettext("Download"),isEnabled:({resources:e})=>{if(!G(["files-personal","files-public-list","files-favorites"],this.$route.name))return!1;if(0===e.length)return!1;if(1===e.length&&!e[0].isFolder)return!1;if(!ee())return!1;return!e.some((e=>!e.canDownload()))},canBeDefault:!0,componentType:"oc-button",class:"oc-files-actions-download-archive-trigger"}]}},methods:{async $_downloadArchive_trigger({resources:e}){await(async e=>{const i=e.archiverService||x,a=e.clientService||$;if(!ee(i))throw new s.RuntimeError("no archiver capability available");if(0===e.fileIds.length)throw new s.RuntimeError("requested archive with empty list of resources");if(2!==t.semver.major(i.capability.version))return;const r=[e.publicToken?`public-token=${e.publicToken}`:"",...e.fileIds.map((e=>`id=${e}`))].filter(Boolean),o=i.url+"?"+r.join("&");window.location=e.publicToken?o:await a.owncloudSdk.signUrl(o)})({fileIds:e.map((e=>e.fileId)),...j(this.$route)&&{publicToken:this.$route.params.item.split("/")[0]}}).catch((e=>{console.error(e),this.showMessage({title:this.$ngettext("Error downloading the selected folder.","Error downloading the selected files.",this.selectedFiles.length),status:"danger"})}))}}},se={computed:{$_downloadFile_items(){return[{name:"delete-file",icon:"file_download",handler:this.$_downloadFile_trigger,label:()=>this.$gettext("Download"),isEnabled:({resources:e})=>!!G(["files-personal","files-favorites","files-public-list"],this.$route.name)&&(1===e.length&&(!e[0].isFolder&&e[0].canDownload())),canBeDefault:!0,componentType:"oc-button",class:"oc-files-actions-download-file-trigger"}]}},methods:{$_downloadFile_trigger({resources:e}){this.downloadFile(e[0])}}},ie={inject:{displayedItem:{default:null}},computed:{$_favorite_items(){return[{name:"favorite",icon:"star",handler:this.$_favorite_trigger,label:({resources:e})=>e[0].starred?this.$gettext("Remove from favorites"):this.$gettext("Add to favorites"),isEnabled:({resources:e})=>!!G(["files-personal","files-favorites"],this.$route.name)&&(1===e.length&&(this.isAuthenticated&&this.capabilities.files&&this.capabilities.files.favorites)),componentType:"oc-button",class:"oc-files-actions-favorite-trigger"}]}},methods:{...t.mapActions("Files",["markFavorite"]),$_favorite_trigger({resources:e}){this.markFavorite({client:this.$client,file:e[0]}).then((()=>{this.displayedItem&&(this.displayedItem.value.starred=!this.displayedItem.value.starred)})).catch((()=>{const t=this.$gettext('Error while starring "%{file}"'),s=this.$gettextInterpolate(t,{file:e[0].name},!0);this.showMessage({title:s,status:"danger",autoClose:{enabled:!0}})}))}}},ae={computed:{$_fetch_items(){return[{name:"open-pdf",icon:"remove_red_eye",handler:({resources:e})=>this.$_fetch_trigger({resources:e,mimeType:"application/pdf",isPublicFile:j(this.$route)}),label:()=>this.$gettext("Open in browser"),isEnabled:({resources:e})=>!this.isTrashbinRoute&&(1===e.length&&"pdf"===e[0].extension.toLowerCase()),canBeDefault:!0,componentType:"oc-button",class:"oc-files-actions-fetch-trigger",opensInNewWindow:!0}]}},methods:{$_fetch_trigger({resources:e,mimeType:t,isPublicFile:s}){let i;const a=new Headers;s?i=e[0].downloadURL:(i=this.$client.helpers._webdavUrl+e[0].path,a.append("Authorization","Bearer "+this.getToken),a.append("X-Requested-With","XMLHttpRequest")),fetch(i,{method:"GET",headers:a}).then((e=>e.blob())).then((e=>this.$_fetch_openBlobInNewTab(e,t)))},$_fetch_openBlobInNewTab(e,t){const s=new Blob([e],{type:t}),i=window.URL.createObjectURL(s);window.open(i,"_blank")}}};var re={computed:{$_move_items(){return[{name:"move",icon:"folder-move",handler:this.$_move_trigger,label:()=>this.$pgettext("Action in the files list row to initiate moving resources","Move"),isEnabled:({resources:e})=>{if(!G(["files-personal","files-public-list","files-favorites"],this.$route.name))return!1;if(0===e.length)return!1;if(!this.currentFolder)return!1;return!e.some((e=>!1===function(e,t){const s=e.isReceivedShare()||e.isMounted(),i=""===t&&s;return e.canBeDeleted()&&!i}(e,this.currentFolder.path)))},componentType:"oc-button",class:"oc-files-actions-move-trigger"}]}},methods:{$_move_trigger({resources:e}){const t=j(this.$route)?"public":"private",s=this.currentFolder.path||this.homeFolder;return this.$router.push({name:"files-location-picker",params:{context:t,item:s,action:"move"},query:{resource:e.map((e=>e.path))}})}}},oe={computed:{...t.mapState("Files",["currentFolder"]),$_navigate_items(){return[{name:"navigate",icon:"folder-open",label:()=>this.$pgettext("Action in the files list row to open a folder","Open folder"),isEnabled:({resources:t})=>!q(this.$route)&&(1===t.length&&(!L(t[0],this.currentFolder)&&(!!t[0].isFolder&&(!H(this.$route)||t[0].status===e.ShareStatus.accepted)))),canBeDefault:!0,componentType:"router-link",route:this.route,class:"oc-files-actions-navigate-trigger"}]},route(){return j(this.$route)?"files-public-list":"files-personal"}}},ne={computed:{...t.mapGetters("Files",["files","currentFolder"]),$_rename_items(){return[{name:"rename",icon:"edit",label:()=>this.$gettext("Rename"),handler:this.$_rename_trigger,isEnabled:({resources:e})=>{if(q(this.$route))return!1;if(1!==e.length)return!1;return!e.some((e=>!e.canRename()))},componentType:"oc-button",class:"oc-files-actions-rename-trigger"}]}},methods:{...t.mapActions(["createModal","hideModal","setModalInputErrorMessage","showMessage","toggleModalConfirmButton"]),...t.mapActions("Files",["renameFile"]),async $_rename_trigger({resources:t}){let s;if(L(t[0],this.currentFolder)){const i=c(t[0].path,!1);s=await this.$client.files.list(i[0],1),s=s.map(e.buildResource)}const i={variation:"passive",title:this.$gettextInterpolate(t[0].isFolder?this.$gettext("Rename folder %{name}"):this.$gettext("Rename file %{name}"),{name:t[0].name}),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Rename"),hasInput:!0,inputValue:t[0].name,inputLabel:t[0].isFolder?this.$gettext("Folder name"):this.$gettext("File name"),onCancel:this.hideModal,onConfirm:e=>{this.$_rename_renameResource(t[0],e)},onInput:e=>{this.$_rename_checkNewName(t[0].name,e,s)}};this.createModal(i)},$_rename_checkNewName(e,t,s){if(!t)return this.setModalInputErrorMessage(this.$gettext("The name cannot be empty"));if(/[/]/.test(t))return this.setModalInputErrorMessage(this.$gettext('The name cannot contain "/"'));if("."===t)return this.setModalInputErrorMessage(this.$gettext('The name cannot be equal to "."'));if(".."===t)return this.setModalInputErrorMessage(this.$gettext('The name cannot be equal to ".."'));if(/\s+$/.test(t))return this.setModalInputErrorMessage(this.$gettext("The name cannot end with whitespace"));if(!this.flatFileList){if(this.files.find((s=>s.name===t&&e!==t))){const e=this.$gettext('The name "%{name}" is already taken');return this.setModalInputErrorMessage(this.$gettextInterpolate(e,{name:t},!0))}}if(s){if(s.find((s=>s.name===t&&e!==t))){const e=this.$gettext('The name "%{name}" is already taken');return this.setModalInputErrorMessage(this.$gettextInterpolate(e,{name:t},!0))}}this.setModalInputErrorMessage(null)},$_rename_renameResource(e,t){this.toggleModalConfirmButton();const s=L(e,this.currentFolder);this.renameFile({client:this.$client,file:e,newValue:t,publicPage:this.publicPage(),isSameResource:s}).then((()=>{if(this.hideModal(),s){const s=e.path.substr(1,e.path.lastIndexOf("/"));this.$router.push({params:{item:"/"+s+t||"/"}})}})).catch((s=>{this.toggleModalConfirmButton();let i=this.$gettext('Error while renaming "%{file}" to "%{newName}"');423===s.statusCode&&(i=this.$gettext('Error while renaming "%{file}" to "%{newName}" - the file is locked'));const a=this.$gettextInterpolate(i,{file:e.name,newName:t},!0);this.showMessage({title:a,status:"danger"})}))}}},le={computed:{$_restore_items(){return[{name:"restore",icon:"restore",label:()=>this.$gettext("Restore"),handler:this.$_restore_trigger,isEnabled:({resources:e})=>!!q(this.$route)&&e.length>0,componentType:"oc-button",class:"oc-files-actions-restore-trigger"}]}},methods:{...t.mapActions("Files",["removeFilesFromTrashbin"]),async $_restore_trigger({resources:e}){const s=[],i=[],a=[],r=new t._default({concurrency:4});if(e.forEach((e=>{a.push(r.add((async()=>{try{await this.$client.fileTrash.restore(e.id,e.path),s.push(e)}catch(t){console.error(t),i.push(e)}})))})),await Promise.all(a),s.length>0){let e;this.removeFilesFromTrashbin(s);const t={};1===s.length?(e=this.$gettext("%{resource} was restored successfully"),t.resource=s[0].name):(e=this.$gettext("%{resourceCount} files restored successfully"),t.resourceCount=s.length),this.showMessage({title:this.$gettextInterpolate(e,t,!0)})}if(i.length>0){let e;const t={};1===i.length?(e=this.$gettext("Failed to restore %{resource}"),t.resource=i[0].name):(e=this.$gettext("Failed to restore %{resourceCount} files"),t.resourceCount=i.length),this.showMessage({title:this.$gettextInterpolate(e,t,!0),status:"danger"})}}}};const ce=["fetch","navigate","downloadArchive","downloadFile","favorite","copy","move","rename","restore","delete","acceptShare","declineShare"];var de,ue={mixins:[Q,J,K,Z,se,te,ie,ae,re,oe,ne,le],computed:{...t.mapState(["apps"]),...t.mapGetters("Files",["highlightedFile","currentFolder"]),...t.mapGetters("External",["mimeTypes"]),...t.mapGetters(["capabilities","configuration"]),$_fileActions_systemActions(){return ce.flatMap((e=>this[`$_${e}_items`]))},$_fileActions_editorActions(){return this.apps.fileEditors.map((e=>({label:()=>{const t=this.$gettext("Open in %{app}");return this.$gettextInterpolate(t,{app:this.apps.meta[e.app].name},!0)},icon:this.apps.meta[e.app].icon,img:this.apps.meta[e.app].img,handler:({resources:t})=>this.$_fileActions_openEditor(e,t[0].path,t[0].id,"edit"),isEnabled:({resources:t})=>1===t.length&&(!(Array.isArray(e.routes)&&!G(e.routes,this.$route.name))&&t[0].extension.toLowerCase()===e.extension.toLowerCase()),canBeDefault:e.canBeDefault,componentType:"oc-button",class:`oc-files-actions-${t.kebabCase(this.apps.meta[e.app].name).toLowerCase()}-trigger`}))).sort(((e,t)=>t.canBeDefault!==e.canBeDefault&&t.canBeDefault?1:0))}},methods:{...t.mapActions(["openFile"]),$_fileActions_openEditor(e,t,s,i){if(e.handler)return e.handler({config:this.configuration,extensionConfig:e.config,filePath:t,fileId:s,mode:i});if(this.openFile({filePath:t}),e.newTab){const a=this.$router.resolve({name:e.routeName,params:{filePath:t,fileId:s,mode:i}}).href,r=`${e.routeName}-${t}`,o=window.open(a,r);o&&o.focus()}else this.$router.push({name:e.routeName||e.app,params:{filePath:t,fileId:s,mode:i,contextRouteName:this.$route.name}})},$_fileActions_triggerDefaultAction(e){const t=this.$_fileActions_getDefaultAction(e);t.handler({resources:[e],...t.handlerData})},$_fileActions_getDefaultAction(e){const t=[e],s=e=>e.canBeDefault&&e.isEnabled({resources:t,parent:this.currentFolder}),i=this.$_fileActions_editorActions.filter(s);if(i.length)return i[0];const a=this.$_fileActions_loadExternalAppActions(t).filter(s);return a.length?a[0]:this.$_fileActions_systemActions.filter(s)[0]},$_fileActions_getAllAvailableActions(e){return[...this.$_fileActions_editorActions,...this.$_fileActions_loadExternalAppActions(e),...this.$_fileActions_systemActions].filter((t=>t.isEnabled({resources:e})))},$_fileActions_loadExternalAppActions(e){if(e.length>1)return[];const{mimeType:s,fileId:i}=e[0];if(void 0===s||!t.get(this,"capabilities.files.app_providers")||!t.get(this,"mimeTypes",[]).length)return[];const a=this.mimeTypes.find((e=>e.mime_type===s));if(void 0===a)return[];const{app_providers:r=[],default_application:o}=a;return r.map((e=>{const t=this.$gettext("Open in %{ appName }");return{name:e.name,icon:e.icon,img:e.img,componentType:"oc-button",class:`oc-files-actions-${e.name}-trigger`,isEnabled:()=>!0,canBeDefault:o===e.name,handler:()=>this.$_fileActions_openLink(e.name,i),label:()=>this.$gettextInterpolate(t,{appName:e.name})}}))},$_fileActions_openLink(e,t){const s=this.$router.resolve({name:"external-apps",params:{file_id:t,app:e},query:{...this.isPublicPage&&{"public-token":(this.$route.params.item||"").split("/")[0]}}});window.open(s.href,"_blank")}}};!function(e){e[e.enter=0]="enter",e[e.exit=1]="exit"}(de||(de={}));class he{state;observeEnter;observeExit;onEnterCallCount;onExitCallCount;onEnter;onExit;threshold;unobserver;constructor(e,t,s){this.unobserver=e,this.threshold=t,this.onEnter=s.onEnter,this.onExit=s.onExit,this.observeEnter=!!s.onEnter,this.observeExit=!!s.onExit,this.onEnterCallCount=0,this.onExitCallCount=0}request(e,t){const s={element:t,unobserve:()=>this.unobserve(e,t)};e===de.enter&&this.observeEnter&&this.onEnter?(this.onEnterCallCount++,this.onEnter({callCount:this.onEnterCallCount,...s})):this.state===de.enter&&e===de.exit&&this.observeExit&&this.onExit&&(this.onExitCallCount++,this.onExit({callCount:this.onExitCallCount,...s})),this.state=e}unobserve(e,t){e===de.enter?this.observeEnter=!1:e===de.exit&&(this.observeExit=!1),this.observeEnter||this.observeExit||this.unobserver(t)}}class pe{targets;intersectionObserver;options;constructor(e={}){this.options={root:e.root,rootMargin:e.rootMargin,threshold:e.threshold||0},this.targets=new WeakMap,this.intersectionObserver=new IntersectionObserver(this.trigger.bind(this),this.options)}observe(e,t={},s){(t.onEnter||t.onExit)&&(this.targets.set(e,new he(this.unobserve.bind(this),s||this.options.threshold||0,{onEnter:t.onEnter,onExit:t.onExit})),this.intersectionObserver.observe(e))}unobserve(e){this.targets.delete(e),this.intersectionObserver.unobserve(e)}disconnect(){this.targets=new WeakMap,this.intersectionObserver.disconnect()}trigger(e){e.forEach((e=>{const t=this.targets.get(e.target);t&&t.request(e.isIntersecting&&e.intersectionRatio>t.threshold?de.enter:de.exit,e.target)}))}}const me=new pe;const fe={mixins:[ue],props:{searchResult:{type:Object,default:function(){return{}}},provider:{type:Object,default:function(){return{}}}},data:()=>({resource:void 0}),computed:{...t.mapGetters(["configuration","user","getToken"])},beforeMount(){this.resource=this.searchResult.data},mounted(){const e=t.debounce((async({unobserve:e})=>{e();const s=await P({resource:this.resource,isPublic:!1,dimensions:A.ThumbNail,server:this.configuration.server,userId:this.user.id,token:this.getToken},!0);s&&t.Vue.set(this.resource,"preview",s)}),250);me.observe(this.$el,{onEnter:e,onExit:e.cancel})},beforeDestroy(){me.disconnect()}};var ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"files-search-preview",on:{click:function(t){return e.$_fileActions_triggerDefaultAction(e.resource)}}},[s("oc-resource",{attrs:{resource:e.resource,"is-path-displayed":!0,"target-route":{name:"files-personal"}}})],1)};ge._withStripped=!0;const ve=t.normalizeComponent({render:ge,staticRenderFns:[]},undefined,fe,undefined,false,undefined,!1,void 0,void 0,void 0);class _e{component;available;store;constructor(e){this.component=ve,this.store=e,this.available=!0}search(e){const t=D(this.store.getters["Files/files"],e,5).map((e=>({id:e.id,data:{...e}})));return Promise.resolve(t)}activate(){}}class be extends i.EventBus{id;label;previewSearch;store;router;constructor(e,t){super(),this.id="files.filter",this.label="Search current folder ↵",this.store=e,this.router=t,this.previewSearch=new _e(e)}activate(e){if(!e)return;const t=D(this.store.getters["Files/files"],e);this.publish("activate",{term:e,resources:t})}reset(){this.publish("reset")}updateTerm(e){this.publish("updateTerm",e)}get available(){return["files-personal"].includes(this.router.currentRoute.name)}}var xe,Se;class ye{component;cache;router;constructor(e){this.component=ve,this.router=e,this.cache=new y({ttl:1e4,capacity:100})}async search(t){if(!t)return;if(this.cache.has(t))return this.cache.get(t);const s=await $.owncloudSdk.files.search(t,5,a.DavProperties.Default);return this.cache.set(t,s.map((t=>{const s=e.buildResource(t);return{id:s.id,data:s}})))}get available(){return"search-provider-list"!==this.router.currentRoute.name}activate(){}}t.__decorate([(xe=500,function(e,s,i){const a=i.value,r=t.debounce((async function(e,...t){try{const s=await a.apply(this,t);e.resolve(s)}catch(t){e.reject(t)}}),xe,Se);i.value=function(...e){return new Promise(((t,s)=>{r.apply(this,[{resolve:t,reject:s},...e])}))}})],ye.prototype,"search",null);const we=(e,s)=>{const i=t.getCurrentInstance().proxy.$router;return t.customRef(((t,a)=>(i.afterEach(((t,s)=>t.query[e]!==s.query[e]&&a())),{get:()=>(t(),i.currentRoute.query[e]||s),async set(t){i.currentRoute.query[e]!==t&&(await i.replace({query:{...i.currentRoute.query,[e]:t}}),a())}})))},Ce=()=>t.getCurrentInstance().proxy.$store,Ee=(e,s,i)=>{let a;t.onMounted((()=>{a=Ce().subscribe((t=>e.includes(t.type)&&s(t)),i)})),t.onBeforeUnmount((()=>a()))};let ke;const $e=()=>ke||(ke={pagination:{perPage:t.customRef(((e,t)=>({get:()=>(e(),window.localStorage.getItem("oc_filesPageLimit")||"100"),set(e){window.localStorage.setItem("oc_filesPageLimit",e),t()}})))}},ke),Fe=()=>{const e=Ce(),s=t.ref(0),i=async()=>{await t.nextTick();const e=document.querySelector("#files-app-bar"),i=e?e.getBoundingClientRect().height:0;s.value!==i&&(s.value=i)};return window.onresize=i,t.onMounted(i),t.watch((()=>e.getters["Files/inProgress"].length>0),i),{y:s,refresh:i}};function Re(e){const s=t.ref(e.page),i=t.ref(e.perPage),a=t.computed((()=>Math.ceil(t.unref(e.items).length/i.value)||1));return{items:t.computed((()=>{if(!t.unref(i))return t.unref(e.items);const a=(s.value-1)*i.value,r=a+i.value;return t.unref(t.unref(e.items)).slice(a,r)})),total:a}}var Te;function Ie(e){const s=t.ref(e.sortBy),i=t.ref(e.sortDir),a=t.computed((()=>t.unref(s)||Pe(t.unref(o)))),r=t.computed((()=>t.unref(i)||De(t.unref(a),t.unref(o)))),o=e.fields;return{items:t.computed((()=>t.unref(a)?Le(t.unref(e.items),t.unref(o),t.unref(a),t.unref(r)):t.unref(e.items))),sortBy:a,sortDir:r,handleSort:({sortBy:e,sortDir:t})=>{s.value=e,i.value=t}}}!function(e){e.Desc="desc",e.Asc="asc"}(Te||(Te={}));const Pe=e=>{const t=e.filter((e=>e.sortable)).map((e=>e.name));return t?t[0]:null},De=(e,t)=>{const s=t.find((t=>t.name===e));return s&&s.sortDir?s.sortDir:Te.Desc},Le=(e,t,s,i)=>{const a=t.find((e=>e.name===s));if(!a)return e;const{sortable:r}=a;if("name"===s){const t=[...e.filter((e=>"folder"===e.type))].sort(((e,t)=>Ae(e,t,s,i,r))),a=[...e.filter((e=>"folder"!==e.type))].sort(((e,t)=>Ae(e,t,s,i,r)));return i===Te.Asc?t.concat(a):a.concat(t)}return[...e].sort(((e,t)=>Ae(e,t,s,i,r)))},Ae=(e,t,s,i,a)=>{let r=e[s],o=t[s];const n=i===Te.Asc?1:-1;if(a)if("string"==typeof a){const e=e=>e.map((e=>e[a])).join("");r=e(r),o=e(o)}else"function"==typeof a&&(r=a(r),o=a(o));if(!isNaN(r)&&!isNaN(o))return(r-o)*n;const l=navigator.language;return r.toString().localeCompare(o.toString(),l,{sensitivity:"base"})*n};const Oe={name:"NoContentMessage",props:{icon:{type:String,required:!0}}};var Ne=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"uk-height-1-1 uk-flex uk-flex-column uk-flex-center uk-flex-middle uk-text-center"},[s("oc-icon",{attrs:{name:e.icon,type:"div",size:"xxlarge"}}),e._v(" "),s("div",{staticClass:"oc-text-muted uk-text-large"},[e._t("message")],2),e._v(" "),s("div",{staticClass:"oc-text-muted"},[e._t("callToAction")],2)],1)};Ne._withStripped=!0;const Me=t.normalizeComponent({render:Ne,staticRenderFns:[]},undefined,Oe,undefined,false,undefined,!1,void 0,void 0,void 0),Ue=e=>t.DateTime_1.fromRFC2822(e).toUTC().valueOf(),ze=e=>e?[{name:"name",sortable:!0,sortDir:Te.Asc},{name:"size",sortable:!0,sortDir:Te.Desc},{name:"sharedWith",sortable:e=>e.length>0&&e[0].displayName,sortDir:Te.Asc},{name:"owner",sortable:"displayName",sortDir:Te.Asc},{name:"mdate",sortable:e=>Ue(e),sortDir:Te.Desc},{name:"sdate",sortable:e=>Ue(e),sortDir:Te.Desc},{name:"ddate",sortable:e=>Ue(e),sortDir:Te.Desc}].filter((t=>Object.prototype.hasOwnProperty.call(e,t.name))):[];const Be={model:{prop:"selection",event:"select"},props:{resources:{type:Array,required:!0},resourceDomSelector:{type:Function,required:!1,default:e=>e.id.replace(/[^A-Za-z0-9\-_]/g,"")},arePathsDisplayed:{type:Boolean,required:!1,default:!1},areThumbnailsDisplayed:{type:Boolean,required:!1,default:!0},selection:{type:Array,default:()=>[]},hasActions:{type:Boolean,required:!1,default:!0},targetRoute:{type:Object,required:!1,default:null},areResourcesClickable:{type:Boolean,required:!1,default:!0},headerPosition:{type:Number,required:!1,default:0},isSelectable:{type:Boolean,required:!1,default:!0},disabled:{type:[String,Array],required:!1,default:null},paddingX:{type:String,required:!1,default:"small",validator:e=>/(xsmall|small|medium|large|xlarge)/.test(e)},dragDrop:{type:Boolean,required:!1,default:!1},hover:{type:Boolean,required:!1,default:!1},sortBy:{type:String,required:!1,default:void 0},sortDir:{type:String,required:!1,default:void 0,validator:e=>void 0===e||[Te.Asc,Te.Desc].includes(e)}},data:()=>({constants:{EVENT_TROW_MOUNTED:"rowMounted"}}),computed:{popperOptions:()=>({modifiers:[t.maxSize,{name:"applyMaxSize",enabled:!0,phase:"beforeWrite",requires:["maxSize"],fn({state:e}){const{height:t}=e.modifiersData.maxSize;e.styles.popper.overflowY="auto",e.styles.popper.maxHeight=t-5+"px"}}]}),fields(){if(0===this.resources.length)return[];const e=this.resources[0],t=[];this.isSelectable&&t.push({name:"select",title:"",type:"slot",headerType:"slot",width:"shrink"});const s=ze(e);return t.push(...[{name:"name",title:this.$gettext("Name"),type:"slot",width:"expand",wrap:"truncate"},{name:"size",title:this.$gettext("Size"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"sharedWith",title:this.$gettext("Shared with"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"status",title:this.$gettext("Status"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"owner",title:this.$gettext("Share owner"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"mdate",title:this.$gettext("Modified"),type:"slot",alignH:"right",wrap:"nowrap",accessibleLabelCallback:e=>this.formatDateRelative(e.mdate)+" ("+this.formatDate(e.mdate)+")"},{name:"sdate",title:this.$gettext("Shared on"),type:"slot",alignH:"right",wrap:"nowrap",accessibleLabelCallback:e=>this.formatDateRelative(e.sdate)+" ("+this.formatDate(e.sdate)+")"},{name:"ddate",title:this.$gettext("Deleted"),type:"slot",alignH:"right",wrap:"nowrap",accessibleLabelCallback:e=>this.formatDateRelative(e.ddate)+" ("+this.formatDate(e.ddate)+")"}].filter((t=>Object.prototype.hasOwnProperty.call(e,t.name))).map((e=>{const t=s.find((t=>t.name===e.name));return t&&Object.assign(e,{sortable:t.sortable,sortDir:t.sortDir}),e}))),this.hasActions&&t.push({name:"actions",title:this.$gettext("Actions"),type:"slot",alignH:"right",wrap:"nowrap"}),t},areAllResourcesSelected(){return this.selection.length===this.resources.length},selectedIds(){return this.selection.map((e=>e.id))},allResourcesCheckboxLabel(){return this.$gettext("Select all resources")},contextMenuLabel(){return this.$gettext("Show context menu")},currentLanguage(){return(this.$language?.current||"").split("_")[0]}},methods:{fileDragged(e){this.addSelectedResource(e)},fileDropped(e){this.$emit("fileDropped",e)},sort(e){this.$emit("sort",e)},addSelectedResource(e){this.selection.some((t=>t.id===e.id))?this.$emit("select",this.selection):this.$emit("select",this.selection.concat([e]))},resetDropPosition(e,t,s){const i=this.$refs[e].tippy;void 0!==i&&(this.selection.includes(s)||this.emitSelect([s]),this.displayPositionedDropdown(i,t))},showContextMenu(e,t,s){t.preventDefault();const i=e.$el.getElementsByClassName("resource-table-btn-action-dropdown")[0];void 0!==i&&(this.selection.includes(s)||this.emitSelect([s]),this.displayPositionedDropdown(i._tippy,t))},displayPositionedDropdown(e,t){e.setProps({getReferenceClientRect:()=>({width:0,height:0,top:t.clientY,bottom:t.clientY,left:t.clientX,right:t.clientX})}),e.show()},rowMounted(e,t){this.$emit("rowMounted",e,t)},fileClicked(e){this.emitSelect([e])},formatDate(e){return t.DateTime_1.fromJSDate(new Date(e)).setLocale(this.currentLanguage).toLocaleString(t.DateTime_1.DATETIME_FULL)},formatDateRelative(e){return t.DateTime_1.fromJSDate(new Date(e)).setLocale(this.currentLanguage).toRelative()},emitSelect(e){this.$emit("select",e)},toggleSelectionAll(){if(this.areAllResourcesSelected)return this.emitSelect([]);this.emitSelect(this.resources)},emitFileClick(e){this.$emit("fileClick",e)},isResourceClickable(e){return!!this.areResourcesClickable&&(Array.isArray(this.disabled)?!this.disabled.includes(e):this.disabled!==e)},getResourceCheckboxLabel(e){return"folder"===e.type?this.$gettext("Select folder"):this.$gettext("Select file")},getSharedWithAvatarDescription(e){const t="folder"===e.type?this.$gettext("folder"):this.$gettext("file"),s=e.sharedWith.filter((e=>!e.link)).length,i=e.sharedWith.filter((e=>!!e.link)).length,a=[s>0?this.$ngettext("This %{ resourceType } is shared via %{ shareCount } invite","This %{ resourceType } is shared via %{ shareCount } invites",s):"",i>0?this.$ngettext("This %{ resourceType } is shared via %{ linkCount } link","This %{ resourceType } is shared via %{ linkCount } links",i):""].join(" ");return this.$gettextInterpolate(a,{resourceType:t,shareCount:s,linkCount:i})},getOwnerAvatarDescription(e){const t=this.$gettext("This %{ resourceType } is owned by %{ ownerName }"),s="folder"===e.type?this.$gettext("folder"):this.$gettext("file");return this.$gettextInterpolate(t,{resourceType:s,ownerName:e.owner[0].displayName})}}};var Ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-table",{attrs:{data:e.resources,fields:e.fields,highlighted:e.selectedIds,disabled:e.disabled,sticky:!0,"header-position":e.headerPosition,"drag-drop":e.dragDrop,hover:e.hover,"item-dom-selector":e.resourceDomSelector,selection:e.selection,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{highlight:e.fileClicked,rowMounted:e.rowMounted,contextmenuClicked:e.showContextMenu,itemDropped:e.fileDropped,itemDragged:e.fileDragged,sort:e.sort},scopedSlots:e._u([{key:"selectHeader",fn:function(){return[s("div",{staticClass:"resource-table-select-all"},[s("oc-checkbox",{attrs:{id:"resource-table-select-all",label:e.allResourcesCheckboxLabel,"hide-label":!0,value:e.areAllResourcesSelected},on:{input:e.toggleSelectionAll}})],1)]},proxy:!0},{key:"select",fn:function(t){var i=t.item;return[s("oc-checkbox",{attrs:{id:"resource-table-select-"+e.resourceDomSelector(i),label:e.getResourceCheckboxLabel(i),"hide-label":!0,size:"large",value:e.selection,option:i},on:{input:e.emitSelect},nativeOn:{click:function(e){e.stopPropagation()}}})]}},{key:"name",fn:function(t){var i=t.item;return[s("oc-resource",{key:i.path+"-"+e.resourceDomSelector(i)+"-"+i.thumbnail,attrs:{resource:i,"is-path-displayed":e.arePathsDisplayed,"is-thumbnail-displayed":e.areThumbnailsDisplayed,"target-route":e.targetRoute,"is-resource-clickable":e.isResourceClickable(i.id)},on:{click:function(t){return e.emitFileClick(i)}}})]}},{key:"status",fn:function(t){var s=t.item;return[e._t("status",null,{resource:s})]}},{key:"sharedWith",fn:function(t){var i=t.item;return[s("oc-avatars",{staticClass:"resource-table-people",attrs:{items:i.sharedWith,stacked:!0,"max-displayed":3,"is-tooltip-displayed":!0,"accessible-description":e.getSharedWithAvatarDescription(i)}})]}},{key:"size",fn:function(e){var t=e.item;return[s("oc-resource-size",{attrs:{size:t.size}})]}},{key:"mdate",fn:function(t){var i=t.item;return[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.formatDate(i.mdate),expression:"formatDate(item.mdate)"}],attrs:{tabindex:"0"},domProps:{textContent:e._s(e.formatDateRelative(i.mdate))}})]}},{key:"sdate",fn:function(t){var i=t.item;return[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.formatDate(i.sdate),expression:"formatDate(item.sdate)"}],attrs:{tabindex:"0"},domProps:{textContent:e._s(e.formatDateRelative(i.sdate))}})]}},{key:"ddate",fn:function(t){var i=t.item;return[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.formatDate(i.ddate),expression:"formatDate(item.ddate)"}],attrs:{tabindex:"0"},domProps:{textContent:e._s(e.formatDateRelative(i.ddate))}})]}},{key:"owner",fn:function(t){var i=t.item;return[s("oc-avatars",{staticClass:"resource-table-people",attrs:{items:i.owner,"is-tooltip-displayed":!0,"accessible-description":e.getOwnerAvatarDescription(i)}})]}},{key:"actions",fn:function(t){var i=t.item;return[s("div",{staticClass:"resource-table-actions"},[e._t("quickActions",null,{resource:i}),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.contextMenuLabel,expression:"contextMenuLabel"}],staticClass:"resource-table-btn-action-dropdown",attrs:{id:"context-menu-trigger-"+e.resourceDomSelector(i),"aria-label":e.contextMenuLabel,appearance:"raw"},on:{click:function(t){t.stopPropagation(),t.preventDefault(),e.resetDropPosition("context-menu-drop-ref-"+e.resourceDomSelector(i),t,i)}}},[s("oc-icon",{attrs:{name:"more_vert"}})],1),e._v(" "),s("oc-drop",{ref:"context-menu-drop-ref-"+e.resourceDomSelector(i),attrs:{"drop-id":"context-menu-drop-"+e.resourceDomSelector(i),toggle:"#context-menu-trigger-"+e.resourceDomSelector(i),"popper-options":e.popperOptions,mode:"click","close-on-click":"","padding-size":"remove"},nativeOn:{click:function(e){e.stopPropagation(),e.preventDefault()}}},[e._t("contextMenu",null,{resource:i})],2)],2)]}},e.$slots.footer?{key:"footer",fn:function(){return[e._t("footer")]},proxy:!0}:null],null,!0)})};Ge._withStripped=!0;const Ve=t.normalizeComponent({render:Ge,staticRenderFns:[]},undefined,Be,undefined,false,undefined,!1,void 0,void 0,void 0);const qe={props:{files:{type:Number,required:!0},folders:{type:Number,required:!0},size:{type:[String,Number],required:!1,default:null}},computed:{items(){return this.files+this.folders},text(){const e=this.$gettextInterpolate(this.$ngettext("%{ filesCount } file","%{ filesCount } files",this.files),{filesCount:this.files}),s=this.$gettextInterpolate(this.$ngettext("%{ foldersCount } folder","%{ foldersCount } folders",this.folders),{foldersCount:this.folders}),i=t.getResourceSize(this.size),a=this.size>0?this.$ngettext("%{ itemsCount } item with %{ itemSize } in total (%{ filesStr}, %{foldersStr})","%{ itemsCount } items with %{ itemSize } in total (%{ filesStr}, %{foldersStr})",this.items):this.$ngettext("%{ itemsCount } item in total (%{ filesStr}, %{foldersStr})","%{ itemsCount } items in total (%{ filesStr}, %{foldersStr})",this.items);return this.$gettextInterpolate(a,{itemsCount:this.items,itemSize:i,filesStr:e,foldersStr:s})}}};var He=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"uk-text-nowrap uk-text-center"},[s("p",{staticClass:"oc-text-muted",attrs:{"data-testid":"files-list-footer-info","data-test-items":e.items,"data-test-files":e.files,"data-test-folders":e.folders,"data-test-size":e.size}},[e._v("\n    "+e._s(e.text)+"\n  ")])])};He._withStripped=!0;const We=t.normalizeComponent({render:He,staticRenderFns:[]},undefined,qe,undefined,false,undefined,!1,void 0,void 0,void 0);const je={props:{pages:{type:Number,required:!0},currentPage:{type:Number,required:!0}}};var Ye=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.pages>1?s("oc-pagination",{staticClass:"files-pagination uk-flex uk-flex-center oc-my-s",attrs:{pages:e.pages,"current-page":e.currentPage,"max-displayed":3,"current-route":e.$route}}):e._e()};Ye._withStripped=!0;const Qe=t.normalizeComponent({render:Ye,staticRenderFns:[]},undefined,je,undefined,false,undefined,!1,void 0,void 0,void 0);var Je={mounted(){const{filterSearch:e}=F;if(!e||!e.available)return;const t=e.subscribe("reset",(()=>{this.CLEAR_FILES_SEARCHED()})),s=e.subscribe("updateTerm",(e=>{e||this.CLEAR_FILES_SEARCHED()})),i=e.subscribe("activate",(({resources:e})=>{this.LOAD_FILES_SEARCHED(e)}));this.$on("beforeDestroy",(()=>{e.unsubscribe("reset",t),e.unsubscribe("updateTerm",s),e.unsubscribe("activate",i)}))},watch:{$route:{handler:function(e,t){e.name===t?.name&&e.params?.item===t?.params?.item||this.CLEAR_FILES_SEARCHED()},immediate:!0}},methods:{...t.mapMutations("Files",["CLEAR_FILES_SEARCHED","LOAD_FILES_SEARCHED"])}},Ke={methods:{scrollToResource(e){let t=document.querySelector("#files-app-bar").getBoundingClientRect().bottom;t+=document.querySelector(".files-table thead").getBoundingClientRect().height,this.$scrollTo(`.oc-tbody-tr-${e.id}`,300,{offset:-t})}}};const Xe=new pe;const Ze={components:{ListInfo:We,Pagination:Qe,NoContentMessage:Me,ResourceTable:Ve},mixins:[ue,Je,Ke],props:{searchResults:{type:Array,default:function(){return[]}}},setup(){const e=Ce(),{pagination:s}=$e(),i=we("page","1"),a=t.computed((()=>parseInt(String(i.value)))),r=we("items-per-page",s.perPage.value),{items:o,total:n}=Re({page:a,perPage:t.computed((()=>parseInt(String(r.value)))),items:t.computed((()=>e.getters["Files/activeFiles"]))});return{paginatedResources:o,paginationPages:n,paginationPage:a}},computed:{...t.mapGetters(["configuration"]),...t.mapGetters("Files",["totalFilesCount","totalFilesSize"]),displayThumbnails(){return!this.configuration.options.disablePreviews}},watch:{searchResults:{handler:function(){this.CLEAR_CURRENT_FILES_LIST(),this.LOAD_FILES({currentFolder:null,files:this.searchResults.length?this.searchResults.map((e=>e.data)):[]})},immediate:!0}},beforeDestroy(){Xe.disconnect()},methods:{...t.mapMutations("Files",["CLEAR_CURRENT_FILES_LIST","LOAD_FILES"]),...t.mapActions("Files",["loadPreview"]),rowMounted(e,s){if(!this.displayThumbnails)return;const i=t.debounce((({unobserve:t})=>{t(),this.loadPreview({resource:e,isPublic:!1,dimensions:A.Thumbnail,type:O.Thumbnail})}),250);Xe.observe(s.$el,{onEnter:i,onExit:i.cancel})}}};var et=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"files-search-result"},[e.paginatedResources.length?s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!1},attrs:{resources:e.paginatedResources,"target-route":{name:"files-personal"},"are-paths-displayed":!0,"are-thumbnails-displayed":e.displayThumbnails,"has-actions":!1,"is-selectable":!1},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted},scopedSlots:e._u([{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"uk-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}])}):s("no-content-message",{staticClass:"files-empty",attrs:{icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("p",{staticClass:"oc-text-muted"},[e.$route.query.term?s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("No resource found")]):s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("No search term entered")])])]},proxy:!0}],null,!1,390334571)})],1)};et._withStripped=!0;const tt=t.normalizeComponent({render:et,staticRenderFns:[]},undefined,Ze,undefined,false,undefined,!1,void 0,void 0,void 0);class st{component;constructor(){this.component=tt}async search(t){if(!t)return[];return(await $.owncloudSdk.files.search(t,void 0,a.DavProperties.Default)).map((t=>{const s=e.buildResource(t);return{id:s.id,data:s}}))}}class it extends i.EventBus{id;label;previewSearch;listSearch;store;router;constructor(e,t){super(),this.id="files.sdk",this.label="Search all files ↵",this.previewSearch=new ye(t),this.listSearch=new st,this.store=e,this.router=t}activate(e){const t="search-provider-list";(e||this.router.currentRoute.name===t)&&this.router.push({name:t,query:{term:e,provider:this.id}}).catch((()=>{}))}reset(){}updateTerm(){}get available(){const{hideSearchBar:e}=this.store.getters["Search/options"];return!t.get(this.store,"state.config.options.hideSearchBar",e)}}var at={filters:{roundNumber:e=>parseInt(e.toFixed(0))},data:()=>({uploadQueue:new t._default({concurrency:1}),directoryQueue:new t._default({concurrency:1}),uploadFileUniqueId:0,existingResources:[]}),computed:{...t.mapGetters("Files",["files","highlightedFile","publicLinkPassword","currentFolder"]),...t.mapGetters(["getToken","capabilities","configuration"])},methods:{...t.mapActions("Files",["resetSearch","addFileToProgress","removeFileSelection","removeFileFromProgress"]),...t.mapActions(["showMessage","createModal","hideModal"]),formDateFromJSDate(e,s=t.DateTime_1.DATETIME_FULL){return t.DateTime_1.fromJSDate(e).setLocale(this.$language.current).toLocaleString(s)},formDateFromHTTP(e,s=t.DateTime_1.DATETIME_FULL){return t.DateTime_1.fromHTTP(e).setLocale(this.$language.current).toLocaleString(s)},formDateFromISO(e,s=t.DateTime_1.DATETIME_FULL){return t.DateTime_1.fromISO(e).setLocale(this.$language.current).toLocaleString(s)},formDateFromRFC(e,s=t.DateTime_1.DATETIME_FULL){return t.DateTime_1.fromRFC2822(e).setLocale(this.$language.current).toLocaleString(s)},formRelativeDateFromJSDate(e){return t.DateTime_1.fromJSDate(e).setLocale(this.$language.current).toRelative()},formRelativeDateFromHTTP(e){return t.DateTime_1.fromHTTP(e).setLocale(this.$language.current).toRelative()},formRelativeDateFromISO(e){return t.DateTime_1.fromISO(e).setLocale(this.$language.current).toRelative()},formRelativeDateFromRFC(e){return t.DateTime_1.fromRFC2822(e).setLocale(this.$language.current).toRelative()},delayForScreenreader(e,t=500){setTimeout((()=>e()),t)},fileTypeIcon(t){if(t){if("folder"===t.type)return"folder";if("string"==typeof t.extension){const s=e.fileTypeIconMappings[t.extension.toLowerCase()];if(s)return`${s}`}}return"file"},checkIfBrowserSupportsFolderUpload(){const e=document.createElement("input");return e.type="file",void 0!==e.webkitdirectory||void 0!==e.mozdirectory||void 0!==e.directory},checkIfElementExists(e){const t=e.name||e;return this.files.find((e=>e.name===t))},processDirectoryEntryRecursively(e){return this.$client.files.createFolder(this.rootPath+e.fullPath).then((()=>{const t=e.createReader(),s=this;t.readEntries((function(e){e.forEach((function(e){e.isDirectory?s.processDirectoryEntryRecursively(e):e.file((t=>{s.$_ocUpload(t,e.fullPath,null,!1)}))}))}))}))},hideOverwriteDialog(){this.existingResources=[],this.hideModal()},confirmOverwrite(){for(const e of this.existingResources)this.$_ocUpload(e.file,e.path,e.etag);this.hideOverwriteDialog()},displayOverwriteDialog(){const e=this.$gettext("File %{file} already exists"),t=!this.publicPage()&&this.capabilities.files&&this.capabilities.files.versioning,s={variation:t?"passive":"danger",icon:"cloud_upload",title:this.existingResources.length>1?this.$gettext("Multiple files already exists"):this.$gettextInterpolate(e,{file:this.existingResources[0].file.name},!0),message:t?this.$gettext("Do you want to create a new version?"):this.$gettext("Do you want to overwrite it?"),cancelText:this.$gettext("Cancel"),confirmText:t?this.$gettext("Create"):this.$gettext("Overwrite"),onCancel:this.hideOverwriteDialog,onConfirm:this.confirmOverwrite};this.createModal(s)},$_ocUpload_addDropToQueue(e){const t=e.dataTransfer.items||e.dataTransfer.files,s=[];if(t instanceof FileList)this.$_ocUpload_addDirectoryToQueue(e);else{for(let e of t){e=e.webkitGetAsEntry();const t=this.checkIfElementExists(e);if(e.isDirectory){if(t){this.showMessage({title:this.$gettextInterpolate(this.$gettext("Folder %{folder} already exists."),{folder:e.name},!0),status:"danger",autoClose:{enabled:!0}});continue}this.processDirectoryEntryRecursively(e).then((()=>{this.$emit("success",null,e.name)}))}else t?s.push(new Promise((s=>{e.file((i=>{this.existingResources.push({file:i,path:e.fullPath,etag:t.etag}),s()}))}))):e.file((t=>{this.$_ocUpload(t,e.fullPath)}))}s.length>0&&Promise.all(s).then((()=>{this.displayOverwriteDialog()}))}},$_ocUpload_addFileToQueue(e){const t=e.target.files;if(!(t.length<1)){for(let e=0;e<t.length;e++){const s=this.checkIfElementExists(t[e]);s?this.existingResources.push({file:t[e],path:t[e].name,etag:s.etag}):this.$_ocUpload(t[e],t[e].name)}this.$_ocUploadInput_clean(),this.existingResources.length>0&&this.displayOverwriteDialog()}},$_ocUpload_addDirectoryToQueue(e){if(this.isIE11())return void this.showMessage({title:this.$gettext("Upload failed"),desc:this.$gettext("Upload of a folder is not supported in Internet Explorer."),status:"danger",autoClose:{enabled:!0}});const s=e.target.files||e.dataTransfer.files;if(!s.length)return;let i=s[0].webkitRelativePath.replace("/"+s[0].name,"");const a=i.split("/")[0];if(this.checkIfElementExists(a))this.showMessage({title:this.$gettextInterpolate(this.$gettext("Folder %{folder} already exists."),{folder:a},!0),status:"danger",autoClose:{enabled:!0}});else{const e=[];for(const a of s){if(this.$_addFileToUploadProgress(a),i=a.webkitRelativePath.replace("/"+a.name,""),e.indexOf(i)>-1)continue;const s=i.split("/");for(let i=0;i<s.length;i++){if(0===i){-1===e.indexOf(s[0])&&e.push(s[0]);continue}const a=`${t.pathUtil.join.apply(null,s.slice(0,i))}/${s[i]}`;-1===e.indexOf(a)&&e.push(a)}}const a=[],r=e[0];for(const t of e){let e;e=this.publicPage()?this.directoryQueue.add((()=>this.$client.publicFiles.createFolder(this.rootPath,t,this.publicLinkPassword))):this.directoryQueue.add((()=>this.$client.files.createFolder(this.rootPath+t))),a.push(e)}const o=[];Promise.all(a).then((()=>{for(const e of s)o.push(this.$_ocUpload(e,e.webkitRelativePath,null,!1,!1));Promise.all(o).then((()=>{this.$emit("success",null,r),this.$_ocUploadInput_clean()}))}))}},$_addFileToUploadProgress(e){e.id=this.uploadFileUniqueId,this.uploadFileUniqueId++,this.addFileToProgress(e)},$_ocUpload(e,s,i=null,a=!0,r=!0){this.$root.$emit("upload-start");let o,n=this.path||"",l=s;if(r&&this.$_addFileToUploadProgress(e),this.publicPage()){const s=n.indexOf("/"),a=n.substr(0,s);n=n.substr(s+1)||"",l=t.pathUtil.join(n,l);const r={};e.lastModifiedDate?r["X-OC-Mtime"]=""+e.lastModifiedDate.getTime()/1e3:e.lastModified&&(r["X-OC-Mtime"]=""+e.lastModified/1e3),o=this.uploadQueue.add((()=>this.$client.publicFiles.putFileContents(a,l,this.publicLinkPassword,e,{headers:r,onProgress:t=>{this.$_ocUpload_onProgress(t,e)},overwrite:i})))}else if(n=this.path||"",l=t.pathUtil.join(n,l),this.browserSupportsChunked&&this.currentFolder.isChunkedUploadSupported){let s=this.configuration.uploadChunkSize;this.capabilities.files.tus_support.max_chunk_size>0&&(null===s||0===s||s>this.capabilities.files.tus_support.max_chunk_size)&&(s=this.capabilities.files.tus_support.max_chunk_size),o=this.uploadQueue.add((()=>this.uploadChunkedFile(e,t.pathUtil.dirname(l),{chunkSize:s,overridePatchMethod:!!this.capabilities.files.tus_support.http_method_override,emitProgress:t=>{this.$_ocUpload_onProgress(t,e)}})))}else{const t={};e.lastModifiedDate?t["X-OC-Mtime"]=""+e.lastModifiedDate.getTime()/1e3:e.lastModified&&(t["X-OC-Mtime"]=""+e.lastModified/1e3),o=this.uploadQueue.add((()=>this.$client.files.putFileContents(l,e,{headers:t,onProgress:t=>{this.$_ocUpload_onProgress(t,e)},overwrite:i})))}o.then((t=>{this.$root.$emit("upload-end"),this.removeFileFromProgress(e),a&&this.$emit("success",t,e)})).catch((t=>{this.removeFileFromProgress(e),this.$emit("error",t)}))},$_ocUpload_onProgress(e,t){const s=parseInt(100*e.loaded/e.total);this.$emit("progress",{id:t.id,fileName:t.name,progress:s})},$_ocUploadInput_clean(){const e=this.$refs.input;e&&(e.value="")}}},rt={methods:{getResourceSize(e){if(e<0)return"";if(isNaN(e))return"?";return t.filesize_min(e,{round:e<1048576?0:1})}}},ot={computed:{isPersonalRoute(){return V(this.$route)},isFavoritesRoute(){return"files-favorites"===this.$route.name},isTrashbinRoute(){return q(this.$route)},isSharedWithMeRoute(){return H(this.$route)},isSharedWithOthersRoute(){return W(this.$route)},isAnySharedWithRoute(){return H(e=this.$route)||W(e);var e},isPublicFilesRoute(){return j(this.$route)},isPublicPage(){return!!(e=this.$route).meta&&!1===e.meta.auth;var e}}};const nt={name:"FileDetails",mixins:[at,rt,ot],title:e=>e("Details"),inject:["displayedItem"],data:()=>({loading:!1,sharedByName:"",sharedByDisplayName:"",sharedTime:0,sharedParentDir:null,sharedItem:null}),computed:{...t.mapGetters("Files",["versions","sharesTree","sharesTreeLoading"]),...t.mapGetters(["user","getToken","configuration"]),file(){return this.displayedItem.value},hasContent(){return this.hasTimestamp||this.ownerDisplayName||this.showSize||this.showShares||this.showVersions},noContentText(){return this.$gettext("No information to display")},detailsTableLabel(){return this.$gettext("Overview of the information about the selected file")},shareDateLabel(){return this.$gettext("Shared:")},sharedViaLabel(){return this.$gettext("Shared via:")},sharedViaTooltip(){return this.$gettextInterpolate(this.$gettext("Navigate to '%{folder}'"),{folder:this.sharedParentDir||""},!0)},sharedParentRoute(){return{name:"files-personal",params:{item:this.sharedParentDir||"/"}}},showSharedBy(){return this.showShares&&!this.ownedByCurrentUser&&!this.sharesTreeLoading&&this.sharedByDisplayName&&this.sharedByName!==this.file.ownerId},showSharedVia(){return this.showShares&&!this.sharesTreeLoading&&this.file.path!==this.sharedParentDir&&null!==this.sharedParentDir},showShares(){return this.hasAnyShares&&!this.isPublicPage},detailSharingInformation(){return"folder"===this.file.type?this.$gettext("This folder has been shared."):this.$gettext("This file has been shared.")},peopleSharesLabel(){return this.$gettext("Show invited people")},linkSharesLabel(){return this.$gettext("Show links")},sharedByLabel(){return this.$gettext("Shared by:")},hasTimestamp(){return this.file.mdate?.length>0},timestampTitle(){return this.$gettext("Last modified:")},ownerTitle(){return this.$gettext("Owner:")},ownerDisplayName(){return this.file.ownerDisplayName||this.file.shareOwnerDisplayname||this.file.owner?.[0].displayName},ownerAdditionalInfo(){return this.file.owner?.[0].additionalInfo},showSize(){return"?"!==this.getResourceSize(this.file.size)},sizeTitle(){return this.$gettext("Size:")},showVersions(){if("folder"!==this.file.type)return this.versions.length>0&&!this.isPublicPage},versionsTitle(){return this.$gettext("Versions:")},seeVersionsLabel(){return this.$gettext("See all versions")},capitalizedTimestamp(){const e=this.formDateFromHTTP(this.file.mdate);return t.upperFirst(e)},hasAnyShares(){return this.file.shareTypes?.length>0||this.file.indicators?.length>0||null!==this.sharedItem},hasPeopleShares(){return e.ShareTypes.containsAnyValue(e.ShareTypes.authenticated,this.file.shareTypes)||this.file.indicators?.filter((e=>"group"===e.icon)).length>0||null!==this.sharedItem},hasLinkShares(){return e.ShareTypes.containsAnyValue(e.ShareTypes.unauthenticated,this.file.shareTypes)||this.file.indicators?.filter((e=>"link"===e.icon)).length>0},ownedByCurrentUser(){return this.file.ownerId===this.user.id||this.file.owner?.[0].username===this.user.id||this.file.shareOwner===this.user.id}},watch:{file(){this.loadData(),this.refreshShareDetailsTree()},sharesTree(){this.sharedItem=null;const t=this.getParentSharePath(this.file.path,this.sharesTree);if(null===t)return;const s=this.sharesTree[t]?.filter((t=>e.ShareTypes.containsAnyValue(e.ShareTypes.individuals,[t.shareType])));0!==s.length&&(this.sharedItem=s[0],this.sharedByName=this.sharedItem.owner?.name,this.sharedByDisplayName=this.sharedItem.owner?.displayName,this.sharedItem.owner?.additionalInfo&&(this.sharedByDisplayName+=" ("+this.sharedItem.owner.additionalInfo+")"),this.sharedTime=this.sharedItem.stime,this.sharedParentDir=t)}},mounted(){this.loadData(),this.refreshShareDetailsTree()},asyncComputed:{preview:{async get(){return await new Promise((e=>setTimeout(e,500))),P({resource:this.file,isPublic:this.isPublicPage,dimensions:A.Preview,server:this.configuration.server,userId:this.user.id,token:this.getToken})},lazy:!0,watch:["file.id"]}},methods:{...t.mapActions("Files",["loadPreview","loadVersions","loadSharesTree"]),...t.mapActions("Files/sidebar",{setSidebarPanel:"setActivePanel"}),refreshShareDetailsTree(){this.loadSharesTree({client:this.$client,path:this.file.path,$gettext:this.$gettext})},getParentSharePath(e,s){let i=e;if(!i)return null;for(;"/"!==i;){const e=s[i];if(void 0!==e&&void 0!==e[0])return i;i=t.pathUtil.dirname(i)}return null},expandPeoplesPanel(){this.setSidebarPanel("sharing-item")},expandLinksPanel(){this.setSidebarPanel("links-item")},expandVersionsPanel(){this.setSidebarPanel("versions-item")},async loadData(){this.loading=!0;const e=[];"file"!==this.file.type||this.isPublicPage||e.push(this.loadVersions({client:this.$client,fileId:this.file.id})),await Promise.all(e.map((e=>e.catch((e=>e))))),this.loading=!1}}};var lt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-file-details-sidebar"}},[e.hasContent?s("div",[e.file.thumbnail?s("div",{key:"file-thumbnail",staticClass:"details-preview uk-flex uk-flex-middle uk-flex-center oc-mb",style:{"background-image":e.$asyncComputed.preview.updating?"none":"url("+e.preview+")"},attrs:{"data-testid":"preview"}},[e.$asyncComputed.preview.updating?s("oc-spinner"):e._e()],1):e._e(),e._v(" "),e.showShares?s("div",{key:"file-shares",staticClass:"uk-flex uk-flex-middle oc-my-m",attrs:{"data-testid":"sharingInfo"}},[e.hasPeopleShares?s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.peopleSharesLabel,expression:"peopleSharesLabel"}],staticClass:"oc-mr-xs",attrs:{appearance:"raw","aria-label":e.peopleSharesLabel},on:{click:e.expandPeoplesPanel}},[s("oc-icon",{attrs:{name:"group"}})],1):e._e(),e._v(" "),e.hasLinkShares?s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.linkSharesLabel,expression:"linkSharesLabel"}],staticClass:"oc-mr-xs",attrs:{appearance:"raw","aria-label":e.linkSharesLabel},on:{click:e.expandLinksPanel}},[s("oc-icon",{attrs:{name:"link"}})],1):e._e(),e._v(" "),s("p",{staticClass:"oc-my-rm oc-mx-s",domProps:{textContent:e._s(e.detailSharingInformation)}})],1):e._e(),e._v(" "),s("table",{staticClass:"details-table",attrs:{"aria-label":e.detailsTableLabel}},[e.hasTimestamp?s("tr",{attrs:{"data-testid":"timestamp"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.timestampTitle)}}),e._v(" "),s("td",[e.showVersions?s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.seeVersionsLabel,expression:"seeVersionsLabel"}],attrs:{appearance:"raw","aria-label":e.seeVersionsLabel},domProps:{textContent:e._s(e.capitalizedTimestamp)},on:{click:e.expandVersionsPanel}}):s("span",{domProps:{textContent:e._s(e.capitalizedTimestamp)}})],1)]):e._e(),e._v(" "),e.showSharedVia?s("tr",{attrs:{"data-testid":"shared-via"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.sharedViaLabel)}}),e._v(" "),s("td",[s("router-link",{attrs:{to:e.sharedParentRoute}},[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.sharedViaTooltip,expression:"sharedViaTooltip"}],domProps:{textContent:e._s(e.sharedParentDir)}})])],1)]):e._e(),e._v(" "),e.showSharedBy?s("tr",{attrs:{"data-testid":"shared-by"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.sharedByLabel)}}),e._v(" "),s("td",[s("span",{domProps:{textContent:e._s(e.sharedByDisplayName)}})])]):e._e(),e._v(" "),e.ownerDisplayName?s("tr",{attrs:{"data-testid":"ownerDisplayName"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.ownerTitle)}}),e._v(" "),s("td",[s("p",{staticClass:"oc-m-rm"},[e._v("\n            "+e._s(e.ownerDisplayName)+"\n            "),e.ownedByCurrentUser?s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("(me)")]):e._e(),e._v(" "),!e.ownedByCurrentUser&&e.ownerAdditionalInfo?s("span",[e._v("("+e._s(e.ownerAdditionalInfo)+")")]):e._e()])])]):e._e(),e._v(" "),e.showSize?s("tr",{attrs:{"data-testid":"sizeInfo"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.sizeTitle)}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.getResourceSize(e.file.size))}})]):e._e(),e._v(" "),e.showVersions?s("tr",{attrs:{"data-testid":"versionsInfo"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.versionsTitle)}}),e._v(" "),s("td",[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.seeVersionsLabel,expression:"seeVersionsLabel"}],attrs:{appearance:"raw","aria-label":e.seeVersionsLabel},domProps:{textContent:e._s(e.versions.length)},on:{click:e.expandVersionsPanel}})],1)]):e._e()])]):s("p",{attrs:{"data-testid":"noContentText"},domProps:{textContent:e._s(e.noContentText)}})])};lt._withStripped=!0;const ct=t.normalizeComponent({render:lt,staticRenderFns:[]},undefined,nt,"data-v-a49314ca",false,undefined,!1,void 0,void 0,void 0);const dt={name:"FileDetailsMultiple",mixins:[at,rt,ot],title:e=>e("Details"),computed:{...t.mapGetters("Files",["selectedFiles"]),selectedFilesCount(){return this.selectedFiles.length},selectedFilesString(){return this.$gettextInterpolate(this.$ngettext("%{ itemCount } item selected","%{ itemCount } items selected",this.selectedFilesCount),{itemCount:this.selectedFilesCount})},sizeValue(){let e=0;return this.selectedFiles.forEach((t=>e+=parseInt(t.size))),this.getResourceSize(e)},showSize(){return"?"!==this.getResourceSize(this.selectedFiles[0].size)},sizeText(){return this.$gettext("Size")},filesCount(){return this.selectedFiles.filter((e=>"file"===e.type)).length},filesText(){return this.$gettext("Files")},foldersCount(){return this.selectedFiles.filter((e=>"folder"===e.type)).length},foldersText(){return this.$gettext("Folders")},detailsTableLabel(){return this.$gettext("Overview of the information about the selected files")}}};var ut=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-file-details-multiple-sidebar"}},[s("div",{staticClass:"files-preview oc-mb"},[s("div",{staticClass:"files-preview-body"},[s("oc-icon",{staticClass:"preview-icon",attrs:{size:"xxlarge",variation:"passive",name:"file_copy"}}),e._v(" "),s("p",{staticClass:"preview-text",attrs:{"data-testid":"selectedFilesText"},domProps:{textContent:e._s(e.selectedFilesString)}})],1)]),e._v(" "),s("div",[s("table",{staticClass:"details-table",attrs:{"aria-label":e.detailsTableLabel}},[s("tr",{attrs:{"data-testid":"filesCount"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.filesText)}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.filesCount)}})]),e._v(" "),s("tr",{attrs:{"data-testid":"foldersCount"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.foldersText)}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.foldersCount)}})]),e._v(" "),e.showSize?s("tr",{attrs:{"data-testid":"size"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.sizeText)}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.sizeValue)}})]):e._e()])])])};ut._withStripped=!0;const ht=t.normalizeComponent({render:ut,staticRenderFns:[]},undefined,dt,"data-v-6ae4f463",false,undefined,!1,void 0,void 0,void 0);const pt={name:"ActionMenuItem",props:{action:{type:Object,required:!0},items:{type:Array,required:!0},appearance:{type:String,default:"raw"}},computed:{filterParams(){return{resources:this.items}}},methods:{getComponentProps(e,t){return"router-link"===e.componentType&&e.route?{to:{name:e.route,params:{item:t.map((e=>e.path))}}}:{appearance:this.appearance,...e.isDisabled&&{disabled:e.isDisabled()},...e.variation&&{variation:e.variation}}},getComponentListeners(e,t){if("function"!=typeof e.handler||"oc-button"!==e.componentType)return{};const s=()=>e.handler({resources:t,...e.handlerData});return e.keepOpen?{click:e=>{e.stopPropagation(),s()}}:{click:s}}}};var mt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",[s(e.action.componentType,e._g(e._b({tag:"component",class:["oc-text-bold",e.action.class],attrs:{"data-testid":"action-handler"}},"component",e.getComponentProps(e.action,e.items),!1),e.getComponentListeners(e.action,e.items)),[e.action.img?s("oc-img",{staticClass:"oc-icon oc-icon-m",attrs:{"data-testid":"action-img",src:e.action.img,alt:""}}):e.action.icon?s("oc-icon",{attrs:{"data-testid":"action-icon",name:e.action.icon,size:"medium"}}):e._e(),e._v(" "),s("span",{staticClass:"oc-files-context-action-label",attrs:{"data-testid":"action-label"}},[e._v(e._s(e.action.label(e.filterParams)))]),e._v(" "),e.action.opensInNewWindow?s("span",{staticClass:"oc-invisible-sr",attrs:{"data-testid":"action-sr-hint"},domProps:{textContent:e._s(e.$gettext("(Opens in new window)"))}}):e._e()],1)],1)};mt._withStripped=!0;const ft=t.normalizeComponent({render:mt,staticRenderFns:[]},undefined,pt,undefined,false,undefined,!1,void 0,void 0,void 0);const gt={name:"FileActions",title:e=>e("Actions"),components:{ActionMenuItem:ft},mixins:[ue],computed:{...t.mapGetters("Files",["highlightedFile"]),resources(){return[this.highlightedFile]},actions(){return this.$_fileActions_getAllAvailableActions(this.resources)}}};var vt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-list",{staticClass:"oc-mt-s",attrs:{id:"oc-files-actions-sidebar"}},e._l(e.actions,(function(t,i){return s("action-menu-item",{key:"action-"+i,staticClass:"oc-py-xs",attrs:{action:t,items:e.resources}})})),1)};vt._withStripped=!0;const _t=t.normalizeComponent({render:vt,staticRenderFns:[]},undefined,gt,undefined,false,undefined,!1,void 0,void 0,void 0);const bt={name:"FileVersions",mixins:[at,rt],title:e=>e("Versions"),data:()=>({loading:!1,DavProperty:a.DavProperty}),computed:{...t.mapGetters("Files",["highlightedFile","versions"]),...t.mapGetters(["getToken"]),hasVersion(){return this.versions.length>0}},watch:{highlightedFile(){this.fetchFileVersions()}},mounted(){this.fetchFileVersions()},methods:{...t.mapActions("Files",["loadVersions"]),currentVersionId(e){const t=e.name.split("/");return t[t.length-1]},async fetchFileVersions(){this.loading=!0,await this.loadVersions({client:this.$client,fileId:this.highlightedFile.id}),this.loading=!1},revertVersion(e){this.$client.fileVersions.restoreFileVersion(this.highlightedFile.id,this.currentVersionId(e),this.highlightedFile.path).then((()=>{this.fetchFileVersions()}))},downloadVersion(e){const t=this.currentVersionId(e);return this.downloadFile(this.highlightedFile,null,t)}}};var xt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-file-versions-sidebar"}},[e.loading?s("oc-loader"):e._e(),e._v(" "),!e.loading&&e.hasVersion?s("oc-table-simple",[s("oc-tbody",e._l(e.versions,(function(t,i){return s("oc-tr",{key:i,staticClass:"file-row"},[s("oc-td",{attrs:{width:"shrink","data-testid":"file-versions-file-icon"}},[s("oc-icon",{attrs:{name:e.fileTypeIcon(e.highlightedFile)}})],1),e._v(" "),s("oc-td",{staticClass:"oc-text-muted uk-text-nowrap",attrs:{width:"shrink","data-testid":"file-versions-file-last-modified-date"}},[e._v("\n          "+e._s(e.formRelativeDateFromHTTP(t.fileInfo[e.DavProperty.LastModifiedDate]))+"\n        ")]),e._v(" "),s("oc-td",{staticClass:"oc-text-muted uk-text-nowrap",attrs:{"data-testid":"file-versions-file-size"}},[e._v("\n          "+e._s(e.getResourceSize(t.fileInfo[e.DavProperty.ContentLength]))+"\n        ")]),e._v(" "),s("oc-td",{attrs:{width:"shrink"}},[s("div",{staticClass:"uk-button-group"},[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Restore older version"),expression:"$gettext('Restore older version')"}],attrs:{"data-testid":"file-versions-revert-button",appearance:"raw","aria-label":e.$gettext("Restore older version")},on:{click:function(s){return e.revertVersion(t)}}},[s("oc-icon",{attrs:{name:"restore"}})],1)],1)]),e._v(" "),s("oc-td",{attrs:{width:"shrink"}},[s("div",{staticClass:"uk-button-group"},[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Download older version"),expression:"$gettext('Download older version')"}],attrs:{"data-testid":"file-versions-download-button",appearance:"raw","aria-label":e.$gettext("Download older version")},on:{click:function(s){return e.downloadVersion(t)}}},[s("oc-icon",{attrs:{name:"cloud_download"}})],1)],1)])],1)})),1)],1):s("div",[s("p",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"data-testid":"file-versions-no-versions"}},[e._v("No Versions available for this file")])])],1)};xt._withStripped=!0;const St=t.normalizeComponent({render:xt,staticRenderFns:[]},undefined,bt,undefined,false,undefined,!1,void 0,void 0,void 0);function yt(e){const t=[];let s,i=0,a=-1,r=0;for(;i<e.length;){s=e.charAt(i);const o=!r&&"."===s||s>="0"&&s<="9";o!==r&&(a++,t[a]="",r=o),t[a]+=s,i++}return t}const wt={naturalSortCompare:function(e,t){const s=yt(e),i=yt(t);let a,r,o;for(a=0;s[a]&&i[a];a++)if(s[a]!==i[a])return r=Number(s[a]),o=Number(i[a]),r==s[a]&&o==i[a]?r-o:s[a].localeCompare(i[a],"en");return s.length-i.length}};const Ct={name:"AutocompleteItem",props:{item:{type:Object,required:!0}},data:()=>({loading:!1}),computed:{shareType(){return e.ShareTypes.getByValue(this.item.value.shareType)},isUser(){return this.shareType===e.ShareTypes.user},isGroup(){return this.shareType===e.ShareTypes.group},collaboratorClass(){return`files-collaborators-search-${this.shareType.key}`}}};var Et=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"uk-flex uk-flex-middle oc-py-xs",class:e.collaboratorClass,attrs:{"data-testid":"recipient-autocomplete-item-"+e.item.label}},[e.isUser?s("avatar-image",{staticClass:"oc-mr-s",attrs:{width:48,userid:e.item.value.shareWith,"user-name":e.item.label}}):e.isGroup?s("oc-icon",{key:"avatar-group",staticClass:"oc-mr-s files-recipient-suggestion-avatar",attrs:{name:"group",size:"xlarge","accessible-label":e.$gettext("Group")}}):s("oc-icon",{key:"avatar-generic-person",staticClass:"oc-mr-s files-recipient-suggestion-avatar",attrs:{name:"person",size:"xlarge","accessible-label":e.$gettext("User")}}),e._v(" "),s("div",{staticClass:"files-collaborators-autocomplete-user-text"},[s("span",{staticClass:"oc-text-bold files-collaborators-autocomplete-username",domProps:{textContent:e._s(e.item.label)}}),e._v(" "),e.item.value.shareWithAdditionalInfo?s("span",{staticClass:"files-collaborators-autocomplete-additional-info",domProps:{textContent:e._s("("+e.item.value.shareWithAdditionalInfo+")")}}):e._e(),e._v(" "),s("div",{staticClass:"files-collaborators-autocomplete-share-type",domProps:{textContent:e._s(e.$gettext(e.shareType.label))}})])],1)};Et._withStripped=!0;const kt=t.normalizeComponent({render:Et,staticRenderFns:[]},undefined,Ct,undefined,false,undefined,!1,void 0,void 0,void 0);const $t={name:"RoleItem",props:{role:{type:e.ShareRole,required:!0},allowSharePermission:{type:Boolean,required:!0}}};var Ft=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"roles-select-role-item",attrs:{id:"files-role-"+e.role.name}},[s("span",{staticClass:"oc-text-bold uk-display-block uk-width-1-1",domProps:{textContent:e._s(e.$gettext(e.role.label))}}),e._v(" "),s("span",{staticClass:"oc-m-rm",domProps:{textContent:e._s(e.$gettext(e.role.description(e.allowSharePermission)))}})])};Ft._withStripped=!0;const Rt=t.normalizeComponent({render:Ft,staticRenderFns:[]},undefined,$t,"data-v-f5be8040",false,undefined,!1,void 0,void 0,void 0);const Tt={name:"RoleDropdown",components:{RoleItem:Rt},props:{resource:{type:Object,required:!0},existingRole:{type:e.ShareRole,required:!1,default:void 0},existingPermissions:{type:Array,required:!1,default:()=>[]},shareId:{type:String,required:!1,default:void 0},allowSharePermission:{type:Boolean,required:!0}},data:()=>({selectedRole:null,customPermissions:[]}),computed:{roleButtonId(){return this.shareId?`files-collaborators-role-button-${this.shareId}`:"files-collaborators-role-button-new"},rolesListAriaLabel(){return this.$gettext("Select role for the invitation")},inviteLabel(){return this.selectedRole.hasCustomPermissions?this.$gettext("Invite with custom permissions"):this.$gettextInterpolate("Invite as %{ name }",{name:this.selectedRole.inlineLabel||""})},customPermissionsRole(){return e.PeopleShareRoles.custom(this.resource.isFolder)},availableRoles(){return e.PeopleShareRoles.list(this.resource.isFolder)},availablePermissions(){return this.customPermissionsRole.permissions(this.allowSharePermission)}},created(){this.applyRoleAndPermissions()},beforeDestroy(){window.removeEventListener("keydown",this.cycleRoles)},mounted(){this.applyRoleAndPermissions(),window.addEventListener("keydown",this.cycleRoles)},methods:{applyRoleAndPermissions(){this.selectedRole=this.existingRole||e.PeopleShareRoles.list(this.resource.isFolder)[0],this.selectedRole.hasCustomPermissions?this.customPermissions=this.existingPermissions:this.customPermissions=[...this.selectedRole.permissions(this.allowSharePermission)]},publishChange(){this.$emit("optionChange",{role:this.selectedRole,permissions:this.customPermissions})},selectRole(e){e.hasCustomPermissions?this.$refs.customPermissionsDrop.show():(this.selectedRole=e,this.customPermissions=e.permissions(this.allowSharePermission),this.publishChange())},isSelectedRole(e){return this.selectedRole.name===e.name},isPermissionDisabled:t=>t.bit===e.SharePermissions.read.bit,confirmCustomPermissions(){this.$refs.customPermissionsDrop.hide();const t=e.SharePermissions.permissionsToBitmask(this.customPermissions);this.selectedRole=e.PeopleShareRoles.getByBitmask(t,this.resource.isFolder,this.allowSharePermission),this.publishChange()},cancelCustomPermissions(){this.customPermissions=this.existingPermissions,this.$refs.customPermissionsDrop.hide(),this.$refs.rolesDrop.show()},cycleRoles(e){if(!t.get(this.$refs.rolesDrop,"tippy.state.isShown",!1))return;const{keyCode:s}=e,i=38===s,a=40===s;if(!i&&!a)return;const r=this.$refs.roleSelect||[];if(r.length<=1)return;const o=r.find((e=>e.$el===document.activeElement))||r.find((e=>e.$el.classList.contains("selected")))||r[0],n=r.indexOf(o),l=e=>r[e].$el.focus();i&&n-1<0?l(r.length-1):a&&n+1>=r.length?l(0):l(n+(i?-1:1))}}};var It=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.selectedRole?s("span",{staticClass:"uk-flex uk-flex-middle"},[s("oc-button",{staticClass:"files-recipient-role-select-btn",attrs:{id:e.roleButtonId,appearance:"raw","gap-size":"none"}},[e.existingRole?s("span",[e._v(e._s(e.$gettext(e.selectedRole.label)))]):s("span",{domProps:{textContent:e._s(e.inviteLabel)}}),e._v(" "),s("oc-icon",{attrs:{name:"expand_more"}})],1),e._v(" "),s("oc-drop",{ref:"rolesDrop",attrs:{toggle:"#"+e.roleButtonId,mode:"click","padding-size":"remove","close-on-click":""}},[s("oc-list",{staticClass:"files-recipient-role-drop-list",attrs:{"aria-label":e.rolesListAriaLabel}},e._l(e.availableRoles,(function(t){return s("li",{key:t.key},[s("oc-button",{ref:"roleSelect",refInFor:!0,staticClass:"files-recipient-role-drop-btn oc-py-xs oc-px-s",class:{selected:e.isSelectedRole(t)},attrs:{id:"files-recipient-role-drop-btn-"+t.name,appearance:"raw","justify-content":"space-between"},on:{click:function(s){return e.selectRole(t)}}},[s("role-item",{attrs:{role:t,"allow-share-permission":e.allowSharePermission}}),e._v(" "),e.isSelectedRole(t)?s("oc-icon",{attrs:{name:"check"}}):e._e()],1)],1)})),0)],1),e._v(" "),s("oc-drop",{ref:"customPermissionsDrop",staticClass:"files-recipient-custom-permissions-drop",attrs:{mode:"manual",target:"#"+e.roleButtonId,"padding-size":"small"}},[s("h4",{staticClass:"oc-text-bold oc-text-initial",domProps:{textContent:e._s(e.$gettext(e.customPermissionsRole.label))}}),e._v(" "),s("oc-list",{staticClass:"oc-mb"},e._l(e.availablePermissions,(function(t){return s("li",{key:"files-collaborators-permission-"+t.key,staticClass:"oc-my-xs"},[s("oc-checkbox",{key:"files-collaborators-permission-checkbox-"+t.key,staticClass:"oc-mr-xs files-collaborators-permission-checkbox",attrs:{id:"files-collaborators-permission-"+t.key,"data-testid":"files-collaborators-permission-"+t.key,label:e.$gettext(t.label),option:t,disabled:e.isPermissionDisabled(t)},model:{value:e.customPermissions,callback:function(t){e.customPermissions=t},expression:"customPermissions"}})],1)})),0),e._v(" "),s("div",{staticClass:"files-recipient-custom-permissions-drop-cancel-confirm-btns"},[s("oc-button",{attrs:{size:"small"},domProps:{textContent:e._s(e.$gettext("Cancel"))},on:{click:e.cancelCustomPermissions}}),e._v(" "),s("oc-button",{attrs:{size:"small",variation:"primary",appearance:"filled"},domProps:{textContent:e._s(e.$gettext("Apply"))},on:{click:e.confirmCustomPermissions}})],1)],1)],1):e._e()};It._withStripped=!0;const Pt=t.normalizeComponent({render:It,staticRenderFns:[]},undefined,Tt,"data-v-823c4caa",false,undefined,!1,void 0,void 0,void 0);const Dt={props:{recipient:{type:Object,required:!0},deselect:{type:Function,required:!1,default:null}},data(){return{formattedRecipient:{name:this.recipient.label,icon:this.getRecipientIcon(),hasAvatar:this.recipient.value.shareType===e.ShareTypes.user.value,isLoadingAvatar:!0}}},computed:{...t.mapGetters(["configuration","getToken","capabilities"]),btnDeselectRecipientLabel(){const e=this.$gettext("Deselect %{name}");return this.$gettextInterpolate(e,{name:this.recipient.label})}},async created(){if(this.capabilities.files_sharing.user.profile_picture&&this.recipient.value.shareType===e.ShareTypes.user.value)try{this.formattedRecipient.avatar=await N({server:this.configuration.server,username:this.recipient.value.shareWith,token:this.getToken})}catch(e){console.error(e)}this.formattedRecipient.isLoadingAvatar=!1},methods:{getRecipientIcon(){switch(this.recipient.value.shareType){case e.ShareTypes.group.value:return{name:"group",label:this.$gettext("Group")};case e.ShareTypes.guest.value:return{name:"user_remote",label:this.$gettext("Guest user")};case e.ShareTypes.remote.value:return{name:"user_remote",label:this.$gettext("Remote user")};default:return{name:"person",label:this.$gettext("User")}}}}};var Lt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-recipient",{staticClass:"files-share-invite-recipient",attrs:{"data-testid":"recipient-container-"+e.formattedRecipient.name,recipient:e.formattedRecipient},scopedSlots:e._u([{key:"append",fn:function(){return[s("oc-button",{staticClass:"files-share-invite-recipient-btn-remove",attrs:{appearance:"raw","aria-label":e.btnDeselectRecipientLabel},on:{click:function(t){return t.stopPropagation(),e.deselect(e.recipient)}}},[s("oc-icon",{attrs:{name:"close",size:"small"}})],1)]},proxy:!0}])})};Lt._withStripped=!0;const At=t.normalizeComponent({render:Lt,staticRenderFns:[]},undefined,Dt,"data-v-46afd19f",false,undefined,!1,void 0,void 0,void 0);const Ot=t.defineComponent({name:"DateCurrentpicker",props:{shareTypes:{type:Array,required:!1,default:()=>[]}},setup(s,{emit:i}){const a=t.getCurrentInstance().proxy,r=t.computed((()=>a.$language)),o=t.computed((()=>a.$gettext)),n=Ce(),l=t.computed((()=>n.getters.capabilities)),c=t.computed((()=>l.value.files_sharing.user?.expire_date)),d=t.computed((()=>l.value.files_sharing.group?.expire_date)),u=t.computed((()=>c.value||d.value)),h=t.computed((()=>c.value?.enforced||d.value?.enforced)),p=t.DateTime_1.now().setLocale(r.value.current).toJSDate(),m=t.computed((()=>{const i=s.shareTypes.includes(e.ShareTypes.user.value),a=s.shareTypes.includes(e.ShareTypes.group.value),o=parseInt(c.value?.days),n=parseInt(d.value?.days);if(!c.value?.enabled&&!d.value?.enabled)return null;let l=0;return o&&i&&n&&a?l=Math.min(o,n):o&&i?l=o:n&&a&&(l=n),l?t.DateTime_1.now().setLocale(r.value.current).plus({days:l}).toJSDate():null})),f=t.computed((()=>h.value?m.value:null)),g=t.customRef(((e,t)=>{let s=null;return{get:()=>(e(),s||m.value),set(e){s=e,t()}}})),v=t.computed((()=>t.DateTime_1.fromJSDate(g.value).setLocale(r.value.current).endOf("day").toRelative()));return t.watch(g,(e=>{const s=t.DateTime_1.fromJSDate(e).setLocale(r.value.current).endOf("day");i("optionChange",{expirationDate:s.isValid?s.toFormat("yyyy-MM-dd'T'HH:mm:ssZZZ"):null})})),t.watch(f,(e=>{!e||g.value<e||(g.value=e)})),{language:r,gettext:o,enforced:h,available:u,dateCurrent:g,dateMin:p,dateMax:f,dateExpire:v}}});var Nt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.available?s("div",{staticClass:"uk-flex uk-flex-middle uk-flex-nowrap"},[s("oc-datepicker",{staticClass:"files-recipient-expiration-datepicker",attrs:{"min-date":e.dateMin,"max-date":e.dateMax,locale:e.language.current,"is-required":e.enforced,"data-testid":"recipient-datepicker"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.togglePopover;return[s("oc-button",{staticClass:"files-collaborators-expiration-button",attrs:{"data-testid":"recipient-datepicker-btn",appearance:"raw","gap-size":"none"},on:{click:i}},[e.dateCurrent?s("translate",{key:"set-expiration-date-label",attrs:{"translate-params":{expires:e.dateExpire}}},[e._v("\n          Expires %{expires}\n        ")]):s("translate",{key:"no-expiration-date-label"},[e._v("Set expiration date")]),e._v(" "),e.dateCurrent?e._e():s("oc-icon",{attrs:{name:"expand_more"}})],1)]}}],null,!1,4081916653),model:{value:e.dateCurrent,callback:function(t){e.dateCurrent=t},expression:"dateCurrent"}}),e._v(" "),!e.enforced&&e.dateCurrent?s("oc-button",{staticClass:"recipient-edit-expiration-btn-remove",attrs:{appearance:"raw","aria-label":e.gettext("Remove expiration date")},on:{click:function(t){e.dateCurrent=null}}},[s("oc-icon",{attrs:{name:"close"}})],1):e._e()],1):e._e()};Nt._withStripped=!0;const Mt={name:"InviteCollaboratorForm",components:{AutocompleteItem:kt,RoleDropdown:Pt,RecipientContainer:At,ExpirationDatepicker:t.normalizeComponent({render:Nt,staticRenderFns:[]},undefined,Ot,"data-v-4c3d6494",false,undefined,!1,void 0,void 0,void 0)},data:()=>({autocompleteResults:[],announcement:"",searchInProgress:!1,selectedCollaborators:[],selectedRole:null,customPermissions:null,saving:!1,expirationDate:null,searchQuery:""}),computed:{...t.mapGetters("Files",["currentFileOutgoingCollaborators","highlightedFile"]),...t.mapGetters(["user"]),...t.mapGetters(["configuration","isOcis"]),inviteDescriptionMessage(){return this.$gettext("Add new person by name, email or federation IDs")},$_announcementWhenCollaboratorAdded(){return this.$gettext("Person was added")},$_isValid(){return this.selectedCollaborators.length>0},minSearchLength(){return parseInt(this.user.capabilities.files_sharing.search_min_length,10)},selectedCollaboratorsLabel(){return this.$gettext("Invite")}},mounted(){this.fetchRecipients=t.debounce(this.fetchRecipients,500),this.selectedRole=e.PeopleShareRoles.list(this.highlightedFile.isFolder)[0]},methods:{...t.mapActions("Files",["addShare"]),async fetchRecipients(e){try{const t=await this.$client.shares.getRecipients(e,"folder",1,this.configuration.options.sharingRecipientsPerPage),s=t.exact.users.concat(t.users).filter((e=>e.value.shareWith!==this.user.id)),i=t.exact.groups.concat(t.groups),a=t.exact.remotes.concat(t.remotes);this.autocompleteResults=s.concat(i,a).filter((e=>{const t=this.selectedCollaborators.find((t=>e.value.shareWith===t.value.shareWith&&parseInt(e.value.shareType,10)===parseInt(t.value.shareType,10))),s=this.currentFileOutgoingCollaborators.find((t=>e.value.shareWith===t.collaborator.name&&parseInt(e.value.shareType,10)===t.shareType));return!t&&!s&&(this.announcement=this.$_announcementWhenCollaboratorAdded,!0)}))}catch(e){console.error(e)}this.searchInProgress=!1},onSearch(e){this.autocompleteResults=[],this.searchQuery=e,e.length<this.minSearchLength?this.searchInProgress=!1:(this.searchInProgress=!0,this.fetchRecipients(e))},filterRecipients:(t,s)=>t.length<1?[]:t.filter((t=>t.value.shareType===e.ShareTypes.remote.value||t.label.toLocaleLowerCase().indexOf(s.toLocaleLowerCase())>-1||t.value.shareWith.toLocaleLowerCase().indexOf(s.toLocaleLowerCase())>-1||(t.value.shareWithAdditionalInfo||"").toLocaleLowerCase().indexOf(s.toLocaleLowerCase())>-1)),collaboratorRoleChanged({role:e,permissions:t}){this.selectedRole=e,this.customPermissions=t},collaboratorExpiryChanged({expirationDate:e}){this.expirationDate=e},async share(){this.saving=!0;const s=new t._default({concurrency:4}),i=[];this.selectedCollaborators.forEach((t=>{i.push(s.add((()=>{const s=this.selectedRole.hasCustomPermissions?e.SharePermissions.permissionsToBitmask(this.customPermissions):e.SharePermissions.permissionsToBitmask(this.selectedRole.permissions(!this.isOcis));this.addShare({client:this.$client,path:this.highlightedFile.path,$gettext:this.$gettext,shareWith:t.value.shareWith,shareType:t.value.shareType,permissions:s,expirationDate:this.expirationDate})})))})),await Promise.all(i)},resetFocusOnInvite(){this.autocompleteResults=[],this.$nextTick((()=>{document.getElementById("files-share-invite-input").focus()}))}}};var Ut=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"new-collaborators-form","data-testid":"new-collaborators-form"}},[s("oc-select",{ref:"ocSharingAutocomplete",attrs:{id:"files-share-invite-input",options:e.autocompleteResults,loading:e.searchInProgress,multiple:!0,filter:e.filterRecipients,label:e.selectedCollaboratorsLabel,"aria-describedby":"files-share-invite-hint","dropdown-should-open":function(t){var s=t.open,i=t.search;return s&&i.length>=e.minSearchLength&&!e.searchInProgress}},on:{"search:input":e.onSearch,input:e.resetFocusOnInvite},scopedSlots:e._u([{key:"option",fn:function(e){return[s("autocomplete-item",{attrs:{item:e}})]}},{key:"no-options",fn:function(){return[s("translate",[e._v(" No users or groups found. ")])]},proxy:!0},{key:"selected-option-container",fn:function(e){var t=e.option,i=e.deselect;return[s("recipient-container",{key:t.value.shareWith,attrs:{recipient:t,deselect:i}})]}},{key:"open-indicator",fn:function(){return[s("span")]},proxy:!0}]),model:{value:e.selectedCollaborators,callback:function(t){e.selectedCollaborators=t},expression:"selectedCollaborators"}}),e._v(" "),s("p",{staticClass:"oc-mt-xs oc-text-meta",attrs:{id:"files-share-invite-hint"},domProps:{textContent:e._s(e.inviteDescriptionMessage)}}),e._v(" "),s("div",{staticClass:"uk-flex uk-flex-middle uk-flex-between oc-mb-l"},[s("role-dropdown",{attrs:{resource:e.highlightedFile,"allow-share-permission":!e.isOcis},on:{optionChange:e.collaboratorRoleChanged}}),e._v(" "),s("expiration-datepicker",{attrs:{"share-types":e.selectedCollaborators.map((function(e){return e.value.shareType}))},on:{optionChange:e.collaboratorExpiryChanged}}),e._v(" "),e.saving?s("oc-button",{key:"new-collaborator-saving-button",attrs:{disabled:!0}},[s("oc-spinner",{attrs:{"aria-label":e.$gettext("Creating share"),size:"small"}}),e._v(" "),s("span",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"aria-hidden":!0}},[e._v("Share")])],1):s("oc-button",{key:"new-collaborator-save-button",attrs:{id:"new-collaborators-form-create-button","data-testid":"new-collaborators-form-create-button",disabled:!e.$_isValid,variation:"primary",appearance:"filled"},domProps:{textContent:e._s(e.$gettext("Share"))},on:{click:e.share}})],1),e._v(" "),s("oc-hidden-announcer",{attrs:{level:"assertive",announcement:e.announcement}})],1)};Ut._withStripped=!0;const zt=t.normalizeComponent({render:Ut,staticRenderFns:[]},undefined,Mt,undefined,false,undefined,!1,void 0,void 0,void 0);const Bt={name:"EditDropdown",mixins:[at],props:{expirationDate:{type:Date,required:!1,default:void 0},shareCategory:{type:String,required:!1,default:null,validator:function(e){return["user","group"].includes(e)||!e}}},data:function(){return{enteredExpirationDate:null}},computed:{...t.mapGetters(["capabilities"]),options(){const e=[];return this.isRemoveExpirationPossible&&e.push({title:this.$gettext("Remove expiration date"),method:this.removeExpirationDate,class:"remove-expiration-date",additionalAttributes:{"data-testid":"collaborator-remove-expiration-btn"}}),[...e,{title:this.$gettext("Remove share"),method:this.removeShare,class:"remove-share",additionalAttributes:{variation:"danger","data-testid":"collaborator-remove-share-btn"}}]},editShareBtnId(){return"files-collaborators-edit-button-"+this._uid},shareEditOptions(){return this.$gettext("Context menu of the share")},editingUser(){return"user"===this.shareCategory},editingGroup(){return"group"===this.shareCategory},isExpirationSupported(){return this.editingUser&&this.userExpirationDate||this.editingGroup&&this.groupExpirationDate},isExpirationDateSet(){return!!this.expirationDate},isRemoveExpirationPossible(){return this.isExpirationSupported&&this.isExpirationDateSet&&!this.isExpirationDateEnforced},isDefaultExpirationEnabled(){return this.editingUser?this.userExpirationDate.enabled:this.editingGroup?this.groupExpirationDate.enabled:this.userExpirationDate.enabled||this.groupExpirationDate.enabled},userExpirationDate(){return this.capabilities.files_sharing.user.expire_date},groupExpirationDate(){return this.capabilities.files_sharing.group?.expire_date},defaultExpirationDate(){if(!this.isDefaultExpirationEnabled)return null;const e=parseInt(this.userExpirationDate.days),t=parseInt(this.groupExpirationDate.days);let s=0;s=this.editingUser?e:this.editingGroup?t:e&&t?Math.min(e,t):e||t;const i=new Date;return i.setDate((new Date).getDate()+s),i},isExpirationDateEnforced(){return this.editingUser?this.userExpirationDate.enforced:this.editingGroup?this.groupExpirationDate.enforced:this.userExpirationDate.enforced||this.groupExpirationDate.enforced},maxExpirationDate(){return this.isExpirationDateEnforced?this.defaultExpirationDate:null},minExpirationDate(){const e=new Date;return e.setDate((new Date).getDate()+1),e},relativeExpirationDate(){return t.DateTime_1.fromJSDate(this.enteredExpirationDate).setLocale(this.$language.current).endOf("day").toRelative()}},watch:{enteredExpirationDate:{handler:"updateExpirationDate"}},methods:{updateExpirationDate(){this.$emit("expirationDateChanged",{expirationDate:t.DateTime_1.fromJSDate(this.enteredExpirationDate).endOf("day").toISO()}),this.$refs.expirationDateDrop.hide()},removeExpirationDate(){this.$emit("expirationDateChanged",{expirationDate:null}),this.$refs.expirationDateDrop.hide()},removeShare(){this.$emit("removeShare")}}};var Gt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"uk-flex uk-flex-middle"},[s("oc-button",{staticClass:"collaborator-edit-dropdown-options-btn",attrs:{id:e.editShareBtnId,appearance:"raw"}},[s("oc-icon",{attrs:{name:"more_vert"}})],1),e._v(" "),s("oc-drop",{ref:"expirationDateDrop",attrs:{toggle:"#"+e.editShareBtnId,mode:"click","padding-size":"remove"}},[s("oc-list",{staticClass:"collaborator-edit-dropdown-options-list",attrs:{"aria-label":e.shareEditOptions}},[e.isExpirationSupported?s("li",{staticClass:"oc-px-s oc-py-xs"},[s("oc-datepicker",{staticClass:"files-recipient-expiration-datepicker",attrs:{"min-date":e.minExpirationDate,"max-date":e.maxExpirationDate,locale:e.$language.current,"is-required":e.isExpirationDateEnforced,"data-testid":"recipient-datepicker"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.togglePopover;return[s("oc-button",{staticClass:"files-collaborators-expiration-button",attrs:{"data-testid":"recipient-datepicker-btn",appearance:"raw"},on:{click:i}},[e.isExpirationDateSet?s("span",{domProps:{textContent:e._s(e.$gettext("Edit expiration date"))}}):s("span",{domProps:{textContent:e._s(e.$gettext("Set expiration date"))}})])]}}],null,!1,3345608471),model:{value:e.enteredExpirationDate,callback:function(t){e.enteredExpirationDate=t},expression:"enteredExpirationDate"}})],1):e._e(),e._v(" "),e._l(e.options,(function(t,i){return s("li",{key:i,staticClass:"oc-px-s oc-py-xs"},[s("oc-button",e._b({class:t.class,attrs:{appearance:"raw"},on:{click:function(e){return t.method()}}},"oc-button",t.additionalAttributes||{},!1),[s("span",{domProps:{textContent:e._s(t.title)}})])],1)}))],2)],1)],1)};Gt._withStripped=!0;const Vt={name:"ListItem",components:{EditDropdown:t.normalizeComponent({render:Gt,staticRenderFns:[]},undefined,Bt,undefined,false,undefined,!1,void 0,void 0,void 0),RoleDropdown:Pt},mixins:[at],props:{share:{type:Object,required:!0},modifiable:{type:Boolean,default:!1}},computed:{...t.mapGetters("Files",["highlightedFile"]),...t.mapGetters(["isOcis"]),shareType(){return e.ShareTypes.getByValue(this.share.shareType)},shareTypeKey(){return this.shareType.key},isGroup(){return this.shareType===e.ShareTypes.group},isUser(){return this.shareType===e.ShareTypes.user},shareTypeText(){return this.$gettext(this.shareType.label)},shareCategory(){return e.ShareTypes.isIndividual(this.shareType)?"user":"group"},shareDisplayName(){return this.share.collaborator.displayName},shareAdditionalInfo(){if(this.share.collaborator.additionalInfo)return` (${this.share.collaborator.additionalInfo})`},shareDisplayNameTooltip(){return this.shareDisplayName+(this.shareAdditionalInfo||"")},screenreaderShareDisplayName(){const e={displayName:this.share.collaborator.displayName,...this.share.collaborator.additionalInfo&&{additionalInfo:this.share.collaborator.additionalInfo}};let t=this.$gettext("Share receiver name: %{ displayName }");return this.shareAdditionalInfo&&(t=this.$gettext("Share receiver name: %{ displayName } (%{ additionalInfo })")),this.$gettextInterpolate(t,e)},screenreaderShareDetails(){const e=this.$gettext("Share type: %{ shareType }");return this.$gettextInterpolate(e,{shareType:this.shareTypeText})},shareExpirationText(){const e=this.$gettext("Expires %{ expiryDateRelative }");return this.$gettextInterpolate(e,{expiryDateRelative:this.expirationDateRelative})},screenreaderShareExpiration(){const e=this.$gettext("Share expires %{ expiryDateRelative } (%{ expiryDate })");return this.$gettextInterpolate(e,{expiryDateRelative:this.expirationDateRelative,expiryDate:this.expirationDate})},canEditOrDelete(){return this.modifiable},hasExpirationDate(){return this.share.expires},expirationDate(){return t.DateTime_1.fromJSDate(this.share.expires).endOf("day").setLocale(this.$language.current).toLocaleString(t.DateTime_1.DATETIME_FULL)},expirationDateRelative(){return t.DateTime_1.fromJSDate(this.share.expires).endOf("day").setLocale(this.$language.current).toRelative()}},methods:{...t.mapActions(["showMessage"]),...t.mapActions("Files",["changeShare"]),removeShare(){this.$emit("onDelete",this.share)},shareRoleChanged({role:e,permissions:t}){const s=this.share.expires;try{this.saveShareChanges({role:e,permissions:t,expirationDate:s})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to apply new permissions"),status:"danger"})}},shareExpirationChanged({expirationDate:e}){const t=this.share.role,s=this.share.customPermissions;try{this.saveShareChanges({role:t,permissions:s,expirationDate:e})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to apply expiration date"),status:"danger"})}},saveShareChanges({role:t,permissions:s,expirationDate:i}){const a=t.hasCustomPermissions?e.SharePermissions.permissionsToBitmask(s):e.SharePermissions.permissionsToBitmask(t.permissions(!this.isOcis));this.changeShare({client:this.$client,share:this.share,permissions:a,expirationDate:i||""})}}};var qt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"files-collaborators-collaborator uk-flex uk-flex-middle oc-py-xs",attrs:{"data-testid":"collaborator-"+(e.isUser?"user":"group")+"-item-"+e.share.collaborator.name}},[s("div",{staticClass:"uk-width-2-3 uk-flex uk-flex-middle",staticStyle:{gap:"10px"}},[e.isUser?s("avatar-image",{staticClass:"files-collaborators-collaborator-indicator",attrs:{userid:e.share.collaborator.name,"user-name":e.share.collaborator.displayName,width:48}}):s("oc-avatar-item",{staticClass:"files-collaborators-collaborator-indicator",attrs:{width:48,"icon-size":"medium",icon:e.shareTypeKey,name:e.shareTypeKey}}),e._v(" "),s("div",{staticClass:"oc-text-truncate"},[s("p",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.shareDisplayNameTooltip,expression:"shareDisplayNameTooltip"}],staticClass:"oc-text-bold oc-text-truncate oc-m-rm"},[s("span",{staticClass:"files-collaborators-collaborator-name",attrs:{"aria-hidden":"true"},domProps:{textContent:e._s(e.shareDisplayName)}}),e._v(" "),e.shareAdditionalInfo?s("span",{staticClass:"files-collaborators-collaborator-additional-info",attrs:{"aria-hidden":"true"},domProps:{textContent:e._s(e.shareAdditionalInfo)}}):e._e(),e._v(" "),s("span",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.screenreaderShareDisplayName)}})]),e._v(" "),s("p",{staticClass:"oc-m-rm"},[s("span",{staticClass:"files-collaborators-collaborator-share-type",attrs:{"aria-hidden":"true"},domProps:{textContent:e._s(e.shareTypeText)}}),e._v(" "),s("span",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.screenreaderShareDetails)}})]),e._v(" "),e.hasExpirationDate?s("p",{staticClass:"oc-m-rm"},[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.expirationDate,expression:"expirationDate"}],staticClass:"files-collaborators-collaborator-expiration",attrs:{"aria-hidden":"true","data-testid":"recipient-info-expiration-date",tabindex:"0"},domProps:{textContent:e._s(e.shareExpirationText)}}),e._v(" "),s("span",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.screenreaderShareExpiration)}})]):e._e()])],1),e._v(" "),e.canEditOrDelete?s("div",{staticClass:"uk-width-1-3 uk-flex uk-flex-nowrap uk-flex-right uk-flex-middle"},[s("role-dropdown",{staticClass:"files-collaborators-collaborator-role",attrs:{resource:e.highlightedFile,"share-id":e.share.id,"existing-permissions":e.share.customPermissions,"existing-role":e.share.role,"allow-share-permission":!e.isOcis},on:{optionChange:e.shareRoleChanged}}),e._v(" "),s("edit-dropdown",{staticClass:"files-collaborators-collaborator-edit",attrs:{"data-testid":"collaborator-edit","expiration-date":e.share.expires?e.share.expires:null,"share-category":e.shareCategory},on:{expirationDateChanged:e.shareExpirationChanged,removeShare:e.removeShare}})],1):e._e()])};qt._withStripped=!0;const Ht={title:e=>e("People"),name:"FileShares",components:{InviteCollaboratorForm:zt,CollaboratorListItem:t.normalizeComponent({render:qt,staticRenderFns:[]},undefined,Vt,"data-v-0f055d75",false,undefined,!1,void 0,void 0,void 0)},data:()=>({currentShare:null,showShareesList:!0}),computed:{...t.mapGetters("Files",["highlightedFile","currentFileOutgoingCollaborators","currentFileOutgoingSharesLoading","sharesTreeLoading"]),...t.mapState("Files",["incomingShares","incomingSharesLoading","sharesTree"]),...t.mapState(["user"]),sharedWithLabel(){return this.$gettext("Shared with")},hasSharees(){return this.collaboratorsAvatar.length>0},sharedWithTooltip(){return this.showShareesList?this.$gettext("Collapse list of invited people"):this.$gettext("Show all invited people")},sharesLoading(){return this.currentFileOutgoingSharesLoading||this.incomingSharesLoading||this.sharesTreeLoading},collaboratorsAvatar(){return this.collaborators.map((e=>({...e.collaborator,shareType:e.shareType})))},$_allIncomingShares(){const e=[...this.incomingShares],t=c(this.highlightedFile.path,!0);return 0===t.length?[]:(t.pop(),t.forEach((t=>{const s=this.sharesTree[t];s&&s.forEach((t=>{t.incoming&&e.push(t)}))})),e)},collaborators(){return[...this.currentFileOutgoingCollaborators,...this.indirectOutgoingShares].sort(this.collaboratorsComparator).map((e=>(e.key="collaborator-"+e.id,e.owner.name!==e.fileOwner.name&&e.owner.name!==this.user.id&&(e.resharers=[e.owner]),e)))},indirectOutgoingShares(){const e=[],t=c(this.highlightedFile.path,!1);return 0===t.length?[]:(t.pop(),t.forEach((t=>{const s=this.sharesTree[t];s&&s.forEach((t=>{t.outgoing&&this.$_isCollaboratorShare(t)&&(t.key="indirect-collaborator-"+t.id,e.push(t))}))})),e)},currentUserCanShare(){return this.highlightedFile.canShare()},noResharePermsMessage(){const e=this.$gettext("You don't have permission to share this file."),t=this.$gettext("You don't have permission to share this folder.");return"file"===this.highlightedFile.type?e:t},currentUsersPermissions(){if(this.$_allIncomingShares.length>0){let e=0;for(const t of this.$_allIncomingShares)e|=t.permissions;return e}return null}},watch:{highlightedFile:{handler:function(e,t){t!==e&&(this.$_reloadShares(),this.showShareesList=!0)},immediate:!0}},methods:{...t.mapActions("Files",["loadCurrentFileOutgoingShares","loadSharesTree","deleteShare","loadIncomingShares"]),$_isCollaboratorShare:t=>e.ShareTypes.containsAnyValue(e.ShareTypes.authenticated,[t.shareType]),collaboratorsComparator(t,s){const i=t.collaborator?t.collaborator.displayName:t.displayName,a=s.collaborator?s.collaborator.displayName:s.displayName,r=i.toLowerCase().trim(),o=a.toLowerCase().trim(),n=e.ShareTypes.containsAnyValue(e.ShareTypes.individuals,[t.shareType]),l=e.ShareTypes.containsAnyValue(e.ShareTypes.individuals,[s.shareType]),c=!t.indirect,d=!s.indirect;return n===l?c===d?r===o?wt.naturalSortCompare(t.stime+"",s.stime+""):wt.naturalSortCompare(r,o):c?-1:1:n?-1:1},toggleShareeList(){this.showShareesList=!this.showShareesList},$_ocCollaborators_deleteShare(e){this.deleteShare({client:this.$client,share:e,resource:this.highlightedFile})},$_reloadShares(){this.loadCurrentFileOutgoingShares({client:this.$client,path:this.highlightedFile.path,$gettext:this.$gettext}),this.loadIncomingShares({client:this.$client,path:this.highlightedFile.path,$gettext:this.$gettext}),this.loadSharesTree({client:this.$client,path:t.dirname(this.highlightedFile.path),$gettext:this.$gettext})}}};var Wt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"uk-position-relative",attrs:{id:"oc-files-sharing-sidebar"}},[e.sharesLoading?s("oc-loader",{attrs:{"aria-label":e.$gettext("Loading people list")}}):[e.currentUserCanShare?s("invite-collaborator-form",{key:"new-collaborator",staticClass:"oc-my-s"}):s("p",{key:"no-reshare-permissions-message",attrs:{"data-testid":"files-collaborators-no-reshare-permissions-message"},domProps:{textContent:e._s(e.noResharePermsMessage)}}),e._v(" "),e.hasSharees?s("div",{staticClass:"avatars-wrapper uk-flex uk-flex-middle uk-flex-between"},[s("h4",{staticClass:"oc-text-initial oc-text-bold oc-mb-rm",domProps:{textContent:e._s(e.sharedWithLabel)}}),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.sharedWithTooltip,expression:"sharedWithTooltip"}],attrs:{"data-testid":"collaborators-show-people",appearance:"raw","aria-label":e.sharedWithTooltip},on:{click:e.toggleShareeList}},[e.showShareesList?s("oc-icon",{attrs:{name:"chevron_up"}}):s("oc-avatars",{staticClass:"sharee-avatars",attrs:{items:e.collaboratorsAvatar,stacked:!0,"is-tooltip-displayed":!1}})],1)],1):e._e(),e._v(" "),e.showShareesList&&e.hasSharees?[s("transition-group",{staticClass:"uk-list uk-list-divider uk-overflow-hidden oc-m-rm",attrs:{id:"files-collaborators-list",name:"custom-classes-transition",tag:"ul","aria-label":e.$gettext("Share receivers")}},e._l(e.collaborators,(function(t){return s("li",{key:t.key},[s("collaborator-list-item",{attrs:{share:t,modifiable:!t.indirect},on:{onDelete:e.$_ocCollaborators_deleteShare}})],1)})),0)]:e._e()]],2)};Wt._withStripped=!0;const jt=t.normalizeComponent({render:Wt,staticRenderFns:[]},undefined,Ht,undefined,false,undefined,!1,void 0,void 0,void 0);const Yt={components:{RoleItem:Rt},mixins:[at],inject:["changeView"],data(){return{saving:!1,password:null,errors:!1,name:null,hasPassword:!1,expireDate:null,placeholder:{mailTo:this.$gettext("Mail recipients"),mailBody:this.$gettext("Personal note")},selectedRoleOption:null}},title:e=>e("Links"),computed:{...t.mapGetters("Files",["highlightedFile"]),...t.mapGetters(["getToken","capabilities"]),...t.mapState("Files",["publicLinkInEdit"]),selectedRole(){return this.getRoleFromSelectOption(this.selectedRoleOption)},$_isNew(){return!this.publicLinkInEdit.id},$_hasChanges(){const e=this.publicLinkInEdit.expireDate;return this.expireDate!==e||this.name!==this.publicLinkInEdit.name||this.selectedRole.bitmask(!1)!==this.publicLinkInEdit.permissions||(this.publicLinkInEdit.hasPassword?null!==this.password:null!==this.password&&this.password.trim().length>0)},$_sendMailEnabled(){return Object.keys(this.capabilities.files_sharing.public.send_mail).length>0},availableRoleOptions(){return e.LinkShareRoles.list(this.highlightedFile.isFolder).map((e=>this.convertRoleToSelectOption(e)))},$_expirationDate(){const e=this.capabilities.files_sharing.public.expire_date;return{enabled:!!e.enabled,days:!!e.days&&e.days,enforced:!!e.enforced}},minExpirationDate(){return t.DateTime_1.now().setLocale(this.$language.current).toJSDate()},maxExpirationDate(){if(!this.$_expirationDate.enforced)return null;const e=parseInt(this.$_expirationDate.days,10);return t.DateTime_1.now().setLocale(this.$language.current).plus({days:e}).toJSDate()},$_expirationIsValid(){return!(this.$_expirationDate.enforced&&!this.expireDate)},$_passwordIsValid(){return!!this.hasPassword||!(this.$_passwordEnforced&&(""===this.password||null===this.password))},$_isValid(){return this.$_expirationIsValid&&this.$_passwordIsValid},$_passwordEnforced(){const t=this.capabilities.files_sharing.public.password.enforced_for;return"1"===t.read_only?this.selectedRole.hasPermission(e.SharePermissions.read)&&!this.selectedRole.hasPermission(e.SharePermissions.create):"1"===t.upload_only?!this.selectedRole.hasPermission(e.SharePermissions.read)&&this.selectedRole.hasPermission(e.SharePermissions.create):"1"===t.read_write&&(this.selectedRole.hasPermission(e.SharePermissions.read)&&this.selectedRole.hasPermission(e.SharePermissions.create))},expirationDateLabel(){return this.$_expirationDate.enforced?this.$gettext("Expiration date (required)"):this.$gettext("Expiration date")},passwordLabel(){return this.$_passwordEnforced?this.$gettext("Password (required)"):this.$gettext("Password")},selectedRoleLabel(){return this.$gettext("Role")},relativeExpirationDate(){return t.DateTime_1.fromJSDate(this.expireDate).setLocale(this.$language.current).endOf("day").toRelative()},defaultExpireDate(){if(!this.$_expirationDate.days)return null;const e=parseInt(this.$_expirationDate.days);return t.DateTime_1.now().setLocale(this.$language.current).plus({days:e}).toJSDate()}},created(){const e=this.publicLinkInEdit;this.name=e?.name,this.hasPassword=e?.hasPassword;const t=e.expireDate?new Date(this.publicLinkInEdit.expireDate):null;this.expireDate=e?.id?t:this.defaultExpireDate,this.setRole()},mounted(){this.$nextTick((()=>{this.$refs.nameInput.focus()}))},methods:{...t.mapActions("Files",["addLink","updateLink"]),setRole(){const t=parseInt(this.publicLinkInEdit.permissions);if(t){const s=e.LinkShareRoles.getByBitmask(t,this.highlightedFile.isFolder);if(s)return void(this.selectedRoleOption=this.convertRoleToSelectOption(s))}this.selectedRoleOption=this.availableRoleOptions[0]},$_addLink(){this.saving=!0;const e=t.DateTime_1.fromJSDate(this.expireDate).setLocale(this.$language.current).endOf("day"),s={expireDate:e.isValid?e.toFormat("yyyy-MM-dd'T'HH:mm:ssZZZ"):"",permissions:this.selectedRole.bitmask(!1),name:this.name};null!==this.password&&(s.password=this.password),this.addLink({path:this.highlightedFile.path,client:this.$client,$gettext:this.$gettext,params:s}).then((e=>{this.saving=!1,this.errors=!1,this.$_closeForm()})).catch((e=>{this.saving=!1,this.errors=e}))},$_updateLink(){this.saving=!0;const e=t.DateTime_1.fromJSDate(this.expireDate).setLocale(this.$language.current).endOf("day"),s={expireDate:e.isValid?e.toFormat("yyyy-MM-dd'T'HH:mm:ssZZZ"):"",permissions:this.selectedRole.bitmask(!1),name:this.name};null!==this.password&&(s.password=this.password),this.updateLink({id:this.publicLinkInEdit.id,client:this.$client,$gettext:this.$gettext,params:s}).then((()=>{this.saving=!1,this.errors=!1,this.$_closeForm()})).catch((e=>{this.saving=!1,this.errors=e}))},$_closeForm(){this.changeView("showLinks")},removePassword:function(){this.password="",this.hasPassword=!1},getRoleFromSelectOption:e=>e.role,convertRoleToSelectOption(e){return{role:e,name:e.name,label:this.$gettext(e.label)}}}};var Qt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-files-edit-public-link oc-files-file-link-form",attrs:{"data-testid":"new-files-link"}},[s("form",{on:{submit:function(e){e.preventDefault()}}},[s("transition",{attrs:{"enter-active-class":"uk-animation-slide-top-small","leave-active-class":"uk-animation-slide-top-small uk-animation-reverse",name:"custom-classes-transition"}},[e.errors?s("oc-alert",{staticClass:"oc-files-file-link-error-alert",attrs:{variation:"danger"}},[e._v("\n        "+e._s(e.errors)+"\n      ")]):e._e()],1),e._v(" "),s("div",{staticClass:"oc-mb"},[s("oc-text-input",{ref:"nameInput",attrs:{id:"oc-files-file-link-name",label:e.$gettext("Name")},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),s("oc-select",{staticClass:"oc-mb files-file-link-role-button-wrapper",attrs:{id:"files-file-link-role-button",options:e.availableRoleOptions,clearable:!1,label:e.selectedRoleLabel},scopedSlots:e._u([{key:"option",fn:function(t){return[s("role-item",{attrs:{role:e.getRoleFromSelectOption(t),"allow-share-permission":!1}})]}},{key:"no-options",fn:function(){return[e._v(" No matching role found ")]},proxy:!0}]),model:{value:e.selectedRoleOption,callback:function(t){e.selectedRoleOption=t},expression:"selectedRoleOption"}}),e._v(" "),e.$_expirationDate?s("div",{staticClass:"oc-mb"},[s("label",{attrs:{for:"files-links-expiration-btn"},domProps:{textContent:e._s(e.expirationDateLabel)}}),e._v(" "),s("oc-datepicker",{key:"oc-datepicker-"+e.expireDate,staticClass:"files-recipient-expiration-datepicker",attrs:{id:"oc-files-file-link-expire-date","min-date":e.minExpirationDate,"max-date":e.maxExpirationDate,locale:e.$language.current,"is-required":e.$_expirationDate.enforced,"data-testid":"recipient-datepicker"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.togglePopover;return[s("oc-button",{staticClass:"uk-width-1-1 expiration-dialog-btn",attrs:{id:"files-links-expiration-btn","data-testid":"recipient-datepicker-btn","justify-content":"space-between","gap-size":"xsmall"},on:{click:i}},[e.expireDate?s("translate",{key:"set-expiration-date-label",attrs:{"translate-params":{expires:e.relativeExpirationDate}}},[e._v("\n              Expires %{expires}\n            ")]):s("translate",{key:"no-expiration-date-label"},[e._v("Set expiration date")]),e._v(" "),s("oc-icon",{attrs:{name:"expand_more"}})],1)]}}],null,!1,2975795175),model:{value:e.expireDate,callback:function(t){e.expireDate=t},expression:"expireDate"}}),e._v(" "),!e.$_expirationDate.enforced&&e.expireDate?s("oc-button",{staticClass:"oc-mt-s",attrs:{id:"oc-files-file-link-expire-date-delete",appearance:"raw","data-testid":"files-link-remove-expiration-date"},domProps:{textContent:e._s(e.$gettext("Remove expiration date"))},on:{click:function(t){e.expireDate=null}}}):e._e()],1):e._e(),e._v(" "),s("div",[s("oc-text-input",{attrs:{id:"oc-files-file-link-password",type:"password",label:e.passwordLabel},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),e.$_passwordEnforced||!e.password&&!e.hasPassword?e._e():s("oc-button",{staticClass:"oc-mt-s",attrs:{id:"oc-files-file-link-password-delete",appearance:"raw"},domProps:{textContent:e._s(e.$gettext("Remove password"))},on:{click:e.removePassword}})],1),e._v(" "),s("hr",{staticClass:"divider"}),e._v(" "),s("oc-grid",{staticClass:"oc-mb",attrs:{gutter:"small"}},[s("div",[s("oc-button",{attrs:{id:"oc-files-file-link-cancel",disabled:e.saving},on:{click:e.$_closeForm}},[s("translate",[e._v("Cancel")])],1)],1),e._v(" "),s("div",[e.saving?s("oc-button",{attrs:{id:"oc-files-file-link-saving",variation:"primary",appearance:"filled",disabled:""}},[e.$_isNew?[s("oc-spinner",{attrs:{"aria-label":e.$gettext("Creating Public Link"),size:"small"}}),e._v(" "),s("span",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"data-testid":"files-link-being-created","aria-hidden":!0}},[e._v("Creating")])]:[s("oc-spinner",{attrs:{"aria-label":e.$gettext("Saving Public Link"),size:"small"}}),e._v(" "),s("span",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"data-testid":"files-link-being-saved","aria-hidden":!0}},[e._v("Saving")])]],2):[e.$_isNew?s("oc-button",{attrs:{id:"oc-files-file-link-create","data-testid":"new-files-link-btn",disabled:!e.$_isValid,variation:"primary",appearance:"filled"},on:{click:e.$_addLink}},[s("translate",[e._v("Create")])],1):s("oc-button",{attrs:{id:"oc-files-file-link-save","data-testid":"save-files-link-btn",disabled:!e.$_isValid||!e.$_hasChanges,variation:"primary",appearance:"filled"},on:{click:e.$_updateLink}},[s("translate",[e._v("Save")])],1)]],2)])],1)])};Qt._withStripped=!0;const Jt=t.normalizeComponent({render:Qt,staticRenderFns:[]},undefined,Yt,undefined,false,undefined,!1,void 0,void 0,void 0);const Kt={name:"LinkActions",inject:["changeView"],props:{link:{type:Object,required:!0}},data:()=>({removalInProgress:!1}),computed:{...t.mapGetters("Files",["highlightedFile"]),editButtonLabel(){return this.$gettext("Edit public link")},deleteButtonLabel(){return this.$gettext("Delete public link")}},methods:{...t.mapActions(["showMessage","createModal","hideModal"]),...t.mapActions("Files",["removeLink"]),...t.mapMutations("Files",["TRIGGER_PUBLIC_LINK_EDIT"]),$_removeLink(){const e={variation:"danger",title:this.$gettext("Delete public link"),message:this.$gettext("Are you sure you want to delete this link? Recreating the same link again is not possible."),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Delete"),onCancel:this.hideModal,onConfirm:()=>this.deleteLink({client:this.$client,share:this.link,resource:this.highlightedFile})};this.createModal(e)},deleteLink({client:e,share:t,resource:s}){this.hideModal(),this.removeLink({client:e,share:t,resource:s}),this.showMessage({title:this.$gettext("Public link was successfully deleted"),autoClose:{enabled:!0}})},editLink(){this.TRIGGER_PUBLIC_LINK_EDIT(this.link),this.changeView("editPublicLink")}}};var Xt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"uk-flex uk-flex-nowrap uk-flex-middle"},[e.removalInProgress?s("oc-spinner",{attrs:{"aria-label":e.$gettext("Removing public link")}}):[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.editButtonLabel,expression:"editButtonLabel"}],staticClass:"oc-files-file-link-edit oc-mr-xs",attrs:{"aria-label":e.editButtonLabel,"data-testid":"files-link-id-"+e.link.id+"-btn-edit",appearance:"raw"},on:{click:e.editLink}},[s("oc-icon",{attrs:{name:"edit"}})],1),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.deleteButtonLabel,expression:"deleteButtonLabel"}],staticClass:"oc-files-file-link-delete",attrs:{"aria-label":e.deleteButtonLabel,appearance:"raw"},on:{click:e.$_removeLink}},[s("oc-icon",{attrs:{name:"delete"}})],1)]],2)};Xt._withStripped=!0;const Zt=t.normalizeComponent({render:Xt,staticRenderFns:[]},undefined,Kt,undefined,false,undefined,!1,void 0,void 0,void 0);const es={props:{value:{type:String,required:!0},label:{type:String,required:!0},successMsgTitle:{type:String,required:!0},successMsgText:{type:String,required:!0}},data:()=>({copied:!1,timeout:null}),methods:{...t.mapActions(["showMessage"]),copyValueToClipboard(){t.copyToClipboard(this.value),this.clipboardSuccessHandler(),this.showMessage({title:this.successMsgTitle,desc:this.successMsgText,status:"success",autoClose:{enabled:!0}})},clipboardSuccessHandler(){this.copied=!0,clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.copied=!1}),550)}}};var ts=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.label,expression:"label"}],attrs:{"aria-label":e.label,appearance:"raw"},on:{click:e.copyValueToClipboard}},[e.copied?s("oc-icon",{key:"oc-copy-to-clipboard-copied",staticClass:"_clipboard-success-animation",attrs:{name:"ready"}}):s("oc-icon",{key:"oc-copy-to-clipboard-copy",attrs:{name:"copy_to_clipboard"}})],1)};ts._withStripped=!0;const ss=t.normalizeComponent({render:ts,staticRenderFns:[]},undefined,es,"data-v-18232aa2",false,undefined,!1,void 0,void 0,void 0);const is={name:"LinkInfo",components:{CopyToClipboardButton:ss},mixins:[at],props:{link:{type:Object,required:!0}},computed:{linkName(){return this.link.name?this.link.name:this.link.token},roleTagIcon(){switch(this.link.description){case"Viewer":return"remove_red_eye";case"Contributor":case"Editor":return"edit";case"Uploader":return"file_upload";default:return"key"}},viaLabel(){if(!this.link.indirect)return null;const e=this.$gettext("Via %{folderName}");return this.$gettextInterpolate(e,{folderName:t.basename(this.link.path)},!0)},viaRouterParams(){const e=this.link.path;return{name:"files-personal",params:{item:t.dirname(e)||"/"},query:{scrollTo:t.basename(e)}}},viaTooltip(){return this.$gettext("Navigate to the parent")},copyToClipboardLabel(){return this.$gettext("Copy link to clipboard")},copyToClipboardSuccessMsgTitle(){return this.$gettext("Public link copied")},expirationDate(){return t.DateTime_1.fromISO(this.link.expiration).setLocale(this.$language.current).endOf("day").toLocaleString(t.DateTime_1.DATETIME_FULL)},expirationDateRelative(){return t.DateTime_1.fromISO(this.link.expiration).setLocale(this.$language.current).endOf("day").toRelative()}},methods:{getCopyToClipboardSuccessMsgText(e){const t=this.$gettext('The public link "%{linkName}" has been copied to your clipboard.');return this.$gettextInterpolate(t,{linkName:e.name?e.name:""},!0)}}};var as=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"uk-width-expand"},[s("div",{staticClass:"oc-mb-s uk-width-1-1"},[s("h5",{staticClass:"oc-text-bold uk-text-truncate oc-files-file-link-name oc-my-rm oc-text-initial",domProps:{textContent:e._s(e.linkName)}}),e._v(" "),s("div",{staticClass:"uk-flex uk-flex-middle uk-width-1-1"},[s("a",{staticClass:"oc-files-file-link-url uk-text-truncate",attrs:{href:e.link.url,target:"_blank"},domProps:{textContent:e._s(e.link.url)}}),e._v(" "),s("copy-to-clipboard-button",{staticClass:"oc-files-public-link-copy-url oc-ml-xs",attrs:{value:e.link.url,label:e.copyToClipboardLabel,"success-msg-title":e.copyToClipboardSuccessMsgTitle,"success-msg-text":e.getCopyToClipboardSuccessMsgText(e.link)}})],1)]),e._v(" "),s("oc-grid",{attrs:{gutter:"small"}},[s("div",[s("oc-tag",{staticClass:"oc-files-file-link-role"},[s("oc-icon",{attrs:{name:e.roleTagIcon}}),e._v("\n        "+e._s(e.link.description)+"\n      ")],1)],1),e._v(" "),e.link.expiration?s("div",[s("oc-tag",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.expirationDate,expression:"expirationDate"}],staticClass:"oc-files-public-link-expires",attrs:{tabindex:"0","data-testid":"files-link-id-"+e.link.id+"-expiration-date","aria-label":e.expirationDateRelative+" ("+e.expirationDate+")"}},[s("oc-icon",{attrs:{name:"text-calendar"}}),e._v(" "),s("translate",{attrs:{"translate-params":{expires:e.expirationDateRelative}}},[e._v("\n          Expires %{expires}\n        ")])],1)],1):e._e(),e._v(" "),e.link.password?s("div",[s("oc-tag",{staticClass:"oc-files-file-link-password"},[s("oc-icon",{attrs:{name:"lock"}}),e._v(" "),s("translate",[e._v("Password protected")])],1)],1):e._e(),e._v(" "),e.link.indirect?s("div",[s("oc-tag",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.viaTooltip,expression:"viaTooltip"}],staticClass:"oc-files-file-link-via",attrs:{type:"router-link",to:e.viaRouterParams}},[s("oc-icon",{attrs:{name:"exit_to_app"}}),e._v(" "),s("span",{staticClass:"uk-text-truncate files-file-links-link-via-label",domProps:{textContent:e._s(e.viaLabel)}})],1)],1):e._e()])],1)};as._withStripped=!0;const rs={name:"PublicLinkListItem",components:{LinkActions:Zt,LinkInfo:t.normalizeComponent({render:as,staticRenderFns:[]},undefined,is,undefined,false,undefined,!1,void 0,void 0,void 0)},props:{link:{type:Object,required:!0}}};var os=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-grid",{staticClass:"\n    files-file-links-link files-file-links-link-table-row-info\n    uk-flex uk-flex-top uk-flex-between\n  ",attrs:{gutter:"small"}},[s("link-info",{attrs:{link:e.link}}),e._v(" "),e.link.indirect?e._e():s("link-actions",{attrs:{link:e.link}})],1)};os._withStripped=!0;const ns=t.normalizeComponent({render:os,staticRenderFns:[]},undefined,rs,"data-v-53ab59cb",false,undefined,!1,void 0,void 0,void 0);const ls={name:"PrivateLinkItem",components:{CopyToClipboardButton:ss},inject:["displayedItem"],computed:{link(){const e=this.displayedItem.value;return e.isMounted()?window.location.href.split("?")[0]+`?scrollTo=${encodeURIComponent(e.name)}`:e.privateLink},copyToClipboardLabel(){return this.$gettext("Copy private link to clipboard")},copyToClipboardSuccessMsgTitle(){return this.$gettext("Private link copied")},copyToClipboardSuccessMsgText(){return this.$gettext("The private link has been copied to your clipboard.")}}};var cs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-files-private-link-item",attrs:{"data-testid":"files-sidebar-private-link"}},[s("h4",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-text-bold oc-m-rm oc-text-initial"},[e._v("Private Link")]),e._v(" "),s("p",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-text-muted oc-my-rm"},[e._v("Only invited people can use this link.")]),e._v(" "),s("div",{staticClass:"uk-width-1-1 uk-flex uk-flex-middle"},[s("a",{staticClass:"uk-text-truncate",attrs:{href:e.link,target:"_blank"},domProps:{textContent:e._s(e.link)}}),e._v(" "),s("copy-to-clipboard-button",{staticClass:"oc-files-private-link-copy-url oc-ml-xs",attrs:{value:e.link,label:e.copyToClipboardLabel,"success-msg-title":e.copyToClipboardSuccessMsgTitle,"success-msg-text":e.copyToClipboardSuccessMsgText}})],1),e._v(" "),s("hr")])};cs._withStripped=!0;const ds="showLinks",us="editPublicLink";const hs={name:"FileLinks",components:{LinkEdit:Jt,ListItem:ns,PrivateLinkItem:t.normalizeComponent({render:cs,staticRenderFns:[]},undefined,ls,undefined,false,undefined,!1,void 0,void 0,void 0)},mixins:[at],title:e=>e("Links"),provide(){return{changeView:e=>this.$data.currentView=e}},data:()=>({VIEW_SHOW:ds,VIEW_EDIT:us,currentView:ds}),computed:{...t.mapGetters("Files",["highlightedFile","currentFileOutgoingLinks","currentFileOutgoingSharesLoading","sharesTreeLoading"]),...t.mapGetters(["capabilities"]),...t.mapState("Files",["sharesTree"]),$_transitionGroupEnter:()=>"uk-animation-slide-left-medium",$_transitionGroupLeave:()=>"uk-animation-slide-right-medium uk-animation-reverse",canCreatePublicLinks(){return this.highlightedFile.canShare()},noResharePermsMessage(){const e=this.$gettext("You don't have permission to share this file."),t=this.$gettext("You don't have permission to share this folder.");return"file"===this.highlightedFile.type?e:t},linksLoading(){return this.currentFileOutgoingSharesLoading||this.sharesTreeLoading},links(){return[...this.currentFileOutgoingLinks,...this.indirectLinks].sort(this.linksComparator).map((e=>(e.key="direct-link-"+e.id,e)))},indirectLinks(){const t=[],s=c(this.highlightedFile.path,!1);return 0===s.length?[]:(s.pop(),s.forEach((s=>{const i=X(this.sharesTree[s]);i&&i.forEach((s=>{s.outgoing&&s.shareType===e.ShareTypes.link.value&&(s.key="indirect-link-"+s.id,t.push(s))}))})),t.sort(this.linksComparator))},$_noPublicLinks(){return 0===this.links.length},$_expirationDate(){const e=this.capabilities.files_sharing.public.expire_date;return{enabled:!!e.enabled,days:!!e.days&&e.days,enforced:"1"===e.enforced}},$_addButtonLabel(){return this.$gettext("Public link")},$_addButtonAriaLabel(){return this.$gettext("Create new public link")},privateLinkEnabled(){return this.capabilities.files.privateLinks}},watch:{highlightedFile(e,t){t!==e&&this.$_reloadLinks()}},mounted(){this.$_reloadLinks()},methods:{...t.mapActions("Files",["loadSharesTree","loadCurrentFileOutgoingShares"]),...t.mapMutations("Files",["TRIGGER_PUBLIC_LINK_CREATE"]),$_showList(){this.currentView=ds},$_reloadLinks(){this.$_showList(),this.loadCurrentFileOutgoingShares({client:this.$client,path:this.highlightedFile.path,$gettext:this.$gettext}),this.loadSharesTree({client:this.$client,path:t.dirname(this.highlightedFile.path),$gettext:this.$gettext})},linksComparator(e,t){const s=e.name.toLowerCase().trim(),i=t.name.toLowerCase().trim(),a=!e.indirect;return a===!t.indirect?s===i?e.stime-t.stime:wt.naturalSortCompare(s,i):a?-1:1},addNewLink(){this.TRIGGER_PUBLIC_LINK_CREATE({name:this.capabilities.files_sharing.public.defaultPublicLinkShareName,expireDate:this.$_expirationDate.days?t.DateTime_1.now().plus({days:this.$_expirationDate.days}).endOf("day").toISO():null}),this.currentView=us}}};var ps=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"uk-position-relative",attrs:{id:"oc-files-file-link"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.currentView===e.VIEW_SHOW,expression:"currentView === VIEW_SHOW"}],key:e.VIEW_SHOW,attrs:{"aria-hidden":e.currentView!==e.VIEW_SHOW}},[e.linksLoading?s("oc-loader",{attrs:{"aria-label":e.$gettext("Loading list of file links")}}):[e.privateLinkEnabled?s("private-link-item"):e._e(),e._v(" "),s("h3",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-text-bold oc-m-rm oc-text-initial"},[e._v("Public Links")]),e._v(" "),e.canCreatePublicLinks?s("div",{staticClass:"oc-my-s"},[s("p",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-text-muted"},[e._v("\n          Any external person with the respective link can access this resource. No sign-in\n          required. Assign a password to avoid unintended document exposure.\n        ")]),e._v(" "),s("oc-button",{attrs:{id:"files-file-link-add",icon:"add",variation:"primary","data-testid":"files-link-add-btn","aria-label":e.$_addButtonAriaLabel},on:{click:e.addNewLink}},[s("oc-icon",{attrs:{name:"add"}}),e._v("\n          "+e._s(e.$_addButtonLabel)+"\n        ")],1)],1):s("p",{staticClass:"oc-mt-s",attrs:{"data-testid":"files-links-no-reshare-permissions-message"},domProps:{textContent:e._s(e.noResharePermsMessage)}}),e._v(" "),s("transition-group",{staticClass:"uk-list uk-list-divider uk-overflow-hidden oc-m-rm",attrs:{"enter-active-class":e.$_transitionGroupEnter,"leave-active-class":e.$_transitionGroupLeave,name:"custom-classes-transition",tag:"ul"}},e._l(e.links,(function(e){return s("li",{key:e.key},[s("list-item",{attrs:{"data-testid":"files-link-id-"+e.id,link:e}})],1)})),0),e._v(" "),e.$_noPublicLinks&&e.canCreatePublicLinks?s("p",{directives:[{name:"translate",rawName:"v-translate"}],key:"oc-file-links-no-results",staticClass:"oc-my-rm",attrs:{id:"oc-file-links-no-results"}},[e._v("\n        No public links\n      ")]):e._e()]],2),e._v(" "),e.currentView===e.VIEW_EDIT?s("div",{key:e.VIEW_EDIT},[s("transition",{attrs:{"enter-active-class":"uk-animation-slide-right uk-animation-fast","leave-active-class":"uk-animation-slide-right uk-animation-reverse uk-animation-fast",name:"custom-classes-transition"}},[s("link-edit")],1)],1):e._e()])};ps._withStripped=!0;const ms=t.normalizeComponent({render:ps,staticRenderFns:[]},undefined,hs,undefined,false,undefined,!1,void 0,void 0,void 0);const fs={name:"NoSelection",mixins:[at,rt,ot],title:e=>e("Details"),computed:{selectedFilesString(){return this.$gettext("Select a file or folder to view details.")}}};var gs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"uk-text-center oc-mt-xl",attrs:{id:"oc-no-selection"}},[s("oc-icon",{attrs:{size:"xxlarge",name:"select_items"}}),e._v(" "),s("p",{attrs:{"data-testid":"selectedFilesText"},domProps:{textContent:e._s(e.selectedFilesString)}})],1)};gs._withStripped=!0;const vs=t.normalizeComponent({render:gs,staticRenderFns:[]},undefined,fs,undefined,false,undefined,!1,void 0,void 0,void 0);var _s=[({rootFolder:e})=>({app:"no-selection-item",icon:"info_outline",component:vs,default:()=>!0,get enabled(){return e}}),({route:e,multipleSelection:t,rootFolder:s})=>({app:"details-item",icon:"info_outline",component:ct,default:!q(e),get enabled(){return!q(e)&&!t&&!s}}),({multipleSelection:e,rootFolder:t})=>({app:"details-multiple-item",icon:"info_outline",component:ht,default:()=>!0,get enabled(){return e&&!t}}),({route:e,multipleSelection:t,rootFolder:s})=>({app:"actions-item",component:_t,icon:"slideshow",default:q(e),get enabled(){return!t&&!s}}),({capabilities:e,route:t,multipleSelection:s,rootFolder:i})=>({app:"sharing-item",icon:"group",component:jt,get enabled(){return!s&&!i&&(!q(t)&&(!!e.files_sharing&&e.files_sharing.api_enabled))}}),({capabilities:e,route:t,multipleSelection:s,rootFolder:i})=>({app:"links-item",icon:"link",component:ms,get enabled(){return!s&&!i&&(!q(t)&&(!!e.files_sharing&&e.files_sharing.public.enabled))}}),({capabilities:e,highlightedFile:t,route:s,multipleSelection:i,rootFolder:a})=>({app:"versions-item",icon:"file_version",component:St,get enabled(){return!i&&!a&&(!q(s)&&(!!e.core&&t&&"folder"!==t.type))}})],bs={computed:{...t.mapGetters("Files",["activeFiles"]),$_emptyTrashBin_items(){return[{name:"empty-trash-bin",icon:"delete",label:()=>this.$gettext("Empty trash bin"),handler:this.$_emptyTrashBin_trigger,isEnabled:({resources:e})=>!!q(this.$route)&&0===e.length,isDisabled:()=>0===this.activeFiles.length,componentType:"oc-button",class:"oc-files-actions-empty-trash-bin-trigger",variation:"danger"}]}},methods:{...t.mapActions(["showMessage"]),...t.mapActions("Files",["clearTrashBin"]),$_emptyTrashBin_trigger(){this.$client.fileTrash.clearTrashBin().then((()=>{this.showMessage({title:this.$gettext("All deleted files were removed")}),this.clearTrashBin()})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Could not delete files"),status:"danger"})}))}}};const xs={name:"BatchActions",components:{ActionMenuItem:ft},mixins:[Q,J,K,Z,te,se,bs,re,le],computed:{...t.mapGetters("Files",["selectedFiles"]),filterParams(){return{resources:this.selectedFiles}},menuItemsBatchActions(){return[...this.$_acceptShare_items,...this.$_declineShare_items,...this.$_downloadArchive_items,...this.$_downloadFile_items,...this.$_move_items,...this.$_copy_items,...this.$_emptyTrashBin_items,...this.$_delete_items,...this.$_restore_items].filter((e=>e.isEnabled({resources:this.selectedFiles})))}}};var Ss=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-list",{staticClass:"oc-files-appbar-batch-actions uk-width-1-1"},e._l(e.menuItemsBatchActions,(function(t,i){return s("action-menu-item",{key:"batch-action-"+i,staticClass:"oc-mr-s",attrs:{action:t,items:e.selectedFiles,appearance:"outline"}})})),1)};Ss._withStripped=!0;const ys=t.normalizeComponent({render:Ss,staticRenderFns:[]},undefined,xs,undefined,false,undefined,!1,void 0,void 0,void 0);const ws={components:{vueDropzone:t.vue2Dropzone},mixins:[at],props:{rootPath:{type:String,required:!0},path:{type:String,required:!0},headers:{type:Object,default:()=>({})},requestType:{type:String,default:"PUT"}},data:()=>({ocDropzone_options:{url:"#",clickable:!1,autoQueue:!1}}),computed:{...t.mapGetters("Files",["dropzone"])},methods:{...t.mapActions("Files",["dragOver"]),$_ocDropzone_dragEnd(){this.dragOver(!1)},$_ocDropzone_removeFiles(e){this.$refs.ocDropzone.removeFile(e)}}};var Cs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.dropzone?s("vue-dropzone",{ref:"ocDropzone",staticClass:"oc-dropzone",attrs:{id:"oc-dropzone",options:e.ocDropzone_options,"use-custom-slot":!0,"include-styling":!1},on:{"vdropzone-drop":e.$_ocUpload_addDropToQueue,"vdropzone-files-added":e.$_ocDropzone_dragEnd,"vdropzone-file-added":e.$_ocDropzone_removeFiles,"vdropzone-drag-leave":e.$_ocDropzone_dragEnd}},[s("oc-dropzone",[s("translate",[e._v(" Drag and drop to upload content into current folder ")])],1)],1):e._e()};Cs._withStripped=!0;const Es=t.normalizeComponent({render:Cs,staticRenderFns:[]},undefined,ws,undefined,false,undefined,!1,void 0,void 0,void 0);const ks={mixins:[at],props:{path:{type:String,required:!0},headers:{type:Object,default:()=>({})},additionalData:{type:Object,default:()=>({})},requestType:{type:String,default:"PUT"}},methods:{triggerUpload(){this.$refs.input.click()}}};var $s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("oc-button",{staticClass:"uk-width-1-1",attrs:{"justify-content":"left",appearance:"raw"},on:{click:e.triggerUpload}},[s("oc-icon",{attrs:{name:"file_upload"}}),e._v(" "),s("span",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{id:"files-file-upload-button"}},[e._v("Upload File")])],1),e._v(" "),s("input",{ref:"input",attrs:{id:"fileUploadInput",type:"file","aria-labelledby":"files-file-upload-button",name:"file",multiple:"",tabindex:"-1"},on:{change:e.$_ocUpload_addFileToQueue}})],1)};$s._withStripped=!0;const Fs=t.normalizeComponent({render:$s,staticRenderFns:[]},undefined,ks,"data-v-092ff3fe",false,undefined,!1,void 0,void 0,void 0);const Rs={mixins:[at],props:{rootPath:{type:String,required:!0},path:{type:String,required:!0},headers:{type:Object,default:()=>({})},additionalData:{type:Object,default:()=>({})},requestType:{type:String,default:"PUT"}},methods:{triggerUpload(){this.$refs.input.click()}}};var Ts=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("oc-button",{staticClass:"uk-width-1-1",attrs:{"justify-content":"left",appearance:"raw"},on:{click:e.triggerUpload}},[s("oc-icon",{attrs:{name:"cloud_upload"}}),e._v(" "),s("span",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{id:"files-folder-upload-button"}},[e._v("Upload Folder")])],1),e._v(" "),s("input",{ref:"input",attrs:{id:"folderUploadInput",type:"file",name:"folder","aria-labelledby":"files-folder-upload-button",webkitdirectory:"",mozdirectory:"",allowdirs:"",tabindex:"-1"},on:{change:e.$_ocUpload_addDirectoryToQueue}})],1)};Ts._withStripped=!0;const Is=t.normalizeComponent({render:Ts,staticRenderFns:[]},undefined,Rs,"data-v-6335a2c7",false,undefined,!1,void 0,void 0,void 0);const Ps={mixins:[rt],computed:{...t.mapGetters("Files",["selectedFiles"]),selectedResourcesAmount(){return this.selectedFiles.length},selectedResourcesSize(){const e=X(this.selectedFiles);let t=0;for(const s of e)t+=parseInt(s.size,10);return this.getResourceSize(t)},clearSelectionLabel(){return this.$gettext("Clear selection")}},methods:{...t.mapMutations("Files",["RESET_SELECTION"])}};var Ds=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"uk-flex uk-flex-middle uk-text-nowrap"},["?"!==e.selectedResourcesSize?s("translate",{key:"multiple-select-info-with-size",attrs:{"translate-n":e.selectedResourcesAmount,"translate-params":{amount:e.selectedResourcesAmount,size:e.selectedResourcesSize},"translate-plural":"%{ amount } selected items - %{ size }","translate-comment":"Number of selected resources and their size displayed above the files list"}},[e._v("%{ amount } selected item - %{ size }\n  ")]):s("translate",{key:"multiple-select-info",attrs:{"translate-n":e.selectedResourcesAmount,"translate-params":{amount:e.selectedResourcesAmount},"translate-plural":"%{ amount } selected items","translate-comment":"Number of selected resources displayed above the files list"}},[e._v("%{ amount } selected item\n  ")]),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.clearSelectionLabel,expression:"clearSelectionLabel"}],staticClass:"oc-ml",attrs:{id:"files-clear-selection","aria-label":e.clearSelectionLabel},on:{click:e.RESET_SELECTION}},[s("oc-icon",{attrs:{name:"close"}})],1)],1)};Ds._withStripped=!0;const Ls=t.normalizeComponent({render:Ds,staticRenderFns:[]},undefined,Ps,undefined,false,undefined,!1,void 0,void 0,void 0);const As={setup(){const{pagination:e}=$e(),s=we("items-per-page",e.perPage.value);return t.watch(s,(t=>{e.perPage.value=t})),{itemsPerPage:s}},computed:{...t.mapState("Files",["areHiddenFilesShown"]),...t.mapState("Files/sidebar",{sidebarClosed:"closed"}),viewOptionsButtonLabel(){return this.$gettext("Display customization options of the files list")},toggleSidebarButtonLabel(){return this.sidebarClosed?this.$gettext("Open sidebar to view details"):this.$gettext("Close sidebar to hide details")},toggleIcon(){return this.sidebarClosed?"chevron_double_left":"chevron_double_right"},hiddenFilesShownModel:{get(){return this.areHiddenFilesShown},set(e){this.SET_HIDDEN_FILES_VISIBILITY(e)}}},methods:{...t.mapMutations("Files",["SET_HIDDEN_FILES_VISIBILITY"]),...t.mapActions("Files/sidebar",{toggleSidebar:"toggle"})}};var Os=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.viewOptionsButtonLabel,expression:"viewOptionsButtonLabel"}],key:"files-view-options-btn",staticClass:"oc-py-s oc-mb-xs",attrs:{id:"files-view-options-btn","data-testid":"files-view-options-btn","aria-label":e.viewOptionsButtonLabel,variation:"passive",appearance:"raw"}},[s("oc-icon",{attrs:{name:"tune"}})],1),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.toggleSidebarButtonLabel,expression:"toggleSidebarButtonLabel"}],staticClass:"oc-ml-s oc-py-s oc-mb-xs",attrs:{id:"files-toggle-sidebar","aria-label":e.toggleSidebarButtonLabel,variation:"passive",appearance:"raw"},on:{click:function(t){return t.stopPropagation(),e.toggleSidebar.apply(null,arguments)}}},[s("oc-icon",{attrs:{name:e.toggleIcon}})],1),e._v(" "),s("oc-drop",{staticClass:"uk-width-auto",attrs:{"drop-id":"files-view-options-drop",toggle:"#files-view-options-btn",mode:"click","padding-size":"small"}},[s("oc-list",[s("li",{staticClass:"files-view-options-list-item"},[s("oc-switch",{attrs:{"data-testid":"files-switch-hidden-files",label:e.$gettext("Show hidden files")},model:{value:e.hiddenFilesShownModel,callback:function(t){e.hiddenFilesShownModel=t},expression:"hiddenFilesShownModel"}})],1),e._v(" "),s("li",{staticClass:"files-view-options-list-item"},[s("oc-page-size",{staticClass:"files-pagination-size",attrs:{"data-testid":"files-pagination-size",label:e.$gettext("Items per page"),options:[100,500,1e3,e.$gettext("All")]},model:{value:e.itemsPerPage,callback:function(t){e.itemsPerPage=t},expression:"itemsPerPage"}})],1)])],1)],1)};Os._withStripped=!0;const Ns=t.normalizeComponent({render:Os,staticRenderFns:[]},undefined,As,"data-v-6ddabd4a",false,undefined,!1,void 0,void 0,void 0);const Ms={name:"ContextActions",components:{ActionMenuItem:ft},mixins:[ue,Q,J,{computed:{$_createPublicLink_items(){return[{name:"create-public-link",icon:l.publicLink.icon,label:()=>this.$gettext("Create & copy public link"),handler:this.$_createPublicLink_trigger,isEnabled:({resources:t})=>1===t.length&&((!H(this.$route)||t[0].status===e.ShareStatus.accepted)&&n(t[0],this.$store)),componentType:"oc-button",class:"oc-files-actions-create-public-link-trigger"}]}},methods:{$_createPublicLink_trigger({resources:e}){r({item:e[0],client:this.$client,store:this.$store,$gettext:this.$gettext})}}},K,Z,te,se,bs,ie,re,oe,ne,le,{computed:{$_showActions_items(){return[{name:"show-actions",icon:"slideshow",label:()=>this.$gettext("All Actions"),handler:this.$_showActions_trigger,isEnabled:({resources:e})=>1===e.length,componentType:"oc-button",class:"oc-files-actions-show-actions-trigger"}]}},methods:{...t.mapActions("Files/sidebar",{openSidebarWithPanel:"openWithPanel"}),async $_showActions_trigger(){await this.openSidebarWithPanel(q(this.$route)?null:"actions-item")}}},{computed:{$_showDetails_items(){return[{name:"show-details",icon:"info_outline",label:()=>this.$gettext("Details"),handler:this.$_showDetails_trigger,isEnabled:({resources:e})=>!q(this.$route)&&e.length>0,componentType:"oc-button",class:"oc-files-actions-show-details-trigger"}]}},methods:{...t.mapActions("Files/sidebar",{openSidebar:"open"}),async $_showDetails_trigger(){await this.openSidebar()}}},{computed:{$_showShares_items(){return[{name:"show-shares",icon:l.collaborators.icon,label:()=>this.$gettext("Share"),handler:this.$_showShares_trigger,isEnabled:({resources:t})=>!q(this.$route)&&(1===t.length&&((!H(this.$route)||t[0].status===e.ShareStatus.accepted)&&n(t[0],this.$store))),componentType:"oc-button",class:"oc-files-actions-show-shares-trigger"}]}},methods:{$_showShares_trigger({resources:e}){o({item:e[0],client:this.$client,store:this.$store})}}}],props:{items:{type:Array,required:!0}},computed:{menuSections(){const e=[];return this.items.length>1?(e.push({name:"batch-actions",items:this.menuItemsBatchActions}),e):(this.menuItemsContext.length&&e.push({name:"context",items:this.menuItemsContext}),this.menuItemsActions.length&&e.push({name:"actions",items:this.menuItemsActions}),this.menuItemsSidebar.length&&e.push({name:"sidebar",items:this.menuItemsSidebar}),e)},filterParams(){return{resources:this.items}},menuItemsBatchActions(){return[...this.$_acceptShare_items,...this.$_declineShare_items,...this.$_downloadArchive_items,...this.$_move_items,...this.$_copy_items,...this.$_emptyTrashBin_items,...this.$_restore_items,...this.$_delete_items,...this.$_showDetails_items].filter((e=>e.isEnabled(this.filterParams)))},menuItemsContext(){return[...[...this.$_fileActions_editorActions,...this.$_fileActions_loadExternalAppActions(this.filterParams.resources),...this.$_navigate_items,...this.$_fetch_items],...this.$_downloadArchive_items,...this.$_downloadFile_items,...this.$_createPublicLink_items,...this.$_showShares_items,...this.$_favorite_items.map((e=>(e.keepOpen=!0,e)))].filter((e=>e.isEnabled(this.filterParams)))},menuItemsActions(){return[...this.$_rename_items,...this.$_move_items,...this.$_copy_items,...this.$_restore_items,...this.$_acceptShare_items,...this.$_declineShare_items,...this.$_delete_items,...this.$_showActions_items].filter((e=>e.isEnabled(this.filterParams)))},menuItemsSidebar(){return[...this.$_showDetails_items].filter((e=>e.isEnabled(this.filterParams)))}},methods:{getSectionClasses(e){const t=[];return 0===e&&t.push("oc-mt-s"),e<this.menuSections.length-1&&t.push("oc-files-context-actions-border","oc-pb-s","oc-mb-s"),e===this.menuSections.length-1&&t.push("oc-mb-s"),t}}};var Us=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-files-context-menu"}},[e._l(e.menuSections,(function(t,i){return[s("oc-list",{key:"section-"+t.name+"-list",staticClass:"oc-files-context-actions",class:e.getSectionClasses(i),attrs:{id:"oc-files-context-actions-"+t.name}},e._l(t.items,(function(i,a){return s("action-menu-item",{key:"section-"+t.name+"-action-"+a,staticClass:"oc-files-context-action oc-py-xs oc-px-s",attrs:{action:i,items:e.items}})})),1)]}))],2)};Us._withStripped=!0;const zs=t.normalizeComponent({render:Us,staticRenderFns:[]},undefined,Ms,undefined,false,undefined,!1,void 0,void 0,void 0);const Bs={components:{BatchActions:ys,FileDrop:Es,FileUpload:Fs,FolderUpload:Is,SizeInfo:Ls,ViewOptions:Ns,ContextActions:zs},mixins:[at,ue,ot,Ke],data:()=>({newFileAction:null,path:"",fileFolderCreationLoading:!1}),computed:{...t.mapGetters(["getToken","configuration","newFileHandlers","quota","user"]),...t.mapGetters("Files",["files","currentFolder","selectedFiles","publicLinkPassword"]),...t.mapState(["route"]),...t.mapState("Files",["areHiddenFilesShown"]),newButtonTooltip(){return this.canUpload?this.hasFreeSpace?null:this.$gettext("You have not enough space left to upload!"):this.$gettext("You have no permission to upload!")},newButtonAriaLabel(){const e=this.newButtonTooltip;return e||this.$gettext("Add files or folders")},currentPath(){const e=this.$route.params.item||"";return e.endsWith("/")?e:e+"/"},currentPathSegments(){const e=this.currentPath.replace(/^\/+/,"").replace(/\/+$/,"");return t.isEmpty(e)?[]:e.split("/")},headers(){if(this.publicPage()){const e=this.publicLinkPassword;return e?{Authorization:"Basic "+t.Buffer.from("public:"+e).toString("base64")}:{}}return{Authorization:"Bearer "+this.getToken}},canUpload(){return null!==this.currentFolder&&this.currentFolder.canUpload()},showActions(){return!0!==this.$route.meta.hideFilelistActions},hasBulkActions(){return!0===this.$route.meta.hasBulkActions},showBreadcrumb(){return this.isPublicFilesRoute||this.isPersonalRoute},pageTitle(){const e=this.$route.meta.title;return this.$gettext(e)},breadcrumbs(){const e=this.currentPathSegments,s=[];let a;const r=[];this.isPersonalRoute?(a="/files/list/all/",r.push("/"),s.push({text:this.$gettext("All files")}),e.length<1?s[0].onClick=()=>i.bus.publish("app.files.list.load",this.$route.params.item):s[0].to=a+encodeURIComponent(t.pathUtil.join(...r))):(a="/files/public/list/",r.push(e.splice(0,1)[0]),s.push({text:this.$gettext("Public link"),to:a+encodeURIComponent(t.pathUtil.join(...r))}));for(let o=0;o<e.length;o++){r.push(e[o]);const n=a+encodeURIComponent(t.pathUtil.join(...r));o!==e.length-1?s.push({text:e[o],to:o+1===e.length?null:n}):s.push({text:e[o],onClick:()=>i.bus.publish("app.files.list.load",this.$route.params.item)})}return s},hasFreeSpace(){return!this.quota||this.quota.free>0||this.currentFolder&&this.currentFolder.permissions&&this.currentFolder.permissions.indexOf("M")>=0||this.publicPage()},areDefaultActionsVisible(){return this.selectedFiles.length<1},isNewBtnDisabled(){return!this.canUpload||!this.hasFreeSpace},selectedResourcesAnnouncement(){if(0===this.selectedFiles.length)return this.$gettext("No items selected.");const e=this.$ngettext("%{ amount } item selected. Actions are available above the table.","%{ amount } items selected. Actions are available above the table.",this.selectedFiles.length);return this.$gettextInterpolate(e,{amount:this.selectedFiles.length})},showBreadcrumbContextMenu(){return this.currentPathSegments.length>0},newFileHandlersForRoute(){return this.newFileHandlers.filter((e=>G(e.routes,this.$route.name)))}},created(){const e="true"===(window.localStorage.getItem("oc_hiddenFilesShown")||"false");e!==this.areHiddenFilesShown&&this.SET_HIDDEN_FILES_VISIBILITY(e)},methods:{...t.mapActions("Files",["updateFileProgress","removeFilesFromTrashbin","loadIndicators","setFileSelection"]),...t.mapActions(["openFile","showMessage","createModal","setModalInputErrorMessage"]),...t.mapMutations("Files",["UPSERT_RESOURCE","SET_HIDDEN_FILES_VISIBILITY"]),...t.mapMutations(["SET_QUOTA"]),showCreateResourceModal(e=!0,t="txt",s=null){const i=e?this.$gettext("New folder"):this.$gettext("New file")+"."+t;e||(this.newFileAction=s);const a={variation:"passive",title:e?this.$gettext("Create a new folder"):this.$gettext("Create a new file"),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Create"),hasInput:!0,inputValue:i,inputLabel:e?this.$gettext("Folder name"):this.$gettext("File name"),inputError:e?this.checkNewFolderName(i):this.checkNewFileName(i),onCancel:this.hideModal,onConfirm:e?this.addNewFolder:this.addNewFile,onInput:t=>{this.setModalInputErrorMessage(e?this.checkNewFolderName(t):this.checkNewFileName(t))}};this.createModal(a)},async addNewFolder(s){if(""!==s){this.fileFolderCreationLoading=!0;try{const i=t.pathUtil.join(this.currentPath,s);let r;this.isPersonalRoute?(await this.$client.files.createFolder(i),r=await this.$client.files.fileInfo(i,a.DavProperties.Default)):(await this.$client.publicFiles.createFolder(i,null,this.publicLinkPassword),r=await this.$client.publicFiles.getFileInfo(i,this.publicLinkPassword,a.DavProperties.Default)),r=e.buildResource(r),this.UPSERT_RESOURCE(r),this.hideModal(),this.isPersonalRoute&&this.loadIndicators({client:this.$client,currentFolder:this.currentFolder.path}),setTimeout((()=>{this.setFileSelection([r]),this.scrollToResource(r)}))}catch(e){this.showMessage({title:this.$gettext("Creating folder failed…"),desc:e,status:"danger"})}this.fileFolderCreationLoading=!1}},checkNewFolderName(e){if(""===e)return this.$gettext("Folder name cannot be empty");if(/[/]/.test(e))return this.$gettext('Folder name cannot contain "/"');if("."===e)return this.$gettext('Folder name cannot be equal to "."');if(".."===e)return this.$gettext('Folder name cannot be equal to ".."');if(/\s+$/.test(e))return this.$gettext("Folder name cannot end with whitespace");if(this.files.find((t=>t.name===e))){const t=this.$gettext("%{name} already exists");return this.$gettextInterpolate(t,{name:e},!0)}return null},async addNewFile(s){if(""!==s){this.fileFolderCreationLoading=!0;try{const i=t.pathUtil.join(this.currentPath,s);let r;if(this.isPersonalRoute?(await this.$client.files.putFileContents(i,""),r=await this.$client.files.fileInfo(i,a.DavProperties.Default)):(await this.$client.publicFiles.putFileContents(i,null,this.publicLinkPassword,""),r=await this.$client.publicFiles.getFileInfo(i,this.publicLinkPassword,a.DavProperties.Default)),this.newFileAction){const e=r.fileInfo[a.DavProperty.FileId];return this.$_fileActions_openEditor(this.newFileAction,i,e,"create"),void this.hideModal()}r=e.buildResource(r),this.UPSERT_RESOURCE(r),this.hideModal(),this.isPersonalRoute&&this.loadIndicators({client:this.$client,currentFolder:this.currentFolder.path}),setTimeout((()=>{this.setFileSelection([r]),this.scrollToResource(r)}))}catch(e){this.showMessage({title:this.$gettext("Creating file failed…"),desc:e,status:"danger"})}this.fileFolderCreationLoading=!1}},checkNewFileName(e){if(""===e)return this.$gettext("File name cannot be empty");if(/[/]/.test(e))return this.$gettext('File name cannot contain "/"');if("."===e)return this.$gettext('File name cannot be equal to "."');if(".."===e)return this.$gettext('File name cannot be equal to ".."');if(/\s+$/.test(e))return this.$gettext("File name cannot end with whitespace");if(this.files.find((t=>t.name===e))){const t=this.$gettext("%{name} already exists");return this.$gettextInterpolate(t,{name:e},!0)}return null},async onFileSuccess(s,i){try{i.name&&(i=i.name),await this.$nextTick();const s=t.pathUtil.join(this.currentPath,i);let r=this.isPersonalRoute?await this.$client.files.fileInfo(s,a.DavProperties.Default):await this.$client.publicFiles.getFileInfo(s,this.publicLinkPassword,a.DavProperties.Default);r=e.buildResource(r),this.UPSERT_RESOURCE(r),this.isPersonalRoute&&this.loadIndicators({client:this.$client,currentFolder:this.currentFolder.path,encodePath:this.encodePath});const o=await this.$client.users.getUser(this.user.id);this.SET_QUOTA(o.quota)}catch(e){console.error(e)}},onFileError(e){this.showMessage({title:this.$gettext("File upload failed…"),desc:e.message,status:"danger"})},onFileProgress(e){this.updateFileProgress(e)}}};var Gs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"files-app-bar"},[s("oc-hidden-announcer",{attrs:{announcement:e.selectedResourcesAnnouncement,level:"polite"}}),e._v(" "),!e.isIE11()&&e.canUpload&&e.hasFreeSpace?s("file-drop",{attrs:{"root-path":e.currentPath,path:e.currentPath,headers:e.headers},on:{success:e.onFileSuccess,error:e.onFileError,progress:e.onFileProgress}}):e._e(),e._v(" "),s("div",{staticClass:"files-topbar oc-py-s"},[e.showBreadcrumb?s("oc-breadcrumb",{staticClass:"oc-p-s",attrs:{id:"files-breadcrumb","data-testid":"files-breadcrumbs",items:e.breadcrumbs},scopedSlots:e._u([{key:"contextMenu",fn:function(){return[e.currentFolder&&e.showBreadcrumbContextMenu?s("context-actions",{attrs:{items:[e.currentFolder]}}):e._e()]},proxy:!0}],null,!1,3279492124)}):e._e(),e._v(" "),s("h1",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.pageTitle)}}),e._v(" "),s("div",{staticClass:"files-app-bar-actions"},[e.showActions||e.selectedFiles.length>0||e.hasBulkActions?s("div",{staticClass:"uk-flex-1 uk-flex uk-flex-start"},[e.showActions&&e.areDefaultActionsVisible?[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.newButtonTooltip,expression:"newButtonTooltip"}],key:"new-file-menu-btn-enabled",staticClass:"oc-mb-xs",attrs:{id:"new-file-menu-btn","aria-label":e.newButtonAriaLabel,variation:"primary",appearance:"filled",disabled:e.isNewBtnDisabled}},[s("oc-icon",{attrs:{name:"add"}}),e._v(" "),s("translate",[e._v("New")])],1),e._v(" "),s("oc-drop",{attrs:{"drop-id":"new-file-menu-drop",toggle:"#new-file-menu-btn",mode:"click","close-on-click":"",options:{delayHide:0},"padding-size":"small"}},[s("ul",{staticClass:"uk-list"},[s("li",[s("file-upload",{attrs:{path:e.currentPath,headers:e.headers},on:{success:e.onFileSuccess,error:e.onFileError,progress:e.onFileProgress}})],1),e._v(" "),e.checkIfBrowserSupportsFolderUpload?s("li",[e.isIE11()?e._e():s("folder-upload",{attrs:{"root-path":e.currentPath,path:e.currentPath,headers:e.headers},on:{success:e.onFileSuccess,error:e.onFileError,progress:e.onFileProgress}})],1):e._e(),e._v(" "),s("li",[s("div",[s("oc-button",{staticClass:"uk-width-1-1",attrs:{id:"new-folder-btn",appearance:"raw","justify-content":"left"},on:{click:e.showCreateResourceModal}},[s("oc-icon",{attrs:{name:"create_new_folder"}}),e._v(" "),s("translate",[e._v("New folder…")])],1)],1)]),e._v(" "),e._l(e.newFileHandlersForRoute,(function(t,i){return s("li",{key:i},[s("div",[s("oc-button",{class:["new-file-btn-"+t.ext,"uk-width-1-1"],attrs:{appearance:"raw","justify-content":"left"},on:{click:function(s){return e.showCreateResourceModal(!1,t.ext,t.action)}}},[s("oc-icon",{attrs:{name:t.icon||"save"}}),e._v(" "),s("span",[e._v(e._s(t.menuTitle(e.$gettext)))])],1)],1)])}))],2)])]:e._e(),e._v(" "),e.hasBulkActions&&e.selectedFiles.length>0?s("size-info",{staticClass:"oc-mr uk-visible@l"}):e._e(),e._v(" "),e.hasBulkActions?s("batch-actions"):e._e()],2):e._e(),e._v(" "),s("view-options")],1)],1)],1)};Gs._withStripped=!0;const Vs=t.normalizeComponent({render:Gs,staticRenderFns:[]},undefined,Bs,"data-v-6746da36",false,undefined,!1,void 0,void 0,void 0);const qs={filters:{toInt:e=>parseInt(e)},mixins:[at,rt],props:{items:{type:Array,default:()=>[],required:!0}}};var Hs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",{staticClass:"uk-list uk-list-divider oc-ml-rm oc-mr-rm"},e._l(e.items,(function(t){return s("li",{key:t.id},[s("div",{staticClass:"uk-flex uk-flex-middle"},[s("oc-icon",{staticClass:"oc-mr-s",attrs:{name:"file_copy"}}),e._v(" "),s("div",{staticClass:"uk-width-expand"},[s("div",{staticClass:"uk-flex"},[s("div",{staticClass:"oc-text-bold uk-width-expand uk-text-truncate upload-details-item-name"},[e._v("\n            "+e._s(t.name)+"\n          ")]),e._v(" "),s("div",{staticClass:"uk-width-auto uk-text-nowrap upload-details-item-size"},[e._v("\n            "+e._s(e.getResourceSize(t.size))+"\n          ")])]),e._v(" "),s("div",{staticClass:"oc-m-rm uk-position-relative uk-width-expand"},[s("oc-progress",{staticClass:"uk-width-expand oc-m-rm",attrs:{"aria-hidden":!0,max:100,value:e._f("toInt")(t.progress)}}),e._v(" "),s("span",{staticClass:"uk-position-center oc-progress-text",attrs:{"aria-hidden":!0}},[e._v("\n            "+e._s(e._f("roundNumber")(t.progress))+" %\n          ")])],1)])],1)])})),0)};Hs._withStripped=!0;const Ws={name:"UploadProgress",components:{DetailsWidget:t.normalizeComponent({render:Hs,staticRenderFns:[]},undefined,qs,undefined,false,undefined,!1,void 0,void 0,void 0)},mixins:[at],data(){return{expanded:!1,announcement:"",announcementOnComplete:this.$gettext("Upload complete")}},computed:{...t.mapGetters("Files",["inProgress","uploaded"]),count(){return this.inProgress.length},totalUploadProgress(){let e=0,t=0;for(const s of this.inProgress)e+=s.size,t+=s.size*s.progress/100;for(const s of this.uploaded)e+=s.size,t+=s.size;return this.inProgress.length>0&&e>0?t/e*100:100},uploadPending(){return this.totalUploadProgress<100}},watch:{totalUploadProgress(e){100===e&&(this.expanded=!1,this.announcement=this.announcementOnComplete)}},created(){this.$root.$on("upload-start",(()=>{this.$nextTick((()=>{this.delayForScreenreader((()=>this.$refs.progressbar.$el.focus()))}))})),window.addEventListener("beforeunload",this.confirmUnload)},beforeDestroy(){window.removeEventListener("beforeunload",this.confirmUnload)},methods:{$_toggleExpanded(){this.expanded=!this.expanded},confirmUnload(e){this.uploadPending&&(e.preventDefault(),e.returnValue="")}}};var js=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"files-upload-progress uk-clearfix oc-py-rm"},[s("div",{staticClass:"oc-m-rm uk-position-relative uk-width-expand"},[s("oc-progress",{ref:"progressbar",staticClass:"uk-width-expand oc-m-rm",attrs:{"aria-hidden":!0,max:100,value:e.totalUploadProgress}}),e._v(" "),s("span",{staticClass:"uk-position-center oc-progress-text",attrs:{"aria-hidden":!0}},[e._v("\n      "+e._s(e._f("roundNumber")(e.totalUploadProgress))+" %\n    ")]),e._v(" "),s("oc-hidden-announcer",{attrs:{announcement:e.announcement,level:"assertive"}})],1),e._v(" "),s("oc-grid",{staticClass:"oc-mt-s oc-mb-s oc-text-muted oc-cursor-pointer",attrs:{flex:"","aria-label":e.$gettext("Click row to toggle upload progress details")},nativeOn:{click:function(t){return e.$_toggleExpanded.apply(null,arguments)}}},[s("oc-icon",{staticClass:"uk-width-auto",attrs:{name:e.expanded?"expand_less":"expand_more"}}),e._v(" "),s("div",{staticClass:"uk-width-expand uk-text-truncate"},[1===e.count?s("span",{directives:[{name:"translate",rawName:"v-translate",value:{fileName:e.inProgress[0].name},expression:"{ fileName: inProgress[0].name }"}],key:"upload-progress-single",attrs:{id:"files-upload-progress-single","translate-comment":"Upload progress when only uploading one file shows the name of the file."}},[e._v('\n        Uploading "%{ fileName }"\n      ')]):s("span",{directives:[{name:"translate",rawName:"v-translate",value:{count:e.count},expression:"{ count }"}],key:"upload-progress-multi",attrs:{id:"files-upload-progress-multi","translate-n":e.count,"translate-plural":"Uploading %{ count } items","translate-comment":"Upload progress when uploading multiple files only shows the number of uploads."}},[e._v("\n        Uploading %{ count } item\n      ")])]),e._v(" "),s("div",{staticClass:"uk-width-auto"},[e.expanded?s("span",{directives:[{name:"translate",rawName:"v-translate"}],key:"upload-progress-collapse-details",attrs:{id:"files-upload-progress-collapse-details","translate-comment":"Hide details panel of upload progress"}},[e._v("\n        Hide Details\n      ")]):s("span",{directives:[{name:"translate",rawName:"v-translate"}],key:"upload-progress-expand-details",attrs:{id:"files-upload-progress-expand-details","translate-comment":"Show details panel of upload progress"}},[e._v("\n        Show Details\n      ")])])],1),e._v(" "),e.expanded?s("details-widget",{staticClass:"uk-width-expand oc-upload-details-scrollable",attrs:{items:e.inProgress}}):e._e()],1)};js._withStripped=!0;const Ys=t.normalizeComponent({render:js,staticRenderFns:[]},undefined,Ws,"data-v-4880066e",false,undefined,!1,void 0,void 0,void 0);const Qs={name:"FileInfo",mixins:[at,rt,ot],inject:["displayedItem"],props:{isContentDisplayed:{type:Boolean,default:!1}},computed:{...t.mapGetters(["capabilities"]),timeData(){const e=e=>(e.time=this.formDateFromRFC(e.sourceTime),e.timeRelative=this.formRelativeDateFromRFC(e.sourceTime),e.infoString=this.$gettextInterpolate(e.infoString,e),e.ariaLabel=this.$gettextInterpolate(e.ariaLabel,e),e);return this.isTrashbinRoute?e({sourceTime:this.file.ddate,infoString:this.$pgettext("inline info about deletion date","deleted %{timeRelative}"),ariaLabel:this.$pgettext("aria label for inline info about deletion date","deleted %{timeRelative} (%{time})")}):e({sourceTime:this.file.mdate,infoString:this.$pgettext("inline info about last modification date","modified %{timeRelative}"),ariaLabel:this.$pgettext("aria label for inline info about last modification date","modified %{timeRelative} (%{time})")})},isFavoritesEnabled(){return this.capabilities.files&&this.capabilities.files.favorites&&this.isContentDisplayed&&!this.isAnySharedWithRoute&&!this.isTrashbinRoute},file(){return this.displayedItem.value}},methods:{...t.mapActions("Files",["markFavorite"]),toggleFileFavorite(e){this.markFavorite({client:this.$client,file:e}).then((()=>{this.$set(this.file,"starred",!this.file.starred)}))}}};var Js=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"file_info"},[s("oc-icon",{staticClass:"file_info__icon",attrs:{name:e.file.icon,size:"large"}}),e._v(" "),s("div",{staticClass:"file_info__body oc-text-overflow"},[s("h3",{attrs:{"data-testid":"files-info-name"}},[s("oc-resource-name",{attrs:{name:e.file.name,extension:e.file.extension,type:e.file.type,"full-path":e.file.path,"is-path-displayed":!1}})],1),e._v(" "),s("p",{staticClass:"oc-my-rm"},[e.file.size>-1?[e._v(e._s(e.getResourceSize(e.file.size))+",")]:e._e(),e._v(" "),s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.timeData.time,expression:"timeData.time"}],attrs:{"data-testid":"files-info-mdate",tabindex:"0","aria-label":e.timeData.ariaLabel}},[e._v(e._s(e.timeData.infoString))])],2)]),e._v(" "),!e.publicPage()&&e.isFavoritesEnabled?s("oc-button",{staticClass:"file_info__favorite",attrs:{"aria-label":e.file.starred?e.$gettext("Click to remove this file from your favorites"):e.$gettext("Click to mark this file as favorite"),appearance:"raw"},nativeOn:{click:function(t){return t.stopPropagation(),e.toggleFileFavorite(e.file)}}},[s("oc-icon",{class:e.file.starred?"oc-star-shining":"oc-star-dimm",attrs:{name:"star"}})],1):e._e()],1)};Js._withStripped=!0;let Ks,Xs;const Zs={components:{FileInfo:t.normalizeComponent({render:Js,staticRenderFns:[]},undefined,Qs,undefined,false,undefined,!1,void 0,void 0,void 0)},mixins:[ot],provide(){return{displayedItem:t.computed((()=>this.selectedFile))}},data:()=>({focused:void 0,oldPanelName:null,selectedFile:{},loading:!1}),computed:{...t.mapGetters("Files",["highlightedFile","selectedFiles","currentFolder"]),...t.mapGetters(["fileSideBars","capabilities"]),...t.mapState("Files/sidebar",{sidebarActivePanel:"activePanel"}),activeAvailablePanelName(){return this.sidebarActivePanel&&this.availablePanels.map((e=>e.app)).includes(this.sidebarActivePanel)?this.sidebarActivePanel:null},activePanelName(){return this.activeAvailablePanelName||this.defaultPanel.app},availablePanels(){const{panels:e}=this.fileSideBars.reduce(((e,t)=>{const s=t({capabilities:this.capabilities,highlightedFile:this.highlightedFile,route:this.$route,multipleSelection:this.areMultipleSelected,rootFolder:this.isRootFolder});return s.enabled&&e.panels.push(s),e}),{panels:[]});return e},defaultPanel(){return this.availablePanels.find((e=>e.default))},accessibleLabelBack(){const e=this.$gettext("Back to %{panel} panel");return this.$gettextInterpolate(e,{panel:this.defaultPanel.component.title(this.$gettext)})},isShareAccepted(){return 0===this.highlightedFile?.status},isContentDisplayed(){return!this.isSharedWithMeRoute||this.isShareAccepted},sidebarAccordionsWarningMessage(){return this.isShareAccepted?null:this.$gettext("Please, accept this share first to display available actions")},isSingleResource(){return!this.areMultipleSelected&&!this.isRootFolder},areMultipleSelected(){return this.selectedFiles&&this.selectedFiles.length>1},isRootFolder(){return!this.highlightedFile?.path},highlightedFileThumbnail(){return this.highlightedFile?.thumbnail}},watch:{activePanelName:{handler:function(e,t){this.$nextTick((()=>{this.focused=e?`#sidebar-panel-${e}`:`#sidebar-panel-select-${t}`}))},immediate:!0},highlightedFile(e,t){this.isSingleResource&&this.fetchFileInfo()},highlightedFileThumbnail(e){this.$set(this.selectedFile,"thumbnail",e)}},async created(){this.areMultipleSelected||await this.fetchFileInfo(),this.$nextTick(this.initVisibilityObserver)},beforeDestroy(){Ks.disconnect(),Xs.disconnect()},methods:{...t.mapActions("Files/sidebar",{closeSidebar:"close",setSidebarPanel:"setActivePanel",resetSidebarPanel:"resetActivePanel"}),initVisibilityObserver(){Ks=new pe({root:document.querySelector("#files-sidebar"),threshold:.9}),Xs=new pe({root:document.querySelector("#files-sidebar"),threshold:.05});const e=()=>{const e=document.querySelector(this.focused);e&&e.focus()},t=()=>{this.oldPanelName=null};this.$refs.panels.forEach((s=>{Ks.observe(s,{onEnter:e,onExit:e}),Xs.observe(s,{onExit:t})}))},setOldPanelName(){this.oldPanelName=this.activePanelName},openPanel(e){this.setOldPanelName(),this.setSidebarPanel(e)},closePanel(){this.setOldPanelName(),this.resetSidebarPanel()},async fetchFileInfo(){if(this.highlightedFile)if(q(this.$route))this.selectedFile=this.highlightedFile;else{this.loading=!0;try{const t=await this.$client.files.fileInfo(this.highlightedFile.path,a.DavProperties.Default);this.selectedFile=e.buildResource(t),this.$set(this.selectedFile,"thumbnail",this.highlightedFile.thumbnail||null)}catch(e){this.selectedFile=this.highlightedFile,console.error(e)}this.loading=!1}else this.selectedFile=this.highlightedFile}}};var ei=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:{"has-active-sub-panel":!!e.activeAvailablePanelName,"uk-flex uk-flex-center uk-flex-middle":e.loading},attrs:{"data-testid":"files-sidebar"}},[e.loading?s("oc-spinner"):e._l(e.availablePanels,(function(t){return s("div",{key:"panel-"+t.app,ref:"panels",refInFor:!0,staticClass:"sidebar-panel",class:{"is-active-sub-panel":e.activeAvailablePanelName===t.app,"is-active-default-panel":t.default&&e.activePanelName===t.app,"sidebar-panel-default":t.default,"resource-info-hidden":!e.isSingleResource},attrs:{id:"sidebar-panel-"+t.app,"data-testid":"sidebar-panel-"+t.app,tabindex:e.activePanelName===t.app&&-1}},[[e.activePanelName,e.oldPanelName].includes(t.app)?s("div",{staticClass:"sidebar-panel__header header"},[t.default?e._e():s("oc-button",{staticClass:"header__back",attrs:{appearance:"raw","aria-label":e.accessibleLabelBack},on:{click:e.closePanel}},[s("oc-icon",{attrs:{name:"chevron_left"}}),e._v("\n          "+e._s(e.defaultPanel.component.title(e.$gettext))+"\n        ")],1),e._v(" "),s("h2",{staticClass:"header__title oc-my-rm"},[e._v("\n          "+e._s(t.component.title(e.$gettext))+"\n        ")]),e._v(" "),s("oc-button",{staticClass:"header__close",attrs:{appearance:"raw","aria-label":e.$gettext("Close file sidebar")},on:{click:e.closeSidebar}},[s("oc-icon",{attrs:{name:"close"}})],1)],1):e._e(),e._v(" "),e.isSingleResource?s("file-info",{staticClass:"sidebar-panel__file_info",attrs:{"is-content-displayed":e.isContentDisplayed}}):e._e(),e._v(" "),s("div",{staticClass:"sidebar-panel__body"},[e.isContentDisplayed?[s(t.component,{tag:"component",staticClass:"sidebar-panel__body-content"}),e._v(" "),t.default&&e.availablePanels.length>1?s("div",{staticClass:"sidebar-panel__navigation"},e._l(e.availablePanels.filter((function(e){return!e.default})),(function(t){return s("oc-button",{key:"panel-select-"+t.app,attrs:{id:"sidebar-panel-"+t.app+"-select","data-testid":"sidebar-panel-"+t.app+"-select",appearance:"raw"},on:{click:function(s){return e.openPanel(t.app)}}},[s("oc-icon",{attrs:{name:t.icon}}),e._v("\n              "+e._s(t.component.title(e.$gettext))+"\n              "),s("oc-icon",{attrs:{name:"chevron_right"}})],1)})),1):e._e()]:s("p",[e._v(e._s(e.sidebarAccordionsWarningMessage))])],2)],1)}))],2)};ei._withStripped=!0;const ti={components:{AppBar:Vs,ProgressBar:Ys,SideBar:t.normalizeComponent({render:ei,staticRenderFns:[]},undefined,Zs,undefined,false,undefined,!1,void 0,void 0,void 0)},mixins:[at,ot],data:()=>({createFolder:!1,fileUploadName:"",fileUploadProgress:0,upload:!1,fileName:"",breadcrumbs:[]}),computed:{...t.mapGetters("Files",["dropzone","inProgress"]),...t.mapState("Files/sidebar",{sidebarClosed:"closed"}),$_uploadProgressVisible(){return this.inProgress.length>0},showSidebar(){return!this.sidebarClosed}},watch:{$route:{handler:function(e,t){this.resetFileSelection(),t?.name!==e.name&&this.closeSidebar()}}},created(){this.$root.$on("upload-end",(()=>{this.delayForScreenreader((()=>this.$refs.filesListWrapper.focus()))}))},beforeDestroy(){this.SET_SIDEBAR_FOOTER_CONTENT_COMPONENT(null)},methods:{...t.mapActions("Files",["dragOver","resetFileSelection"]),...t.mapActions("Files/sidebar",{closeSidebar:"close"}),...t.mapActions(["showMessage"]),...t.mapMutations(["SET_SIDEBAR_FOOTER_CONTENT_COMPONENT"]),trace(){console.info("trace",arguments)},focusSideBar(e,t){this.focus({from:document.activeElement,to:this.$refs.filesSidebar?.$el,revert:"beforeDestroy"===t})},$_ocApp_dragOver(e){const t=(e.dataTransfer.types||[]).some((e=>"Files"===e));this.dragOver(t)}}};var si=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("main",{staticClass:"uk-flex uk-height-1-1",attrs:{id:"files"}},[s("div",{ref:"filesListWrapper",staticClass:"files-list-wrapper uk-width-expand",attrs:{tabindex:"-1"},on:{dragover:e.$_ocApp_dragOver}},[s("app-bar",{attrs:{id:"files-app-bar"}}),e._v(" "),s("progress-bar",{directives:[{name:"show",rawName:"v-show",value:e.$_uploadProgressVisible,expression:"$_uploadProgressVisible"}],staticClass:"oc-p-s",attrs:{id:"files-upload-progress"}}),e._v(" "),s("router-view",{attrs:{id:"files-view"}})],1),e._v(" "),e.sidebarClosed?e._e():s("side-bar",{ref:"filesSidebar",staticClass:"uk-width-1-1 uk-width-1-3@m uk-width-1-4@xl",attrs:{id:"files-sidebar",tabindex:"-1"},on:{beforeDestroy:e.focusSideBar,mounted:e.focusSideBar,fileChanged:e.focusSideBar}})],1)};si._withStripped=!0;const ii=t.normalizeComponent({render:si,staticRenderFns:[]},undefined,ti,"data-v-64f5b7ae",false,undefined,!1,void 0,void 0,void 0);var ai={computed:{...t.mapGetters("Files",["totalFilesCount"])},methods:{accessibleBreadcrumb_focusAndAnnounceBreadcrumb(e){const s=t.last(document.getElementById("files-breadcrumb").children[0].children),i=s.lastChild;if(!i)return;const a=this.totalFilesCount.files+this.totalFilesCount.folders,r=this.$ngettext("This folder contains %{ itemCount } item.","This folder contains %{ itemCount } items.",a),o=a>0?r:this.$gettext("This folder has no content.");document.querySelectorAll(".oc-breadcrumb-sr").forEach((e=>e.remove()));const n=document.createElement("p");n.className="oc-invisible-sr oc-breadcrumb-sr",n.innerHTML=o,s.append(n),e&&i.focus()}}},ri={methods:{...t.mapActions("Files/sidebar",{openSidebar:"open"}),$_mountSideBar_showDefaultPanel(){this.openSidebar()}}};const oi=(e,t=3500)=>{const s=document.querySelectorAll(`[data-item-id='${e}']`)[0];s&&(s.classList.add("oc-table-accentuated"),setTimeout((()=>{s.classList.remove("oc-table-accentuated")}),t))};const ni={name:"QuickActions",props:{actions:{type:Object,required:!0},item:{type:Object,required:!0}},computed:{filteredActions(){return t.filterObj(this.actions,((e,t)=>!0===t.displayed(this.item,this.$store)))}}};var li=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"uk-flex"},e._l(e.filteredActions,(function(t){return s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:t.label(e.$gettext),expression:"action.label($gettext)"}],key:t.label(e.$gettext),staticClass:"oc-mr-xs",class:"files-quick-action-"+t.id,attrs:{"aria-label":t.label(e.$gettext),appearance:"raw"},on:{click:function(s){return t.handler({item:e.item,client:e.$client,store:e.$store,$gettext:e.$gettext})}}},[s("oc-icon",{staticClass:"uk-flex",attrs:{name:t.icon}})],1)})),1)};li._withStripped=!0;const ci=t.normalizeComponent({render:li,staticRenderFns:[]},undefined,ni,undefined,false,undefined,!1,void 0,void 0,void 0);var di=function(e,t){var s=t._c;return s("div",{staticClass:"uk-flex uk-flex-middle uk-flex-center uk-height-1-1"},[s("oc-spinner",{attrs:{id:"files-list-progress",size:"large","aria-hidden":!0,"aria-label":""}})],1)};di._withStripped=!0;const ui=t.normalizeComponent({render:di,staticRenderFns:[]},undefined,{},undefined,true,undefined,!1,void 0,void 0,void 0);const hi={name:"NotFoundMessage",mixins:[ot],computed:{...t.mapGetters(["homeFolder","configuration"]),showHomeButton(){return this.isPersonalRoute},homeRoute(){return{name:"files-personal",params:{item:this.homeFolder}}},showPublicLinkButton(){return this.isPublicFilesRoute},publicLinkRoute(){return{name:"files-public-list",params:{item:this.$route.params.item.replace(/^\/+/,"").split("/")[0]}}}}};var pi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"uk-text-center uk-flex-middle uk-flex uk-flex-center uk-flex-column",attrs:{id:"files-list-not-found-message"}},[s("oc-icon",{attrs:{name:"cloud",type:"div",size:"xxlarge"}}),e._v(" "),s("div",{staticClass:"oc-text-muted uk-text-large"},[s("translate",[e._v("Resource not found")])],1),e._v(" "),s("div",{staticClass:"oc-text-muted"},[s("translate",[e._v("\n      We went looking everywhere, but were unable to find the selected resource.\n    ")])],1),e._v(" "),s("div",{staticClass:"oc-mt-s"},[e.showHomeButton?s("oc-button",{attrs:{id:"files-list-not-found-button-go-home",type:"router-link",appearance:"raw",to:e.homeRoute}},[s("translate",[e._v("Go to »All files«")])],1):e._e(),e._v(" "),e.showPublicLinkButton?s("oc-button",{attrs:{id:"files-list-not-found-button-reload-link",type:"router-link",appearance:"raw",to:e.publicLinkRoute}},[s("translate",[e._v("Reload public link")])],1):e._e()],1)],1)};pi._withStripped=!0;const mi=t.normalizeComponent({render:pi,staticRenderFns:[]},undefined,hi,undefined,false,undefined,!1,void 0,void 0,void 0),fi=new pe;const gi={components:{ResourceTable:Ve,QuickActions:ci,ListLoader:ui,NoContentMessage:Me,NotFoundMessage:mi,ListInfo:We,Pagination:Qe,ContextActions:zs},mixins:[ai,ue,Ke,ri,Je],setup(){const s=Ce(),{pagination:i}=$e(),{refresh:r,y:o}=Fe(),n=we("sort-by"),l=we("sort-dir"),c=t.computed((()=>s.getters["Files/activeFiles"]||[])),d=t.computed((()=>ze(t.unref(c)[0]))),{sortBy:u,sortDir:h,items:p,handleSort:m}=Ie({items:c,fields:d,sortBy:n,sortDir:l}),f=we("page","1"),g=t.computed((()=>parseInt(String(f.value)))),v=we("items-per-page",i.perPage.value),{items:_,total:b}=Re({page:g,perPage:t.computed((()=>parseInt(String(v.value)))),items:p,sortDir:h,sortBy:u});Ee(["Files/UPSERT_RESOURCE"],(async({payload:e})=>{await t.nextTick(),oi(e.id)}));return{fileListHeaderY:o,loadResourcesTask:t.q((function*(t,s,i,o=null){s.CLEAR_CURRENT_FILES_LIST();try{let t=yield s.fetchResources(o||s.$route.params.item,a.DavProperties.Default);t=t.map(e.buildResource);const i=t.shift();s.LOAD_FILES({currentFolder:i,files:t}),s.loadIndicators({client:s.$client,currentFolder:i.path});const r=yield s.$client.users.getUser(s.user.id);s.SET_QUOTA(r.quota)}catch(e){s.SET_CURRENT_FOLDER(null),console.error(e)}r(),s.accessibleBreadcrumb_focusAndAnnounceBreadcrumb(i),s.scrollToResourceFromRoute()})).restartable(),paginatedResources:_,paginationPages:b,paginationPage:g,handleSort:m,sortBy:u,sortDir:h}},computed:{...t.mapState(["app"]),...t.mapState("Files",["files"]),...t.mapState("Files/sidebar",{sidebarClosed:"closed"}),...t.mapGetters("Files",["highlightedFile","selectedFiles","currentFolder","totalFilesCount","totalFilesSize"]),...t.mapGetters(["user","homeFolder","configuration"]),isEmpty(){return this.paginatedResources.length<1},selected:{get(){return this.selectedFiles},set(e){this.SET_FILE_SELECTION(e)}},folderNotFound(){return null===this.currentFolder},targetRoute(){return{name:this.$route.name}},displayThumbnails(){return!this.configuration.options.disablePreviews}},watch:{$route:{handler:function(e,s){const i=e.name===s?.name,a=e.params?.item===s?.params?.item;"/"===this.homeFolder||!t.isNil(e.params.item)||e.path.endsWith("/")||i&&a?i&&a||this.loadResourcesTask.perform(this,i):this.$router.replace({name:e.name,params:{...e.params,item:this.homeFolder},query:e.query},(()=>{}),(e=>{console.error(e)}))},immediate:!0}},mounted(){const e=i.bus.subscribe("app.files.list.load",(e=>{this.loadResourcesTask.perform(this,this.$route.params.item===e,e)}));this.$on("beforeDestroy",(()=>i.bus.unsubscribe("app.files.list.load",e)))},beforeDestroy(){fi.disconnect()},methods:{...t.mapActions("Files",["loadIndicators","loadPreview"]),...t.mapActions(["showMessage"]),...t.mapMutations("Files",["SET_CURRENT_FOLDER","LOAD_FILES","CLEAR_CURRENT_FILES_LIST","REMOVE_FILE","REMOVE_FILE_FROM_SEARCHED","SET_FILE_SELECTION","REMOVE_FILE_SELECTION"]),...t.mapMutations(["SET_QUOTA"]),async fileDropped(e){const s=[...this.selectedFiles],i=this.paginatedResources.find((t=>t.id===e));if(s.some((t=>t.id===e)))return;if("folder"!==i.type)return;const a=await this.fetchResources(i.path),r=[],o=[],n=new t._default({concurrency:4});let l;if(s.forEach((e=>{o.push(n.add((async()=>{if(a.some((s=>t.basename(s.name)===e.name))){const t=this.$gettext("Resource with name %{name} already exists");r.push({resource:e.name,message:this.$gettextInterpolate(t,{name:e.name},!0)})}else try{await this.$client.files.move(e.path,t.join(i.path,e.name)),this.REMOVE_FILE(e),this.REMOVE_FILE_FROM_SEARCHED(e),this.REMOVE_FILE_SELECTION(e)}catch(t){console.error(t),t.resourceName=e.name,r.push(t)}})))})),await Promise.all(o),0===r.length){const e=s.length;return l=this.$ngettext("Successfully moved %{count} item","Successfully moved %{count} items",e),void this.showMessage({title:this.$gettextInterpolate(l,{count:e}),status:"success"})}if(1===r.length)return l=this.$gettext("An error occurred while moving %{resource}"),void this.showMessage({title:this.$gettextInterpolate(l,{resource:r[0].resourceName},!0),desc:r[0].message,status:"danger"});l=this.$gettext("An error occurred while moving several resources");const c=this.$ngettext("%{count} resource could not be moved","%{count} resources could not be moved",r.length);this.showMessage({title:l,desc:this.$gettextInterpolate(c,{count:r.length},!1),status:"danger"})},rowMounted(e,s){if(!this.displayThumbnails)return;const i=t.debounce((({unobserve:t})=>{t(),this.loadPreview({resource:e,isPublic:!1,dimensions:A.Thumbnail,type:O.Thumbnail})}),250);fi.observe(s.$el,{onEnter:i,onExit:i.cancel})},async fetchResources(e,t){try{return await this.$client.files.list(e,1,t)}catch(e){console.error(e)}},scrollToResourceFromRoute(){const e=this.$route.query.scrollTo;e&&this.paginatedResources.length>0&&this.$nextTick((()=>{const t=this.paginatedResources.find((t=>t.name===e));t&&(this.selected=[t],this.$_mountSideBar_showDefaultPanel(t),this.scrollToResource(t))}))},isResourceInSelection(e){return this.selected?.includes(e)}}};var vi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.loadResourcesTask.isRunning?s("list-loader"):[e.folderNotFound?s("not-found-message",{staticClass:"files-not-found uk-height-1-1"}):e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-personal-empty",icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources in this folder")])]},proxy:!0},{key:"callToAction",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v('Drag files and folders here or use the "+ New" button to upload')])]},proxy:!0}])}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-personal-table","are-thumbnails-displayed":e.displayThumbnails,resources:e.paginatedResources,"target-route":e.targetRoute,"header-position":e.fileListHeaderY,"drag-drop":!0,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileDropped:e.fileDropped,fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"quickActions",fn:function(t){var i=t.resource;return[s("quick-actions",{staticClass:"oc-visible@s",class:i.preview,attrs:{item:i,actions:e.app.quickActions}})]}},{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selected}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"uk-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})]],2)};vi._withStripped=!0;const _i=t.normalizeComponent({render:vi,staticRenderFns:[]},undefined,gi,undefined,false,undefined,!1,void 0,void 0,void 0),bi=new pe;const xi={components:{ResourceTable:Ve,QuickActions:ci,ListLoader:ui,Pagination:Qe,NoContentMessage:Me,ListInfo:We,ContextActions:zs},mixins:[ue,ri,Je],setup(){const s=Ce(),{pagination:i}=$e(),{y:r}=Fe(),o=we("sort-by"),n=we("sort-dir"),l=t.computed((()=>s.getters["Files/activeFiles"]||[])),c=t.computed((()=>ze(t.unref(l)[0]))),{sortBy:d,sortDir:u,items:h,handleSort:p}=Ie({items:l,fields:c,sortBy:o,sortDir:n}),m=we("page","1"),f=t.computed((()=>parseInt(String(m.value)))),g=we("items-per-page",i.perPage.value),{items:v,total:_}=Re({page:f,perPage:t.computed((()=>parseInt(String(g.value)))),items:h,sortDir:u,sortBy:d});return{fileListHeaderY:r,loadResourcesTask:t.q((function*(t,s){s.CLEAR_CURRENT_FILES_LIST();let i=yield s.$client.files.getFavoriteFiles(a.DavProperties.Default);i=i.map(e.buildResource),s.LOAD_FILES({currentFolder:null,files:i}),s.loadIndicators({client:this.$client,currentFolder:"/"})})),paginatedResources:v,paginationPages:_,paginationPage:f,handleSort:p,sortBy:d,sortDir:u}},computed:{...t.mapState(["app"]),...t.mapState("Files",["files"]),...t.mapGetters("Files",["highlightedFile","selectedFiles","totalFilesCount","totalFilesSize"]),...t.mapState("Files/sidebar",{sidebarClosed:"closed"}),...t.mapGetters(["user","configuration"]),targetRoute:()=>({name:"files-personal"}),selected:{get(){return this.selectedFiles},set(e){this.SET_FILE_SELECTION(e)}},isEmpty(){return this.paginatedResources.length<1},displayThumbnails(){return!this.configuration.options.disablePreviews}},created(){this.loadResourcesTask.perform(this)},beforeDestroy(){bi.disconnect()},methods:{...t.mapActions("Files",["loadIndicators","loadPreview"]),...t.mapMutations("Files",["SET_FILE_SELECTION","LOAD_FILES","CLEAR_CURRENT_FILES_LIST"]),rowMounted(e,s){if(!this.displayThumbnails)return;const i=t.debounce((({unobserve:t})=>{t(),this.loadPreview({resource:e,isPublic:!1,dimensions:A.Thumbnail,type:O.Thumbnail})}),250);bi.observe(s.$el,{onEnter:i,onExit:i.cancel})},isResourceInSelection(e){return this.selected?.includes(e)}}};var Si=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.loadResourcesTask.isRunning?s("list-loader"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-favorites-empty",icon:"star"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources marked as favorite")])]},proxy:!0}],null,!1,2464274424)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-favorites-table","are-paths-displayed":!0,"are-thumbnails-displayed":e.displayThumbnails,resources:e.paginatedResources,"target-route":e.targetRoute,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"quickActions",fn:function(t){return[s("quick-actions",{staticClass:"oc-visible@s",attrs:{item:t.resource,actions:e.app.quickActions}})]}},{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selected}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"uk-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})]],2)};Si._withStripped=!0;const yi=t.normalizeComponent({render:Si,staticRenderFns:[]},undefined,xi,undefined,false,undefined,!1,void 0,void 0,void 0),wi=new pe;const Ci={components:{ResourceTable:Ve,ListLoader:ui,NoContentMessage:Me,ListInfo:We,ContextActions:zs},mixins:[ue,Q,K,ri,Je],setup(){const s=Ce(),{y:i}=Fe(),a=t.computed((()=>s.getters["Files/activeFiles"]||[])),r=t.computed((()=>ze(t.unref(a)[0]))),o=t.computed((()=>parseInt(String(t.unref(we("view-mode",e.ShareStatus.accepted.toString())))))),n=we("pending-sort-by"),l=we("pending-sort-dir"),c=t.computed((()=>t.unref(a).filter((t=>t.status===e.ShareStatus.pending)))),{sortBy:d,sortDir:u,items:h,handleSort:p}=Ie({items:c,fields:r,sortBy:n,sortDir:l}),m=we("shares-sort-by"),f=we("shares-sort-dir"),g=t.computed((()=>t.unref(a).filter((e=>e.status===t.unref(o))))),{sortBy:v,sortDir:_,items:b,handleSort:x}=Ie({items:g,fields:r,sortBy:m,sortDir:f}),S=t.q((function*(t,s){s.CLEAR_CURRENT_FILES_LIST();let i=yield s.$client.requests.ocs({service:"apps/files_sharing",action:"/api/v1/shares?format=json&shared_with_me=true&state=all&include_tags=false",method:"GET"});i=yield i.json(),i=i.ocs.data,i.length&&(i=e.aggregateResourceShares(i,!0,!s.isOcis,s.configuration.server,s.getToken)),s.LOAD_FILES({currentFolder:null,files:i})}));return{viewMode:o,fileListHeaderY:i,loadResourcesTask:S,pendingHandleSort:p,pendingSortBy:d,pendingSortDir:u,pendingItems:h,sharesHandleSort:x,sharesSortBy:v,sharesSortDir:_,sharesItems:b}},data:()=>({ShareStatus:e.ShareStatus,showMorePending:!1}),computed:{...t.mapGetters("Files",["selectedFiles"]),...t.mapGetters(["isOcis","configuration","getToken"]),...t.mapState("Files/sidebar",{sidebarClosed:"closed"}),pendingSelected:{get(){return this.selectedFiles.filter((t=>t.status===e.ShareStatus.pending))},set(t){this.SET_FILE_SELECTION(t.filter((t=>t.status===e.ShareStatus.pending)))}},pendingTitle(){return this.$gettext("Pending shares")},pendingHasMore(){return this.pendingCount>3},pendingToggleMoreLabel(){return this.showMorePending?this.$gettext("Show less"):this.$gettext("Show more")},hasPending(){return this.pendingCount>0},pendingCount(){return this.pendingItems.length},sharesSelected:{get(){return this.selectedFiles.filter((e=>e.status===this.viewMode))},set(e){this.SET_FILE_SELECTION(e.filter((e=>e.status===this.viewMode)))}},sharesTitle(){return this.viewMode===e.ShareStatus.declined?this.$gettext("Declined shares"):this.$gettext("Accepted shares")},sharesToggleLabel(){return this.viewMode===e.ShareStatus.declined?this.$gettext("Show accepted shares"):this.$gettext("Show declined shares")},sharesEmptyMessage(){return this.viewMode===e.ShareStatus.declined?this.$gettext("You don't have any previously declined shares."):this.$gettext("You are not collaborating on other people's resources.")},hasShares(){return this.sharesCount>0},sharesCount(){return this.sharesItems.length},sharesCountFiles(){return this.sharesItems.filter((e=>"folder"!==e.type)).length},sharesCountFolders(){return this.sharesItems.filter((e=>"folder"===e.type)).length},sharesOtherViewMode(){return this.viewMode===e.ShareStatus.accepted?e.ShareStatus.declined:e.ShareStatus.accepted},sharesToggleRouterLink(){return{name:this.$route.name,params:{...this.$route.params},query:{...this.$route.query,"view-mode":this.sharesOtherViewMode}}},targetRoute:()=>({name:"files-personal"}),displayThumbnails(){return!this.configuration.options.disablePreviews}},created(){this.loadResourcesTask.perform(this)},beforeDestroy(){wi.disconnect()},methods:{...t.mapActions("Files",["loadIndicators","loadPreview","loadAvatars"]),...t.mapActions(["showMessage"]),...t.mapMutations("Files",["LOAD_FILES","SET_FILE_SELECTION","CLEAR_CURRENT_FILES_LIST","UPDATE_RESOURCE"]),rowMounted(e,s){const i=t.debounce((({unobserve:t})=>{t(),this.loadAvatars({resource:e}),this.displayThumbnails&&this.loadPreview({resource:e,isPublic:!1,dimensions:A.Thumbnail,type:O.Thumbnail})}),250);wi.observe(s.$el,{onEnter:i,onExit:i.cancel})},togglePendingShowMore(){this.showMorePending=!this.showMorePending},isResourceInPendingSelection(e){return this.pendingSelected?.includes(e)},isResourceInSharesSelection(e){return this.sharesSelected?.includes(e)}}};var Ei=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"uk-flex uk-flex-column"},[e.loadResourcesTask.isRunning?s("list-loader"):[e.hasPending?s("div",[s("h2",{staticClass:"oc-p-s"},[e._v("\n        "+e._s(e.pendingTitle)+"\n        "),s("span",{staticClass:"oc-text-initial"},[e._v("("+e._s(e.pendingCount)+")")])]),e._v(" "),s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-shared-with-me-pending-table","data-test-share-status":e.ShareStatus.pending,"are-thumbnails-displayed":e.displayThumbnails,resources:e.showMorePending?e.pendingItems:e.pendingItems.slice(0,3),"target-route":e.targetRoute,"are-resources-clickable":!1,"header-position":e.fileListHeaderY,"sort-by":e.pendingSortBy,"sort-dir":e.pendingSortDir},on:{sort:e.pendingHandleSort},scopedSlots:e._u([{key:"status",fn:function(t){var i=t.resource;return[s("div",{key:i.id+i.status,staticClass:"uk-text-nowrap uk-flex uk-flex-middle uk-flex-right"},[s("oc-button",{staticClass:"file-row-share-status-accept",attrs:{size:"small",variation:"success"},on:{click:function(t){return t.stopPropagation(),e.$_acceptShare_trigger({resources:[i]})}}},[s("oc-icon",{attrs:{size:"small",name:"check"}}),e._v(" "),s("translate",[e._v("Accept")])],1),e._v(" "),s("oc-button",{staticClass:"file-row-share-decline oc-ml-s",attrs:{size:"small"},on:{click:function(t){return t.stopPropagation(),e.$_declineShare_trigger({resources:[i]})}}},[s("oc-icon",{attrs:{size:"small",name:"not_interested"}}),e._v(" "),s("translate",[e._v("Decline")])],1)],1)]}},{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInPendingSelection(i)?s("context-actions",{attrs:{items:e.pendingSelected}}):e._e()]}},e.pendingHasMore?{key:"footer",fn:function(){return[s("div",{staticClass:"uk-width-1-1 uk-text-center oc-mt"},[s("oc-button",{attrs:{id:"files-shared-with-me-pending-show-all",appearance:"raw","gap-size":"xsmall",size:"small","data-test-expand":(!e.showMorePending).toString()},on:{click:e.togglePendingShowMore}},[e._v("\n              "+e._s(e.pendingToggleMoreLabel)+"\n              "),s("oc-icon",{attrs:{name:"chevron_"+(e.showMorePending?"up":"down")}})],1)],1)]},proxy:!0}:null],null,!0),model:{value:e.pendingSelected,callback:function(t){e.pendingSelected=t},expression:"pendingSelected"}})],1):e._e(),e._v(" "),s("h2",{staticClass:"oc-p-s"},[e._v("\n      "+e._s(e.sharesTitle)+"\n      "),s("span",{staticClass:"oc-text-initial"},[e._v("("+e._s(e.sharesCount)+")")]),e._v(" "),s("oc-button",{attrs:{id:"files-shared-with-me-toggle-view-mode",appearance:"raw",type:"router-link",to:e.sharesToggleRouterLink,"data-test-set-view-mode":e.sharesOtherViewMode.toString()}},[e._v("\n        "+e._s(e.sharesToggleLabel)+"\n      ")])],1),e._v(" "),e.hasShares?s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-shared-with-me-shares-table","data-test-share-status":e.viewMode,"are-thumbnails-displayed":e.displayThumbnails,resources:e.sharesItems,"target-route":e.targetRoute,"header-position":e.fileListHeaderY,"sort-by":e.sharesSortBy,"sort-dir":e.sharesSortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.sharesHandleSort},scopedSlots:e._u([{key:"status",fn:function(t){var i=t.resource;return[s("div",{key:i.id+i.status,staticClass:"uk-text-nowrap uk-flex uk-flex-middle uk-flex-right"},[i.status===e.ShareStatus.declined?s("oc-button",{staticClass:"file-row-share-status-accept",attrs:{size:"small",variation:"success"},on:{click:function(t){return t.stopPropagation(),e.$_acceptShare_trigger({resources:[i]})}}},[s("oc-icon",{attrs:{size:"small",name:"check"}}),e._v(" "),s("translate",[e._v("Accept")])],1):e._e(),e._v(" "),i.status===e.ShareStatus.accepted?s("oc-button",{staticClass:"file-row-share-status-decline",attrs:{size:"small"},on:{click:function(t){return t.stopPropagation(),e.$_declineShare_trigger({resources:[i]})}}},[s("oc-icon",{attrs:{size:"small",name:"not_interested"}}),e._v(" "),s("translate",[e._v("Decline")])],1):e._e()],1)]}},{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSharesSelection(i)?s("context-actions",{attrs:{items:e.sharesSelected}}):e._e()]}},{key:"footer",fn:function(){return[e.hasShares?s("list-info",{staticClass:"uk-width-1-1 oc-my-s",attrs:{files:e.sharesCountFiles,folders:e.sharesCountFolders}}):e._e()]},proxy:!0}]),model:{value:e.sharesSelected,callback:function(t){e.sharesSelected=t},expression:"sharesSelected"}}):s("no-content-message",{staticClass:"files-empty uk-flex-stretch",attrs:{id:"files-shared-with-me-shares-empty",icon:"group"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",[e._v(e._s(e.sharesEmptyMessage))])]},proxy:!0}],null,!1,912116512)})]],2)};Ei._withStripped=!0;const ki=t.normalizeComponent({render:Ei,staticRenderFns:[]},undefined,Ci,undefined,false,undefined,!1,void 0,void 0,void 0),$i=new pe;const Fi={components:{ResourceTable:Ve,ListLoader:ui,NoContentMessage:Me,ListInfo:We,Pagination:Qe,ContextActions:zs},mixins:[ue,rt,ri,Je],setup(){const s=Ce(),{pagination:i}=$e(),{y:a}=Fe(),r=we("sort-by"),o=we("sort-dir"),n=t.computed((()=>s.getters["Files/activeFiles"]||[])),l=t.computed((()=>ze(t.unref(n)[0]))),{sortBy:c,sortDir:d,items:u,handleSort:h}=Ie({items:n,fields:l,sortBy:r,sortDir:o}),p=we("page","1"),m=t.computed((()=>parseInt(String(p.value)))),f=we("items-per-page",i.perPage.value),{items:g,total:v}=Re({page:m,perPage:t.computed((()=>parseInt(String(f.value)))),items:u,sortDir:d,sortBy:c});return{fileListHeaderY:a,loadResourcesTask:t.q((function*(t,s){s.CLEAR_CURRENT_FILES_LIST();let i=yield s.$client.requests.ocs({service:"apps/files_sharing",action:"/api/v1/shares?format=json&reshares=true&include_tags=false",method:"GET"});i=yield i.json(),i=i.ocs.data,i.length&&(i=e.aggregateResourceShares(i,!1,!s.isOcis,s.configuration.server,s.getToken)),s.LOAD_FILES({currentFolder:null,files:i})})),paginatedResources:g,paginationPages:v,paginationPage:m,handleSort:h,sortBy:c,sortDir:d}},computed:{...t.mapState(["app"]),...t.mapState("Files",["files"]),...t.mapGetters("Files",["highlightedFile","selectedFiles","totalFilesCount"]),...t.mapGetters(["isOcis","configuration","getToken","user"]),...t.mapState("Files/sidebar",{sidebarClosed:"closed"}),selected:{get(){return this.selectedFiles},set(e){this.SET_FILE_SELECTION(e)}},isEmpty(){return this.paginatedResources.length<1},targetRoute:()=>({name:"files-personal"}),displayThumbnails(){return!this.configuration.options.disablePreviews}},created(){this.loadResourcesTask.perform(this)},beforeDestroy(){$i.disconnect()},methods:{...t.mapActions("Files",["loadIndicators","loadPreview","loadAvatars"]),...t.mapMutations("Files",["LOAD_FILES","SET_FILE_SELECTION","CLEAR_CURRENT_FILES_LIST"]),rowMounted(e,s){const i=t.debounce((({unobserve:t})=>{t(),this.loadAvatars({resource:e}),this.displayThumbnails&&this.loadPreview({resource:e,isPublic:!1,dimensions:A.Thumbnail,type:O.Thumbnail})}),250);$i.observe(s.$el,{onEnter:i,onExit:i.cancel})},isResourceInSelection(e){return this.selected?.includes(e)}}};var Ri=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.loadResourcesTask.isRunning?s("list-loader"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-shared-with-others-empty",icon:"group"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("\n          You are currently not collaborating on any of your resources with other people\n        ")])]},proxy:!0}],null,!1,1652169698)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-shared-with-others-table","are-thumbnails-displayed":e.displayThumbnails,resources:e.paginatedResources,"target-route":e.targetRoute,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selected}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"uk-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders}}):e._e()]},proxy:!0}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})]],2)};Ri._withStripped=!0;const Ti=t.normalizeComponent({render:Ri,staticRenderFns:[]},undefined,Fi,undefined,false,undefined,!1,void 0,void 0,void 0),Ii=new pe;const Pi={components:{ResourceTable:Ve,ListLoader:ui,NoContentMessage:Me,ListInfo:We,Pagination:Qe,ContextActions:zs},mixins:[ue,rt,ri,Je],setup(){const s=Ce(),{pagination:i}=$e(),{y:a}=Fe(),r=we("sort-by"),o=we("sort-dir"),n=t.computed((()=>s.getters["Files/activeFiles"]||[])),l=t.computed((()=>ze(t.unref(n)[0]))),{sortBy:c,sortDir:d,items:u,handleSort:h}=Ie({items:n,fields:l,sortBy:r,sortDir:o}),p=we("page","1"),m=t.computed((()=>parseInt(String(p.value)))),f=we("items-per-page",i.perPage.value),{items:g,total:v}=Re({page:m,perPage:t.computed((()=>parseInt(String(f.value)))),items:u,sortDir:d,sortBy:c});return{fileListHeaderY:a,loadResourcesTask:t.q((function*(t,s){s.CLEAR_CURRENT_FILES_LIST();let i=yield s.$client.requests.ocs({service:"apps/files_sharing",action:"/api/v1/shares?format=json&share_types=3&include_tags=false",method:"GET"});i=yield i.json(),i=i.ocs.data,i.length&&(i=e.aggregateResourceShares(i,!1,!s.isOcis,s.configuration.server,s.getToken)),s.LOAD_FILES({currentFolder:null,files:i})})),paginatedResources:g,paginationPages:v,paginationPage:m,handleSort:h,sortBy:c,sortDir:d}},computed:{...t.mapState(["app"]),...t.mapState("Files",["files"]),...t.mapGetters("Files",["highlightedFile","selectedFiles","totalFilesCount"]),...t.mapGetters(["isOcis","configuration","getToken","user"]),...t.mapState("Files/sidebar",{sidebarClosed:"closed"}),selected:{get(){return this.selectedFiles},set(e){this.SET_FILE_SELECTION(e)}},isEmpty(){return this.paginatedResources.length<1},targetRoute:()=>({name:"files-personal"}),displayThumbnails(){return!this.configuration.options.disablePreviews}},created(){this.loadResourcesTask.perform(this)},beforeDestroy(){Ii.disconnect()},methods:{...t.mapActions("Files",["loadIndicators","loadPreview"]),...t.mapMutations("Files",["LOAD_FILES","SET_FILE_SELECTION","CLEAR_CURRENT_FILES_LIST"]),rowMounted(e,s){if(!this.displayThumbnails)return;const i=t.debounce((({unobserve:t})=>{t(),this.loadPreview({resource:e,isPublic:!1,dimensions:A.Thumbnail,type:O.Thumbnail})}),250);Ii.observe(s.$el,{onEnter:i,onExit:i.cancel})},isResourceInSelection(e){return this.selected?.includes(e)}}};var Di=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.loadResourcesTask.isRunning?s("list-loader"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-shared-via-link-empty",icon:"group"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources with a public link at the moment")])]},proxy:!0}],null,!1,2205227924)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-shared-via-link-table","are-thumbnails-displayed":e.displayThumbnails,resources:e.paginatedResources,"target-route":e.targetRoute,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selected}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"uk-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders}}):e._e()]},proxy:!0}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})]],2)};Di._withStripped=!0;const Li=t.normalizeComponent({render:Di,staticRenderFns:[]},undefined,Pi,undefined,false,undefined,!1,void 0,void 0,void 0);const Ai={components:{ResourceTable:Ve,ListLoader:ui,NoContentMessage:Me,ListInfo:We,Pagination:Qe,ContextActions:zs},mixins:[rt,ri,Je],setup(){const s=Ce(),{pagination:i}=$e(),{refresh:r,y:o}=Fe(),n=we("sort-by"),l=we("sort-dir"),c=t.computed((()=>s.getters["Files/activeFiles"]||[])),d=t.computed((()=>ze(t.unref(c)[0]))),{sortBy:u,sortDir:h,items:p,handleSort:m}=Ie({items:c,fields:d,sortBy:n,sortDir:l}),f=we("page","1"),g=t.computed((()=>parseInt(String(f.value)))),v=we("items-per-page",i.perPage.value),{items:_,total:b}=Re({page:g,perPage:t.computed((()=>parseInt(String(v.value)))),items:p,sortBy:u,sortDir:h});return{fileListHeaderY:o,loadResourcesTask:t.q((function*(t,s){s.CLEAR_CURRENT_FILES_LIST();const i=yield s.$client.fileTrash.list("","1",a.DavProperties.Trashbin);s.LOAD_FILES({currentFolder:e.buildResource(i[0]),files:i.slice(1).map(e.buildDeletedResource)}),r()})),paginatedResources:_,paginationPages:b,paginationPage:g,handleSort:m,sortBy:u,sortDir:h}},computed:{...t.mapState("Files",["files"]),...t.mapGetters("Files",["highlightedFile","selectedFiles","totalFilesCount"]),...t.mapState("Files/sidebar",{sidebarClosed:"closed"}),selected:{get(){return this.selectedFiles},set(e){this.SET_FILE_SELECTION(e)}},isEmpty(){return this.paginatedResources.length<1}},created(){this.loadResourcesTask.perform(this)},methods:{...t.mapMutations("Files",["LOAD_FILES","SET_FILE_SELECTION","CLEAR_CURRENT_FILES_LIST"]),isResourceInSelection(e){return this.selected?.includes(e)}}};var Oi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.loadResourcesTask.isRunning?s("list-loader"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-trashbin-empty",icon:"delete"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("You have no deleted files")])]},proxy:!0}],null,!1,2049851514)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-trashbin-table","are-paths-displayed":!0,"are-thumbnails-displayed":!1,resources:e.paginatedResources,"are-resources-clickable":!1,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{sort:e.handleSort},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selected}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"uk-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders}}):e._e()]},proxy:!0}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})]],2)};Oi._withStripped=!0;const Ni=t.normalizeComponent({render:Oi,staticRenderFns:[]},undefined,Ai,undefined,false,undefined,!1,void 0,void 0,void 0);const Mi={data:()=>({loading:!0,errorMessage:null}),computed:{...t.mapGetters(["configuration"]),pageTitle(){return this.$gettext(this.$route.meta.title)},backgroundImg(){return this.configuration.theme.loginPage.backgroundImg},logoImg(){return this.configuration.theme.logo.login}},mounted(){this.loading=!0,this.$client.files.getPathForFileId(this.$route.params.fileId).then((e=>{const t=e.lastIndexOf("/"),s=e.substring(0,t).replace(/^(\/)/,""),i=e.substring(t+1);this.$router.push({name:"files-personal",params:{item:s||"/"},query:{scrollTo:i}})})).catch((e=>{this.errorMessage=e})).finally((()=>{this.loading=!1}))}};var Ui=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-login",style:{backgroundImage:"url("+e.backgroundImg+")"},attrs:{"uk-height-viewport":""}},[s("h1",{staticClass:"oc-invisible-sr"},[e._v(e._s(e.pageTitle))]),e._v(" "),s("div",{staticClass:"oc-login-card uk-position-center"},[s("img",{staticClass:"oc-login-logo",attrs:{src:e.logoImg,alt:"","aria-hidden":!0}}),e._v(" "),e.loading?s("div",{staticClass:"oc-login-card-body"},[s("h2",{staticClass:"oc-login-card-title"},[s("translate",[e._v("Resolving private link…")])],1),e._v(" "),s("oc-spinner",{attrs:{"aria-hidden":!0}})],1):e._e(),e._v(" "),e.errorMessage?s("div",{staticClass:"oc-login-card-body"},[s("h2",{staticClass:"oc-login-card-title"},[s("translate",[e._v("An error occurred while resolving the private link")])],1),e._v(" "),s("span",[e._v(e._s(e.errorMessage))])]):e._e()])])};Ui._withStripped=!0;const zi=t.normalizeComponent({render:Ui,staticRenderFns:[]},undefined,Mi,undefined,false,undefined,!1,void 0,void 0,void 0);const Bi={mixins:[at],data:()=>({loading:!0,errorMessage:null,firstTime:!0,passwordRequired:!1,password:null,inputErrorMessage:null}),computed:{...t.mapGetters(["configuration"]),...t.mapGetters("Files",["publicLinkPassword"]),pageTitle(){return this.$gettext(this.$route.meta.title)},passwordFieldLabel(){return this.$gettext("Enter password for public link")},backgroundImg(){return this.configuration.theme.loginPage.backgroundImg},logoImg(){return this.configuration.theme.logo.login}},mounted(){this.resolvePublicLink()},methods:{...t.mapActions("Files",["setPublicLinkPassword"]),resolvePublicLink(){const e=this.password||this.publicLinkPassword;this.loading=!0,this.inputErrorMessage=null,this.$client.publicFiles.list(this.$route.params.token,e,a.DavProperties.PublicLink,"0").then((t=>{this.passwordRequired=!1,this.setPublicLinkPassword(e),"4"!==t[0].getProperty(this.$client.publicFiles.PUBLIC_LINK_PERMISSION)?this.$router.push({name:"files-public-list",params:{item:this.$route.params.token}}):this.$router.push({name:"files-public-drop",params:{item:this.$route.params.token}})})).catch((e=>{401===e.statusCode?(this.passwordRequired=!0,this.firstTime||(this.inputErrorMessage=this.$gettext("Incorrect password")),this.firstTime=!1,this.loading=!1,this.$nextTick((()=>{this.$refs.passwordInput.focus()}))):this.errorMessage=e})).finally((()=>{this.loading=!1}))}}};var Gi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-login",style:{backgroundImage:"url("+e.backgroundImg+")"},attrs:{"uk-height-viewport":""}},[s("h1",{staticClass:"oc-invisible-sr"},[e._v(e._s(e.pageTitle))]),e._v(" "),s("div",{staticClass:"oc-login-card uk-position-center"},[s("img",{staticClass:"oc-login-logo",attrs:{src:e.logoImg,alt:"","aria-hidden":!0}}),e._v(" "),s("div",{staticClass:"oc-login-card-body"},[e.loading?[s("h2",{staticClass:"oc-login-card-title"},[s("translate",[e._v("Loading public link…")])],1),e._v(" "),s("oc-spinner",{attrs:{"aria-hidden":!0}})]:e.errorMessage?[s("h2",{staticClass:"oc-login-card-title oc-login-card-error"},[s("translate",[e._v("An error occurred while loading the public link")])],1),e._v(" "),s("p",{staticClass:"oc-text-lead"},[e._v(e._s(e.errorMessage))])]:e.passwordRequired?[s("form",{on:{submit:function(t){return t.preventDefault(),e.resolvePublicLink.apply(null,arguments)}}},[s("h2",{staticClass:"oc-login-card-title"},[s("translate",[e._v("This resource is password-protected.")])],1),e._v(" "),s("oc-text-input",{ref:"passwordInput",staticClass:"oc-mb-s",attrs:{"error-message":e.inputErrorMessage,label:e.passwordFieldLabel,type:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),s("oc-button",{staticClass:"oc-login-authorize-button",attrs:{variation:"primary",appearance:"filled",disabled:!e.password}},[s("translate",[e._v("Continue")])],1)],1)]:e._e()],2),e._v(" "),s("div",{staticClass:"oc-login-card-footer"},[s("p",[e._v("\n        "+e._s(e.configuration.theme.general.slogan)+"\n      ")])])])])};Gi._withStripped=!0;const Vi=t.normalizeComponent({render:Gi,staticRenderFns:[]},undefined,Bi,undefined,false,undefined,!1,void 0,void 0,void 0);const qi={components:{vueDropzone:t.vue2Dropzone},mixins:[at],data:()=>({loading:!0,errorMessage:null,uploadedFiles:new Map,uploadedFilesChangeTracker:0}),computed:{...t.mapGetters(["configuration"]),...t.mapGetters("Files",["publicLinkPassword"]),pageTitle(){return this.$gettext(this.$route.meta.title)},publicLinkToken(){return this.$route.params.token},title(){if(this.share){const e=this.$gettext("%{owner} shared this folder with you for uploading");return this.$gettextInterpolate(e,{owner:this.share.getProperty(this.$client.publicFiles.PUBLIC_LINK_SHARE_OWNER)},!0)}return""},url(){return this.$client.publicFiles.getFileUrl(this.publicLinkToken)+"/"},getUploadedFiles(){return this.uploadedFilesChangeTracker&&this.uploadedFiles.values()},dropzoneOptions(){return{url:this.url,clickable:!0,createImageThumbnails:!1,autoQueue:!1,previewsContainer:"#previews"}}},mounted(){this.resolvePublicLink()},methods:{resolvePublicLink(){this.loading=!0,this.$client.publicFiles.list(this.publicLinkToken,this.publicLinkPassword,a.DavProperties.PublicLink,"0").then((e=>{e[0].getProperty("4"!==this.$client.publicFiles.PUBLIC_LINK_SHARE_DATETIME)?this.$router.push({name:"files-public-list",params:{item:this.publicLinkToken}}):this.share=e[0]})).catch((e=>{401!==e.statusCode?this.errorMessage=e:this.$router.push({name:"files-public-link",params:{token:this.publicLinkToken}})})).finally((()=>{this.loading=!1}))},dropZoneFileAdded(e){const t=e.upload.uuid;this.uploadedFilesChangeTracker++,this.uploadedFiles.set(t,{name:e.name,size:e.size,status:"init"}),this.uploadQueue.add((()=>this.$client.publicFiles.putFileContents(this.publicLinkToken,e.name,this.publicLinkPassword,e,{headers:{"OC-Autorename":1},onProgress:s=>{this.uploadedFilesChangeTracker++,this.uploadedFiles.set(t,{name:e.name,size:e.size,status:"uploading"})}}))).then((s=>{this.uploadedFilesChangeTracker++,this.uploadedFiles.set(t,{name:e.name,size:e.size,status:"done"})})).catch((s=>{console.error("Error uploading file ",e.name,": ",s),this.uploadedFilesChangeTracker++,this.uploadedFiles.set(t,{name:e.name,size:e.size,status:"error"})}))},$_ocUploadingFileMessage(e){const t=this.$gettext('Uploading file "%{fileName}"');return this.$gettextInterpolate(t,{fileName:e},!0)}}};var Hi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"uk-height-1-1 uk-flex uk-flex-column uk-flex-between",attrs:{id:"files-drop-container"}},[s("h1",{staticClass:"oc-invisible-sr"},[e._v(e._s(e.pageTitle))]),e._v(" "),s("div",{staticClass:"oc-p uk-height-1-1"},[e.loading?s("div",{key:"loading-drop",staticClass:"uk-flex uk-flex-column uk-flex-middle"},[s("h2",{staticClass:"oc-login-card-title"},[s("translate",[e._v("Loading public link…")])],1),e._v(" "),s("oc-spinner",{attrs:{"aria-hidden":!0}})],1):s("div",{key:"loaded-drop",staticClass:"uk-flex uk-flex-column uk-flex-middle uk-height-1-1"},[s("div",{staticClass:"uk-text-center uk-width-1-1 uk-width-xxlarge@m"},[s("h2",{domProps:{textContent:e._s(e.title)}}),e._v(" "),s("vue-dropzone",{attrs:{id:"oc-dropzone",options:e.dropzoneOptions,"use-custom-slot":!0,"include-styling":!1},on:{"vdropzone-file-added":e.dropZoneFileAdded}},[s("div",{staticClass:"uk-flex uk-flex-middle uk-flex-center uk-placeholder"},[s("oc-icon",{attrs:{name:"file_upload"}}),e._v(" "),s("translate",[e._v("Drop files here to upload or click to select file")])],1)]),e._v(" "),s("div",{attrs:{id:"previews",hidden:""}})],1),e._v(" "),s("div",{staticClass:"uk-flex uk-flex-center uk-overflow-auto uk-width-1-1",class:{"files-empty":!e.getUploadedFiles}},[e.getUploadedFiles?s("oc-table-simple",{staticClass:"uk-width-1-1 uk-width-xxlarge@m"},[s("oc-tbody",e._l(e.getUploadedFiles,(function(t,i){return s("oc-tr",{key:i},[s("oc-td",{staticClass:"oc-pl-rm",domProps:{textContent:e._s(t.name)}}),e._v(" "),s("oc-td",{staticClass:"uk-text-nowrap oc-text-muted",attrs:{width:"shrink"}},[s("oc-resource-size",{attrs:{size:t.size}})],1),e._v(" "),s("oc-td",{staticClass:"oc-pr-rm uk-preserve-width",attrs:{width:"shrink"}},["done"===t.status?s("oc-icon",{attrs:{name:"ready",size:"small",variation:"success"}}):e._e(),e._v(" "),"error"===t.status?s("oc-icon",{attrs:{name:"info",size:"small",variation:"danger"}}):e._e(),e._v(" "),"uploading"===t.status||"init"===t.status?s("oc-spinner",{attrs:{size:"small","aria-label":e.$_ocUploadingFileMessage(t.name)}}):e._e()],1)],1)})),1)],1):e._e()],1),e._v(" "),e.errorMessage?s("div",{staticClass:"uk-text-center"},[s("h2",[s("translate",[e._v("An error occurred while loading the public link")])],1),e._v(" "),s("p",{staticClass:"oc-m-rm",domProps:{textContent:e._s(e.errorMessage)}})]):e._e()])]),e._v(" "),s("div",{staticClass:"uk-text-center"},[s("p",{domProps:{textContent:e._s(e.configuration.theme.general.slogan)}})])])};Hi._withStripped=!0;const Wi=t.normalizeComponent({render:Hi,staticRenderFns:[]},undefined,qi,undefined,false,undefined,!1,void 0,void 0,void 0),ji="move",Yi="copy";const Qi={metaInfo(){return{title:`${this.title} - ${this.configuration.theme.general.name}`}},components:{ResourceTable:Ve,NoContentMessage:Me,ListLoader:ui,ListInfo:We,Pagination:Qe},mixins:[at,ot,Je],setup(){const e=Ce(),{pagination:s}=$e(),{refresh:i,y:r}=Fe(),o=we("sort-by"),n=we("sort-dir"),l=t.computed((()=>e.getters["Files/activeFiles"]||[])),c=t.computed((()=>ze(t.unref(l)[0]))),{sortBy:d,sortDir:u,items:h,handleSort:p}=Ie({items:l,fields:c,sortBy:o,sortDir:n}),m=we("page","1"),f=t.computed((()=>parseInt(String(m.value)))),g=we("items-per-page",s.perPage.value),{items:v,total:_}=Re({page:f,perPage:t.computed((()=>parseInt(String(g.value)))),items:h,sortDir:u,sortBy:d});return{fileListHeaderY:r,navigateToTargetTask:t.q((function*(e,t,s){t.CLEAR_CURRENT_FILES_LIST(),"object"==typeof s&&(s=t.target);const r=t.isPublicContext?yield t.$client.publicFiles.list(s,t.publicLinkPassword,a.DavProperties.Default):yield t.$client.files.list(s,1,a.DavProperties.Default);t.loadFiles({currentFolder:r[0],files:r.slice(1)}),t.loadIndicators({client:t.$client,currentFolder:t.$route.params.item||"/"}),i()})).restartable(),paginatedResources:v,paginationPages:_,paginationPage:f,handleSort:p,sortBy:d,sortDir:u}},data:()=>({originalLocation:""}),computed:{...t.mapState("Files",["selectedResourcesForMove","locationPickerTargetFolder","currentFolder"]),...t.mapGetters("Files",["publicLinkPassword","totalFilesCount","totalFilesSize"]),...t.mapGetters(["configuration"]),...t.mapGetters(["homeFolder"]),title(){const e=this.currentAction===ji?this.$gettext("Move into »%{ target }«"):this.$gettext("Copy into »%{ target }«"),s=t.basename(this.target)||this.$gettext("All files");return this.$gettextInterpolate(e,{target:s})},currentAction(){return this.$route.params.action},isPublicContext(){return"public"===this.$route.params.context},target(){return this.$route.params.item||this.homeFolder},resources(){const e=X(this.$route.query.resource);return"string"==typeof e?[e]:e},resourcesCount(){return this.resources.length},breadcrumbs(){const e=[],s=this.target.split("/").filter((e=>""!==e));if(this.isPublicContext){const i=t.join.apply(null,s.slice(0,1));e.push(this.createBreadcrumbNode(0,this.$gettext("Public link"),i));for(let i=1;i<s.length;i++){const a=t.join.apply(null,s.slice(0,i+1));e.push(this.createBreadcrumbNode(i+1,s[i],a))}}else{e.push(this.createBreadcrumbNode(0,this.$gettext("All files"),"/"));for(let i=0;i<s.length;i++){const a=t.join.apply(null,s.slice(0,i+1));e.push(this.createBreadcrumbNode(i+1,s[i],a))}}return delete e[e.length-1].to,e},canConfirm(){return this.currentFolder&&this.currentFolder.canCreate()},confirmBtnText(){switch(this.currentAction){case ji:return this.$pgettext("Confirm action in the location picker for move","Move here");case Yi:return this.$pgettext("Confirm action in the location picker for copy","Paste here");default:return this.$gettext("Confirm")}},disabledResources(){return X(this.paginatedResources).filter((e=>"folder"!==e.type||this.resources.includes(e.path))).map((e=>e.id))},isEmpty(){return this.paginatedResources.length<1},targetRoute(){return{name:this.$route.name,query:{resource:this.resources},params:{action:this.currentAction}}},currentHint(){return"move"===this.currentAction?this.$gettext("Navigate into the desired folder and move selected resources into it.\n          You can navigate into a folder by clicking on its name.\n          To navigate back, you can click on the breadcrumbs.\n          Resources will be moved into the folder where you are currently located."):this.$gettext("Navigate into the desired folder and copy selected resources into it.\n        You can navigate into a folder by clicking on its name.\n        To navigate back, you can click on the breadcrumbs.\n        Resources will be copied into the folder where you are currently located.")}},watch:{$route:{handler:function(e,t){const s=e.name===t?.name,i=e.params?.item===t?.params?.item;s&&i||this.navigateToTargetTask.perform(this,this.$route)},immediate:!0}},created(){this.originalLocation=this.target},methods:{...t.mapMutations("Files",["CLEAR_CURRENT_FILES_LIST"]),...t.mapActions("Files",["loadFiles","loadIndicators"]),...t.mapActions(["showMessage"]),createBreadcrumbNode(e,t,s){return{index:e,text:t,to:{name:this.$route.name,params:{action:this.currentAction,item:s},query:{resource:this.resources}}}},leaveLocationPicker(e){this.isPublicContext?this.$router.push({name:"files-public-list",params:{item:e}}):this.$router.push({name:"files-personal",params:{item:e||"/"}})},isRowDisabled(e){return"folder"!==e.type||!e.canCreate()||this.resources.some((t=>t===e.path))},async confirmAction(){const e=[];let s=null;for(const i of this.resources){let a=this.target||"/";const r=t.basename(i);a+="/"+r;if(this.paginatedResources.some((e=>t.basename(e.name)===r))){const t=this.$gettext("Resource with name %{name} already exists");e.push({resource:r,message:this.$gettextInterpolate(t,{name:r},!0)})}else{switch(this.currentAction){case ji:s=this.isPublicContext?this.$client.publicFiles.move(i,a,this.publicLinkPassword):this.$client.files.move(i,a);break;case Yi:s=this.isPublicContext?this.$client.publicFiles.copy(i,a,this.publicLinkPassword):this.$client.files.copy(i,a);break;default:return}await s.catch((t=>{t.resource=r,e.push(t)}))}}if(0===e.length)return void this.leaveLocationPicker(this.target);let i="",a="";if(1!==e.length){switch(this.currentAction){case ji:i=this.$gettext("An error occurred while moving several resources"),a=this.$ngettext("%{count} resource could not be moved","%{count} resources could not be moved",e.length);break;case Yi:i=this.$gettext("An error occurred while copying several resources"),a=this.$ngettext("%{count} resource could not be copied","%{count} resources could not be copied",e.length);break;default:return}this.showMessage({title:i,desc:this.$gettextInterpolate(a,{count:e.length},!1),status:"danger"})}else{switch(this.currentAction){case ji:i=this.$gettext("An error occurred while moving %{resource}");break;case Yi:i=this.$gettext("An error occurred while copying %{resource}");break;default:return}this.showMessage({title:this.$gettextInterpolate(i,{resource:e[0].resource},!0),desc:e[0].message,status:"danger"})}}}};var Ji=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("main",{staticClass:"uk-flex uk-height-1-1",attrs:{id:"files-location-picker"}},[s("div",{staticClass:"files-list-wrapper uk-width-expand",attrs:{tabindex:"-1"}},[s("div",{staticClass:"oc-p-s",attrs:{id:"files-app-bar"}},[s("h1",{staticClass:"location-picker-selection-info oc-mb",domProps:{textContent:e._s(e.title)}}),e._v(" "),s("p",{staticClass:"oc-text-muted uk-text-meta",domProps:{textContent:e._s(e.currentHint)}}),e._v(" "),s("hr",{staticClass:"oc-mt-rm"}),e._v(" "),s("oc-breadcrumb",{staticClass:"oc-mb-s",attrs:{items:e.breadcrumbs}}),e._v(" "),s("oc-grid",{staticClass:"uk-flex-middle",attrs:{gutter:"small",flex:""}},[s("div",[s("oc-button",{attrs:{id:"location-picker-btn-cancel",size:"small"},on:{click:function(t){return e.leaveLocationPicker(e.originalLocation)}}},[s("translate",[e._v("Cancel")])],1)],1),e._v(" "),s("div",[s("oc-button",{attrs:{id:"location-picker-btn-confirm",variation:"primary",appearance:"filled",size:"small",disabled:!e.canConfirm},on:{click:e.confirmAction}},[s("span",{domProps:{textContent:e._s(e.confirmBtnText)}})])],1)])],1),e._v(" "),s("div",{attrs:{id:"files-view"}},[e.navigateToTargetTask.isRunning?s("list-loader"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-location-picker-empty",icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources in this folder.")])]},proxy:!0}],null,!1,3449492595)}):s("resource-table",{staticClass:"files-table",attrs:{id:"files-location-picker-table","are-thumbnails-displayed":!1,resources:e.paginatedResources,disabled:e.disabledResources,"target-route":e.targetRoute,"has-actions":!1,"is-selectable":!1,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{sort:e.handleSort},scopedSlots:e._u([{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"uk-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}])})]],2)])])};Ji._withStripped=!0;const Ki=t.normalizeComponent({render:Ji,staticRenderFns:[]},undefined,Qi,"data-v-3de3bca4",false,undefined,!1,void 0,void 0,void 0),Xi=new pe;const Zi={components:{ResourceTable:Ve,ListInfo:We,Pagination:Qe,ListLoader:ui,NoContentMessage:Me,NotFoundMessage:mi,ContextActions:zs},mixins:[ai,ue,ri],setup(){const s=Ce(),{pagination:i}=$e(),{refresh:r,y:o}=Fe(),n=we("sort-by"),l=we("sort-dir"),c=t.computed((()=>s.getters["Files/activeFiles"]||[])),d=t.computed((()=>ze(t.unref(c)[0]))),{sortBy:u,sortDir:h,items:p,handleSort:m}=Ie({items:c,fields:d,sortBy:n,sortDir:l}),f=we("page","1"),g=t.computed((()=>parseInt(String(f.value)))),v=we("items-per-page",i.perPage.value),{items:_,total:b}=Re({page:g,perPage:t.computed((()=>parseInt(String(v.value)))),items:p,sortDir:h,sortBy:u});Ee(["Files/UPSERT_RESOURCE"],(async({payload:e})=>{await t.nextTick(),oi(e.id)}));return{fileListHeaderY:o,loadResourcesTask:t.q((function*(s,i,o,n=null){i.CLEAR_CURRENT_FILES_LIST();try{let t=yield i.$client.publicFiles.list(n||i.$route.params.item,i.publicLinkPassword,a.DavProperties.PublicLink);if("4"===t[0].getProperty(i.$client.publicFiles.PUBLIC_LINK_PERMISSION))return void i.$router.push({name:"files-public-link",params:{token:i.$route.params.item}});t=t.map(e.buildResource),i.LOAD_FILES({currentFolder:t[0],files:t.slice(1)}),r()}catch(e){if(i.SET_CURRENT_FOLDER(null),console.error(e),401===e.statusCode)return void i.redirectToResolvePage()}yield(async(e,s)=>{if(s.getters.userReady)return;const i=(e.currentRoute.params.item||"").split("/")[0],a=s.getters["Files/publicLinkPassword"];a||(await s.dispatch("loadCapabilities",{publicToken:i,...a&&{user:"public",password:a}}),a&&s.commit("SET_CAPABILITIES",t.merge({},s.getters.capabilities,{files:{archivers:null}})),s.commit("SET_USER_READY",!0))})(i.$router,i.$store),i.accessibleBreadcrumb_focusAndAnnounceBreadcrumb(o)})).restartable(),paginatedResources:_,paginationPages:b,paginationPage:g,handleSort:m,sortBy:u,sortDir:h}},computed:{...t.mapGetters("Files",["publicLinkPassword","selectedFiles","currentFolder","highlightedFile","currentFolder","totalFilesCount","totalFilesSize"]),...t.mapGetters(["configuration"]),...t.mapState("Files/sidebar",{sidebarClosed:"closed"}),isEmpty(){return this.paginatedResources.length<1},selected:{get(){return this.selectedFiles},set(e){this.SET_FILE_SELECTION(e)}},folderNotFound(){return null===this.currentFolder},targetRoute(){return{name:this.$route.name}},displayThumbnails(){return!this.configuration.options.disablePreviews}},watch:{$route:{handler:function(e,t){const s=e.name===t?.name,i=e.params?.item===t?.params?.item;s&&i||this.loadResourcesTask.perform(this,s)},immediate:!0}},beforeDestroy(){Xi.disconnect()},created(){const e=i.bus.subscribe("app.files.list.load",(e=>{this.loadResourcesTask.perform(this,this.$route.params.item===e,e)}));this.$on("beforeDestroy",(()=>i.bus.unsubscribe("app.files.list.load",e)))},methods:{...t.mapActions("Files",["loadPreview"]),...t.mapMutations("Files",["SET_FILE_SELECTION","SET_CURRENT_FOLDER","LOAD_FILES","CLEAR_CURRENT_FILES_LIST"]),rowMounted(e,s){if(!this.displayThumbnails)return;const i=t.debounce((({unobserve:t})=>{t(),this.loadPreview({resource:e,isPublic:!0,dimensions:A.Thumbnail,type:O.Thumbnail})}),250);Xi.observe(s.$el,{onEnter:i,onExit:i.cancel})},redirectToResolvePage(){this.$router.push({name:"files-public-link",params:{token:this.$route.params.item}})},isResourceInSelection(e){return this.selected?.includes(e)}}};var ea=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.loadResourcesTask.isRunning?s("list-loader"):[e.folderNotFound?s("not-found-message",{staticClass:"files-not-found uk-height-1-1"}):e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-public-list-empty",icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources in this folder")])]},proxy:!0},e.currentFolder.canCreate()?{key:"callToAction",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v('Drag files and folders here or use the "+ New" button to upload')])]},proxy:!0}:null],null,!0)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-public-files-table","are-thumbnails-displayed":e.displayThumbnails,resources:e.paginatedResources,"target-route":e.targetRoute,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selected}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"uk-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})]],2)};ea._withStripped=!0;const ta={name:"Files",id:"files",icon:"folder",isFileEditor:!1,extensions:[],fileSideBars:_s};return{appInfo:ta,store:B,routes:[{path:"/",redirect:{name:"files-personal"}},{name:"list",path:"/list",redirect:{name:"files-personal"},components:{app:ii},children:[{name:"personal",path:"all/:item*",component:_i,meta:{hasBulkActions:!0,title:"All files",patchCleanPath:!0}},{name:"favorites",path:"favorites",component:yi,meta:{hideFilelistActions:!0,hasBulkActions:!1,title:"Favorite files"}},{path:"shared-with-me",component:ki,name:"shared-with-me",meta:{hideFilelistActions:!0,hasBulkActions:!0,title:"Files shared with me"}},{path:"shared-with-others",component:Ti,name:"shared-with-others",meta:{hideFilelistActions:!0,hasBulkActions:!1,title:"Files shared with others"}},{path:"shared-via-link",component:Li,name:"shared-via-link",meta:{hideFilelistActions:!0,hasBulkActions:!1,title:"Files shared via link"}},{path:"trash-bin",component:Ni,name:"trashbin",meta:{hideFilelistActions:!0,hasBulkActions:!0,title:"Deleted files"}}]},{name:"public",path:"/public",components:{app:ii},meta:{auth:!1},children:[{name:"public-list",path:"list/:item*",component:t.normalizeComponent({render:ea,staticRenderFns:[]},undefined,Zi,undefined,false,undefined,!1,void 0,void 0,void 0),meta:{auth:!1,hasBulkActions:!0,title:"Public files",patchCleanPath:!0}}]},{name:"public-link",path:"/public-link/:token",components:{fullscreen:Vi},meta:{auth:!1,hideHeadbar:!0,title:"Resolving public link"}},{name:"private-link",path:"/private-link/:fileId",components:{fullscreen:zi},meta:{hideHeadbar:!0,title:"Resolving private link"}},{name:"location-picker",path:"/location-picker/:context/:action/:item*",components:{app:Ki},meta:{verbose:!0,auth:!1,patchCleanPath:!0}},{name:"public-drop",path:"/files-drop/:token",components:{app:Wi},meta:{auth:!1,title:"Public file upload"}}],navItems:[{name:"All files",iconMaterial:ta.icon,route:{name:"files-personal",path:`/${ta.id}/list/all`}},{name:"Favorites",iconMaterial:"star",route:{name:"files-favorites",path:`/${ta.id}/list/favorites`},enabled:e=>e.files&&e.files.favorites},{name:"Shared with me",iconMaterial:"shared-with-me",route:{name:"files-shared-with-me",path:`/${ta.id}/list/shared-with-me`}},{name:"Shared with others",iconMaterial:"shared-with-others",route:{name:"files-shared-with-others",path:`/${ta.id}/list/shared-with-others`}},{name:"Shared via link",iconMaterial:"link",route:{name:"files-shared-via-link",path:`/${ta.id}/list/shared-via-link`}},{name:"Deleted files",iconMaterial:"delete",enabled:e=>e.dav&&"1.0"===e.dav.trashbin,route:{name:"files-trashbin",path:`/${ta.id}/list/trash-bin`}}],quickActions:l,translations:e.translations,ready({router:e,store:t}){F.filterSearch=new be(t,e),F.sdkSearch=new it(t,e),i.bus.publish("app.search.register.provider",F.filterSearch),i.bus.publish("app.search.register.provider",F.sdkSearch)},userReady({store:e}){x.initialize(e.getters.configuration.server||window.location.origin,t.get(e,"getters.capabilities.files.archivers",[]))}}}));
